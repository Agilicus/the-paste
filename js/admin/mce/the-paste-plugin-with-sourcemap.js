(function(){var t,e,n,r,a;t=window.jQuery,t.paste=function(t){var n;return"undefined"!=typeof console&&null!==console&&console.log("DEPRECATED: This method is deprecated. Please use $.fn.pastableNonInputable() instead."),n=e.mountNonInputable(t),n._container},t.fn.pastableNonInputable=function(){var n,r,a,o;for(o=this,r=0,a=o.length;r<a;r++)n=o[r],n._pastable||t(n).is("textarea, input:text, [contenteditable]")||(e.mountNonInputable(n),n._pastable=!0);return this},t.fn.pastableTextarea=function(){var n,r,a,o;for(o=this,r=0,a=o.length;r<a;r++)n=o[r],n._pastable||t(n).is(":not(textarea, input:text)")||(e.mountTextarea(n),n._pastable=!0);return this},t.fn.pastableContenteditable=function(){var n,r,a,o;for(o=this,r=0,a=o.length;r<a;r++)n=o[r],n._pastable||t(n).is(":not([contenteditable])")||(e.mountContenteditable(n),n._pastable=!0);return this},r=function(t,e){var n,r,a,o,i,u,s,l,c,f,g;if(null==e&&(e=512),!(l=t.match(/^data\:([^\;]+)\;base64\,(.+)$/)))return null;for(f=l,l=f[0],u=f[1],n=f[2],o=atob(n),a=[],c=0;c<o.length;){for(g=o.slice(c,c+e),i=new Array(g.length),s=0;s<g.length;)i[s]=g.charCodeAt(s),s++;r=new Uint8Array(i),a.push(r),c+=e}return new Blob(a,{type:u})},n=function(){return t(document.createElement("div")).attr("contenteditable",!0).attr("aria-hidden",!0).attr("tabindex",-1).css({width:1,height:1,position:"fixed",left:-100,overflow:"hidden"})},a=function(e,n){var r,a,o,i,u,s;return i=void 0,u=void 0,o=void 0,a=void 0,r=void 0,"area"===(s=e.nodeName.toLowerCase())?(i=e.parentNode,u=i.name,!(!e.href||!u||"map"!==i.nodeName.toLowerCase())&&(o=t("img[usemap='#"+u+"']"),o.length>0&&o.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(s)?(a=!e.disabled)&&(r=t(e).closest("fieldset")[0])&&(a=!r.disabled):a="a"===s?e.href||n:n,(a=a||t(e).is("[contenteditable]"))&&t(e).is(":visible"))},e=function(){function e(e,n){this._container=e,this._target=n,this._container=t(this._container),this._target=t(this._target).addClass("pastable"),this._container.on("paste",function(t){return function(e){var n,r,a,o,i,u,s,l,c,f,g,d,p;if(e.currentTarget!==e.target)return e.preventDefault();if(t._paste_event_fired=!0,null!=(null!=(c=e.originalEvent)?c.clipboardData:void 0))if(n=e.originalEvent.clipboardData,n.items)for(f=n.items,o=0,u=f.length;o<u;o++){if(a=f[o],a.type.match(/^image\//)){l=new FileReader,l.onload=function(e){return t._handleImage(e.target.result)};try{l.readAsDataURL(a.getAsFile())}catch(t){}e.preventDefault();break}"text/plain"===a.type&&a.getAsString(function(e){return t._target.trigger("pasteText",{text:e})})}else-1!==Array.prototype.indexOf.call(n.types,"text/plain")&&(p=n.getData("Text"),setTimeout(function(){return t._target.trigger("pasteText",{text:p})},1)),t._checkImagesInContainer(function(e){return t._handleImage(e)});if(n=window.clipboardData)if(null!=(g=p=n.getData("Text"))?g.length:void 0)setTimeout(function(){return t._target.trigger("pasteText",{text:p}),t._target.trigger("_pasteCheckContainerDone")},1);else{for(d=n.files,i=0,s=d.length;i<s;i++)r=d[i],t._handleImage(URL.createObjectURL(r));t._checkImagesInContainer(function(t){})}return null}}(this))}return e.prototype._target=null,e.prototype._container=null,e.mountNonInputable=function(r){var o;return o=new e(n().appendTo(r),r),t(r).on("click",function(t){return function(t){if(!a(t.target,!1))return o._container.focus()}}()),o._container.on("focus",function(e){return function(){return t(r).addClass("pastable-focus")}}()),o._container.on("blur",function(e){return function(){return t(r).removeClass("pastable-focus")}}())},e.mountTextarea=function(r){var a,o,i,u;return("undefined"!=typeof DataTransfer&&null!==DataTransfer?DataTransfer.prototype:void 0)&&(null!=(i=Object.getOwnPropertyDescriptor)&&null!=(u=i.call(Object,DataTransfer.prototype,"items"))?u.get:void 0)?this.mountContenteditable(r):(o=new e(n().insertBefore(r),r),a=!1,t(r).on("keyup",function(t){var e;return 17!==(e=t.keyCode)&&224!==e||(a=!1),null}),t(r).on("keydown",function(e){var n;return 17!==(n=e.keyCode)&&224!==n||(a=!0),null!=e.ctrlKey&&null!=e.metaKey&&(a=e.ctrlKey||e.metaKey),a&&86===e.keyCode&&(o._textarea_focus_stolen=!0,o._container.focus(),o._paste_event_fired=!1,setTimeout(function(e){return function(){if(!o._paste_event_fired)return t(r).focus(),o._textarea_focus_stolen=!1}}(),1)),null}),t(r).on("paste",function(t){return function(){}}()),t(r).on("focus",function(e){return function(){if(!o._textarea_focus_stolen)return t(r).addClass("pastable-focus")}}()),t(r).on("blur",function(e){return function(){if(!o._textarea_focus_stolen)return t(r).removeClass("pastable-focus")}}()),t(o._target).on("_pasteCheckContainerDone",function(e){return function(){return t(r).focus(),o._textarea_focus_stolen=!1}}()),t(o._target).on("pasteText",function(e){return function(e,n){var a,o,i;return i=t(r).prop("selectionStart"),o=t(r).prop("selectionEnd"),a=t(r).val(),t(r).val(""+a.slice(0,i)+n.text+a.slice(o)),t(r)[0].setSelectionRange(i+n.text.length,i+n.text.length),t(r).trigger("change")}}()))},e.mountContenteditable=function(n){return new e(n,n),t(n).on("focus",function(e){return function(){return t(n).addClass("pastable-focus")}}()),t(n).on("blur",function(e){return function(){return t(n).removeClass("pastable-focus")}}())},e.prototype._handleImage=function(t){var e;return t.match(/^webkit\-fake\-url\:\/\//)?this._target.trigger("pasteImageError",{message:"You are trying to paste an image in Safari, however we are unable to retieve its data."}):(this._target.trigger("pasteImageStart"),e=new Image,e.crossOrigin="anonymous",e.onload=function(t){return function(){var n,a,o,i;a=document.createElement("canvas"),a.width=e.width,a.height=e.height,o=a.getContext("2d"),o.drawImage(e,0,0,a.width,a.height),i=null;try{i=a.toDataURL("image/png"),n=r(i)}catch(t){}return i&&t._target.trigger("pasteImage",{blob:n,dataURL:i,width:e.width,height:e.height}),t._target.trigger("pasteImageEnd")}}(this),e.onerror=function(e){return function(){return e._target.trigger("pasteImageError",{message:"Failed to get image from: "+t,url:t}),e._target.trigger("pasteImageEnd")}}(this),e.src=t)},e.prototype._checkImagesInContainer=function(e){var n,r,a,o,i;for(i=Math.floor(1e3*Math.random()),o=this._container.find("img"),r=0,a=o.length;r<a;r++)n=o[r],n["_paste_marked_"+i]=!0;return setTimeout(function(r){return function(){var a,o,u;for(u=r._container.find("img"),a=0,o=u.length;a<o;a++)n=u[a],n["_paste_marked_"+i]||(e(n.src),t(n).remove());return r._target.trigger("_pasteCheckContainerDone")}}(this),1)},e}()}).call(this);
var thepastePluginCallback;!function(t){thepastePluginCallback=function(e){function o(){var o=i.apply(this,arguments);return"mcepastebin"===t(o).attr("id")&&t(o).pastableContenteditable().on("paste",function(t){}).on("pasteImage",function(t,o){var a;if(s)return t.preventDefault(),!1;a=u.insertImage(o.dataURL,o.blob.type,e),u.options.editor.auto_upload&&u.uploadImage(a,e)}),o}function a(){i=e.dom.add,e.dom.add=o,t(e.dom.doc).on("paste",function(t){d=t.originalEvent,console.log(d.clipboardData.types),p=u.clipboardHasImage(t.originalEvent.clipboardData),s=!1})}var n,i,l,p=!1,d=null,s=!1,u=wp.media.thepaste;u.options.editor.auto_upload="false"!==localStorage.getItem("thepaste.auto_upload"),e.addCommand("cmd_thepaste",function(){u.options.editor.auto_upload=!u.options.editor.auto_upload,localStorage.setItem("thepaste.auto_upload",u.options.editor.auto_upload.toString()),n.active(u.options.editor.auto_upload)}),e.addButton("thepaste",{icon:"thepaste",tooltip:u.l10n.upload_pasted_images,cmd:"cmd_thepaste",onPostRender:function(){n=this},active:u.options.editor.auto_upload}),e.addButton("wp_img_thepaste_upload",{icon:"dashicon dashicons dashicons-upload thepaste-upload",tooltip:u.l10n.upload_image,onclick:function(){var t;t=e.selection.getNode(),u.uploadImage(t,e)}}),e.once("preinit",function(){e.wp&&e.wp._createToolbar&&(l=e.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wp_img_thepaste_upload","wp_img_edit","wp_img_remove"]))}),e.on("wptoolbar",function(t){var o,a=!1;"IMG"!==t.element.nodeName||e.wp.isPlaceholder(t.element)||(t.toolbar=l,a=!!t.element.src.match(/^(blob|data):/),o=l.$el.find(".thepaste-upload").closest(".mce-btn"),a?o.show():o.hide())}),e.on("init",a).on("BeforePastePreProcess",function(t){return t.content.match(/&lt;svg[\s\S.]*&lt;\/svg&gt;/i)&&(t.preventDefault(),t.content=""),p&&(t.preventDefault(),t.content=""),t})},tinymce.PluginManager.add("thepaste",thepastePluginCallback)}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhc3RlLmpzIiwidGhlLXBhc3RlLXBsdWdpbi5qcyJdLCJuYW1lcyI6WyIkIiwiUGFzdGUiLCJjcmVhdGVIaWRkZW5FZGl0YWJsZSIsImRhdGFVUkx0b0Jsb2IiLCJpc0ZvY3VzYWJsZSIsIndpbmRvdyIsImpRdWVyeSIsInBhc3RlIiwicGFzdGVDb250YWluZXIiLCJwbSIsImNvbnNvbGUiLCJsb2ciLCJtb3VudE5vbklucHV0YWJsZSIsIl9jb250YWluZXIiLCJmbiIsInBhc3RhYmxlTm9uSW5wdXRhYmxlIiwiZWwiLCJqIiwibGVuIiwicmVmIiwidGhpcyIsImxlbmd0aCIsIl9wYXN0YWJsZSIsImlzIiwicGFzdGFibGVUZXh0YXJlYSIsIm1vdW50VGV4dGFyZWEiLCJwYXN0YWJsZUNvbnRlbnRlZGl0YWJsZSIsIm1vdW50Q29udGVudGVkaXRhYmxlIiwiZGF0YVVSTCIsInNsaWNlU2l6ZSIsImI2NERhdGEiLCJieXRlQXJyYXkiLCJieXRlQXJyYXlzIiwiYnl0ZUNoYXJhY3RlcnMiLCJieXRlTnVtYmVycyIsImNvbnRlbnRUeXBlIiwiaSIsIm0iLCJvZmZzZXQiLCJzbGljZSIsIm1hdGNoIiwiYXRvYiIsIkFycmF5IiwiY2hhckNvZGVBdCIsIlVpbnQ4QXJyYXkiLCJwdXNoIiwiQmxvYiIsInR5cGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJhdHRyIiwiY3NzIiwid2lkdGgiLCJoZWlnaHQiLCJwb3NpdGlvbiIsImxlZnQiLCJvdmVyZmxvdyIsImVsZW1lbnQiLCJoYXNUYWJpbmRleCIsImZpZWxkc2V0IiwiZm9jdXNhYmxlSWZWaXNpYmxlIiwiaW1nIiwibWFwIiwibWFwTmFtZSIsIm5vZGVOYW1lIiwidG9Mb3dlckNhc2UiLCJwYXJlbnROb2RlIiwibmFtZSIsImhyZWYiLCJ0ZXN0IiwiZGlzYWJsZWQiLCJjbG9zZXN0IiwiX3RhcmdldCIsImFkZENsYXNzIiwib24iLCJfdGhpcyIsImV2IiwiY2xpcGJvYXJkRGF0YSIsImZpbGUiLCJpdGVtIiwiayIsImxlbjEiLCJyZWFkZXIiLCJyZWYxIiwicmVmMiIsInJlZjMiLCJ0ZXh0IiwiY3VycmVudFRhcmdldCIsInRhcmdldCIsInByZXZlbnREZWZhdWx0IiwiX3Bhc3RlX2V2ZW50X2ZpcmVkIiwib3JpZ2luYWxFdmVudCIsIml0ZW1zIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsImV2ZW50IiwiX2hhbmRsZUltYWdlIiwicmVzdWx0IiwicmVhZEFzRGF0YVVSTCIsImdldEFzRmlsZSIsImVycm9yIiwiZ2V0QXNTdHJpbmciLCJzdHJpbmciLCJ0cmlnZ2VyIiwicHJvdG90eXBlIiwiaW5kZXhPZiIsImNhbGwiLCJ0eXBlcyIsImdldERhdGEiLCJzZXRUaW1lb3V0IiwiX2NoZWNrSW1hZ2VzSW5Db250YWluZXIiLCJzcmMiLCJmaWxlcyIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsIm5vbklucHV0YWJsZSIsImFwcGVuZFRvIiwiZm9jdXMiLCJyZW1vdmVDbGFzcyIsInRleHRhcmVhIiwiY3RsRG93biIsIkRhdGFUcmFuc2ZlciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImdldCIsImluc2VydEJlZm9yZSIsImtleUNvZGUiLCJjdHJsS2V5IiwibWV0YUtleSIsIl90ZXh0YXJlYV9mb2N1c19zdG9sZW4iLCJkYXRhIiwiY29udGVudCIsImN1ckVuZCIsImN1clN0YXJ0IiwicHJvcCIsInZhbCIsInNldFNlbGVjdGlvblJhbmdlIiwiY29udGVudGVkaXRhYmxlIiwibG9hZGVyIiwibWVzc2FnZSIsIkltYWdlIiwiY3Jvc3NPcmlnaW4iLCJibG9iIiwiY2FudmFzIiwiY3R4IiwiZ2V0Q29udGV4dCIsImRyYXdJbWFnZSIsInRvRGF0YVVSTCIsIm9uZXJyb3IiLCJ1cmwiLCJjYiIsInRpbWVzcGFuIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZmluZCIsInJlbW92ZSIsInRoZXBhc3RlUGx1Z2luQ2FsbGJhY2siLCJlZGl0b3IiLCJkb21BZGQiLCJvcmlnRG9tQWRkIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJlIiwiaW1hZ2UiLCJwcmV2ZW50SW1hZ2VQYXN0ZSIsInRoZXBhc3RlIiwiaW5zZXJ0SW1hZ2UiLCJvcHRpb25zIiwiYXV0b191cGxvYWQiLCJ1cGxvYWRJbWFnZSIsInNldHVwRWRpdG9yRG9tIiwiZG9tIiwiYWRkIiwiZG9jIiwiY3VycmVudENsaXBib2FyZEV2ZW50IiwiY2xpcGJvYXJkSGFzSW1hZ2UiLCJwYXN0ZUJ0biIsInRvb2xiYXIiLCJ3cCIsIm1lZGlhIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImFkZENvbW1hbmQiLCJzZXRJdGVtIiwidG9TdHJpbmciLCJhY3RpdmUiLCJhZGRCdXR0b24iLCJpY29uIiwidG9vbHRpcCIsImwxMG4iLCJ1cGxvYWRfcGFzdGVkX2ltYWdlcyIsImNtZCIsIm9uUG9zdFJlbmRlciIsInVwbG9hZF9pbWFnZSIsIm9uY2xpY2siLCJzZWxlY3Rpb24iLCJnZXROb2RlIiwib25jZSIsIl9jcmVhdGVUb29sYmFyIiwidXBsb2FkQnRuIiwiY2FuVXBsb2FkIiwiaXNQbGFjZWhvbGRlciIsIiRlbCIsInNob3ciLCJoaWRlIiwidGlueW1jZSIsIlBsdWdpbk1hbmFnZXIiXSwibWFwcGluZ3MiOiJDQVFBLFdBQ0UsR0FBSUEsR0FBR0MsRUFBT0MsRUFBc0JDLEVBQWVDLENBRW5ESixHQUFJSyxPQUFPQyxPQUVYTixFQUFFTyxNQUFRLFNBQVNDLEdBQ2pCLEdBQUlDLEVBS0osT0FKdUIsbUJBQVpDLFVBQXVDLE9BQVpBLFNBQ3BDQSxRQUFRQyxJQUFJLDBGQUVkRixFQUFLUixFQUFNVyxrQkFBa0JKLEdBQ3RCQyxFQUFHSSxZQUdaYixFQUFFYyxHQUFHQyxxQkFBdUIsV0FDMUIsR0FBSUMsR0FBSUMsRUFBR0MsRUFBS0MsQ0FFaEIsS0FEQUEsRUFBTUMsS0FDREgsRUFBSSxFQUFHQyxFQUFNQyxFQUFJRSxPQUFRSixFQUFJQyxFQUFLRCxJQUNyQ0QsRUFBS0csRUFBSUYsR0FDTEQsRUFBR00sV0FBYXRCLEVBQUVnQixHQUFJTyxH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Q2dLLEVBQVl0QixFQUFReUIsSUFBSWhELEtBQUssb0JBQW9CcEYsUUFBUSxZQUVwRGtJLEVBQ0pELEVBQVVJLE9BRVZKLEVBQVVLLFVBS2IvQyxFQUNFcEYsR0FBSSxPQUFRaUcsR0FDWmpHLEdBQUksd0JBQXlCLFNBQVN5RixHQVN0QyxNQVJNQSxHQUFFaEMsUUFBUTNGLE1BQU8sbUNBQ3RCMkgsRUFBRTFFLGlCQUNGMEUsRUFBRWhDLFFBQVUsSUFFUjZDLElBQ0piLEVBQUUxRSxpQkFDRjBFLEVBQUVoQyxRQUFVLElBRU5nQyxLQU1WMkMsUUFBUUMsY0FBY2xDLElBQUssV0FBWWhCLHlCQUVwQ3ZKIiwiZmlsZSI6InRoZS1wYXN0ZS1wbHVnaW4td2l0aC1zb3VyY2VtYXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuMTIuN1xuXG4vKlxucGFzdGUuanMgaXMgYW4gaW50ZXJmYWNlIHRvIHJlYWQgZGF0YSAoIHRleHQgLyBpbWFnZSApIGZyb20gY2xpcGJvYXJkIGluIGRpZmZlcmVudCBicm93c2Vycy4gSXQgYWxzbyBjb250YWlucyBzZXZlcmFsIGhhY2tzLlxuXG5odHRwczovL2dpdGh1Yi5jb20vbGF5ZXJzc3NzL3Bhc3RlLmpzXG4gKi9cblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgJCwgUGFzdGUsIGNyZWF0ZUhpZGRlbkVkaXRhYmxlLCBkYXRhVVJMdG9CbG9iLCBpc0ZvY3VzYWJsZTtcblxuICAkID0gd2luZG93LmpRdWVyeTtcblxuICAkLnBhc3RlID0gZnVuY3Rpb24ocGFzdGVDb250YWluZXIpIHtcbiAgICB2YXIgcG07XG4gICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSBcInVuZGVmaW5lZFwiICYmIGNvbnNvbGUgIT09IG51bGwpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiREVQUkVDQVRFRDogVGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSAkLmZuLnBhc3RhYmxlTm9uSW5wdXRhYmxlKCkgaW5zdGVhZC5cIik7XG4gICAgfVxuICAgIHBtID0gUGFzdGUubW91bnROb25JbnB1dGFibGUocGFzdGVDb250YWluZXIpO1xuICAgIHJldHVybiBwbS5fY29udGFpbmVyO1xuICB9O1xuXG4gICQuZm4ucGFzdGFibGVOb25JbnB1dGFibGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZWwsIGosIGxlbiwgcmVmO1xuICAgIHJlZiA9IHRoaXM7XG4gICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICBlbCA9IHJlZltqXTtcbiAgICAgIGlmIChlbC5fcGFzdGFibGUgfHwgJChlbCkuaXMoJ3RleHRhcmVhLCBpbnB1dDp0ZXh0LCBbY29udGVudGVkaXRhYmxlXScpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgUGFzdGUubW91bnROb25JbnB1dGFibGUoZWwpO1xuICAgICAgZWwuX3Bhc3RhYmxlID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgJC5mbi5wYXN0YWJsZVRleHRhcmVhID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVsLCBqLCBsZW4sIHJlZjtcbiAgICByZWYgPSB0aGlzO1xuICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgZWwgPSByZWZbal07XG4gICAgICBpZiAoZWwuX3Bhc3RhYmxlIHx8ICQoZWwpLmlzKCc6bm90KHRleHRhcmVhLCBpbnB1dDp0ZXh0KScpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgUGFzdGUubW91bnRUZXh0YXJlYShlbCk7XG4gICAgICBlbC5fcGFzdGFibGUgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAkLmZuLnBhc3RhYmxlQ29udGVudGVkaXRhYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVsLCBqLCBsZW4sIHJlZjtcbiAgICByZWYgPSB0aGlzO1xuICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgZWwgPSByZWZbal07XG4gICAgICBpZiAoZWwuX3Bhc3RhYmxlIHx8ICQoZWwpLmlzKCc6bm90KFtjb250ZW50ZWRpdGFibGVdKScpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgUGFzdGUubW91bnRDb250ZW50ZWRpdGFibGUoZWwpO1xuICAgICAgZWwuX3Bhc3RhYmxlID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgZGF0YVVSTHRvQmxvYiA9IGZ1bmN0aW9uKGRhdGFVUkwsIHNsaWNlU2l6ZSkge1xuICAgIHZhciBiNjREYXRhLCBieXRlQXJyYXksIGJ5dGVBcnJheXMsIGJ5dGVDaGFyYWN0ZXJzLCBieXRlTnVtYmVycywgY29udGVudFR5cGUsIGksIG0sIG9mZnNldCwgcmVmLCBzbGljZTtcbiAgICBpZiAoc2xpY2VTaXplID09IG51bGwpIHtcbiAgICAgIHNsaWNlU2l6ZSA9IDUxMjtcbiAgICB9XG4gICAgaWYgKCEobSA9IGRhdGFVUkwubWF0Y2goL15kYXRhXFw6KFteXFw7XSspXFw7YmFzZTY0XFwsKC4rKSQvKSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZWYgPSBtLCBtID0gcmVmWzBdLCBjb250ZW50VHlwZSA9IHJlZlsxXSwgYjY0RGF0YSA9IHJlZlsyXTtcbiAgICBieXRlQ2hhcmFjdGVycyA9IGF0b2IoYjY0RGF0YSk7XG4gICAgYnl0ZUFycmF5cyA9IFtdO1xuICAgIG9mZnNldCA9IDA7XG4gICAgd2hpbGUgKG9mZnNldCA8IGJ5dGVDaGFyYWN0ZXJzLmxlbmd0aCkge1xuICAgICAgc2xpY2UgPSBieXRlQ2hhcmFjdGVycy5zbGljZShvZmZzZXQsIG9mZnNldCArIHNsaWNlU2l6ZSk7XG4gICAgICBieXRlTnVtYmVycyA9IG5ldyBBcnJheShzbGljZS5sZW5ndGgpO1xuICAgICAgaSA9IDA7XG4gICAgICB3aGlsZSAoaSA8IHNsaWNlLmxlbmd0aCkge1xuICAgICAgICBieXRlTnVtYmVyc1tpXSA9IHNsaWNlLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgIGkrKztcbiAgICAgIH1cbiAgICAgIGJ5dGVBcnJheSA9IG5ldyBVaW50OEFycmF5KGJ5dGVOdW1iZXJzKTtcbiAgICAgIGJ5dGVBcnJheXMucHVzaChieXRlQXJyYXkpO1xuICAgICAgb2Zmc2V0ICs9IHNsaWNlU2l6ZTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBCbG9iKGJ5dGVBcnJheXMsIHtcbiAgICAgIHR5cGU6IGNvbnRlbnRUeXBlXG4gICAgfSk7XG4gIH07XG5cbiAgY3JlYXRlSGlkZGVuRWRpdGFibGUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSkuYXR0cignY29udGVudGVkaXRhYmxlJywgdHJ1ZSkuYXR0cignYXJpYS1oaWRkZW4nLCB0cnVlKS5hdHRyKCd0YWJpbmRleCcsIC0xKS5jc3Moe1xuICAgICAgd2lkdGg6IDEsXG4gICAgICBoZWlnaHQ6IDEsXG4gICAgICBwb3NpdGlvbjogJ2ZpeGVkJyxcbiAgICAgIGxlZnQ6IC0xMDAsXG4gICAgICBvdmVyZmxvdzogJ2hpZGRlbidcbiAgICB9KTtcbiAgfTtcblxuICBpc0ZvY3VzYWJsZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIGhhc1RhYmluZGV4KSB7XG4gICAgdmFyIGZpZWxkc2V0LCBmb2N1c2FibGVJZlZpc2libGUsIGltZywgbWFwLCBtYXBOYW1lLCBub2RlTmFtZTtcbiAgICBtYXAgPSB2b2lkIDA7XG4gICAgbWFwTmFtZSA9IHZvaWQgMDtcbiAgICBpbWcgPSB2b2lkIDA7XG4gICAgZm9jdXNhYmxlSWZWaXNpYmxlID0gdm9pZCAwO1xuICAgIGZpZWxkc2V0ID0gdm9pZCAwO1xuICAgIG5vZGVOYW1lID0gZWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmICgnYXJlYScgPT09IG5vZGVOYW1lKSB7XG4gICAgICBtYXAgPSBlbGVtZW50LnBhcmVudE5vZGU7XG4gICAgICBtYXBOYW1lID0gbWFwLm5hbWU7XG4gICAgICBpZiAoIWVsZW1lbnQuaHJlZiB8fCAhbWFwTmFtZSB8fCBtYXAubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gJ21hcCcpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaW1nID0gJCgnaW1nW3VzZW1hcD1cXCcjJyArIG1hcE5hbWUgKyAnXFwnXScpO1xuICAgICAgcmV0dXJuIGltZy5sZW5ndGggPiAwICYmIGltZy5pcygnOnZpc2libGUnKTtcbiAgICB9XG4gICAgaWYgKC9eKGlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvLnRlc3Qobm9kZU5hbWUpKSB7XG4gICAgICBmb2N1c2FibGVJZlZpc2libGUgPSAhZWxlbWVudC5kaXNhYmxlZDtcbiAgICAgIGlmIChmb2N1c2FibGVJZlZpc2libGUpIHtcbiAgICAgICAgZmllbGRzZXQgPSAkKGVsZW1lbnQpLmNsb3Nlc3QoJ2ZpZWxkc2V0JylbMF07XG4gICAgICAgIGlmIChmaWVsZHNldCkge1xuICAgICAgICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9ICFmaWVsZHNldC5kaXNhYmxlZDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoJ2EnID09PSBub2RlTmFtZSkge1xuICAgICAgZm9jdXNhYmxlSWZWaXNpYmxlID0gZWxlbWVudC5ocmVmIHx8IGhhc1RhYmluZGV4O1xuICAgIH0gZWxzZSB7XG4gICAgICBmb2N1c2FibGVJZlZpc2libGUgPSBoYXNUYWJpbmRleDtcbiAgICB9XG4gICAgZm9jdXNhYmxlSWZWaXNpYmxlID0gZm9jdXNhYmxlSWZWaXNpYmxlIHx8ICQoZWxlbWVudCkuaXMoJ1tjb250ZW50ZWRpdGFibGVdJyk7XG4gICAgcmV0dXJuIGZvY3VzYWJsZUlmVmlzaWJsZSAmJiAkKGVsZW1lbnQpLmlzKCc6dmlzaWJsZScpO1xuICB9O1xuXG4gIFBhc3RlID0gKGZ1bmN0aW9uKCkge1xuICAgIFBhc3RlLnByb3RvdHlwZS5fdGFyZ2V0ID0gbnVsbDtcblxuICAgIFBhc3RlLnByb3RvdHlwZS5fY29udGFpbmVyID0gbnVsbDtcblxuICAgIFBhc3RlLm1vdW50Tm9uSW5wdXRhYmxlID0gZnVuY3Rpb24obm9uSW5wdXRhYmxlKSB7XG4gICAgICB2YXIgcGFzdGU7XG4gICAgICBwYXN0ZSA9IG5ldyBQYXN0ZShjcmVhdGVIaWRkZW5FZGl0YWJsZSgpLmFwcGVuZFRvKG5vbklucHV0YWJsZSksIG5vbklucHV0YWJsZSk7XG4gICAgICAkKG5vbklucHV0YWJsZSkub24oJ2NsaWNrJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihldikge1xuICAgICAgICAgIGlmICghaXNGb2N1c2FibGUoZXYudGFyZ2V0LCBmYWxzZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXN0ZS5fY29udGFpbmVyLmZvY3VzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgcGFzdGUuX2NvbnRhaW5lci5vbignZm9jdXMnLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAkKG5vbklucHV0YWJsZSkuYWRkQ2xhc3MoJ3Bhc3RhYmxlLWZvY3VzJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICByZXR1cm4gcGFzdGUuX2NvbnRhaW5lci5vbignYmx1cicsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuICQobm9uSW5wdXRhYmxlKS5yZW1vdmVDbGFzcygncGFzdGFibGUtZm9jdXMnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgUGFzdGUubW91bnRUZXh0YXJlYSA9IGZ1bmN0aW9uKHRleHRhcmVhKSB7XG4gICAgICB2YXIgY3RsRG93biwgcGFzdGUsIHJlZiwgcmVmMTtcbiAgICAgIGlmICgodHlwZW9mIERhdGFUcmFuc2ZlciAhPT0gXCJ1bmRlZmluZWRcIiAmJiBEYXRhVHJhbnNmZXIgIT09IG51bGwgPyBEYXRhVHJhbnNmZXIucHJvdG90eXBlIDogdm9pZCAwKSAmJiAoKHJlZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IpICE9IG51bGwgPyAocmVmMSA9IHJlZi5jYWxsKE9iamVjdCwgRGF0YVRyYW5zZmVyLnByb3RvdHlwZSwgJ2l0ZW1zJykpICE9IG51bGwgPyByZWYxLmdldCA6IHZvaWQgMCA6IHZvaWQgMCkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubW91bnRDb250ZW50ZWRpdGFibGUodGV4dGFyZWEpO1xuICAgICAgfVxuICAgICAgcGFzdGUgPSBuZXcgUGFzdGUoY3JlYXRlSGlkZGVuRWRpdGFibGUoKS5pbnNlcnRCZWZvcmUodGV4dGFyZWEpLCB0ZXh0YXJlYSk7XG4gICAgICBjdGxEb3duID0gZmFsc2U7XG4gICAgICAkKHRleHRhcmVhKS5vbigna2V5dXAnLCBmdW5jdGlvbihldikge1xuICAgICAgICB2YXIgcmVmMjtcbiAgICAgICAgaWYgKChyZWYyID0gZXYua2V5Q29kZSkgPT09IDE3IHx8IHJlZjIgPT09IDIyNCkge1xuICAgICAgICAgIGN0bERvd24gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0pO1xuICAgICAgJCh0ZXh0YXJlYSkub24oJ2tleWRvd24nLCBmdW5jdGlvbihldikge1xuICAgICAgICB2YXIgcmVmMjtcbiAgICAgICAgaWYgKChyZWYyID0gZXYua2V5Q29kZSkgPT09IDE3IHx8IHJlZjIgPT09IDIyNCkge1xuICAgICAgICAgIGN0bERvd24gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoZXYuY3RybEtleSAhPSBudWxsKSAmJiAoZXYubWV0YUtleSAhPSBudWxsKSkge1xuICAgICAgICAgIGN0bERvd24gPSBldi5jdHJsS2V5IHx8IGV2Lm1ldGFLZXk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN0bERvd24gJiYgZXYua2V5Q29kZSA9PT0gODYpIHtcbiAgICAgICAgICBwYXN0ZS5fdGV4dGFyZWFfZm9jdXNfc3RvbGVuID0gdHJ1ZTtcbiAgICAgICAgICBwYXN0ZS5fY29udGFpbmVyLmZvY3VzKCk7XG4gICAgICAgICAgcGFzdGUuX3Bhc3RlX2V2ZW50X2ZpcmVkID0gZmFsc2U7XG4gICAgICAgICAgc2V0VGltZW91dCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgaWYgKCFwYXN0ZS5fcGFzdGVfZXZlbnRfZmlyZWQpIHtcbiAgICAgICAgICAgICAgICAkKHRleHRhcmVhKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXN0ZS5fdGV4dGFyZWFfZm9jdXNfc3RvbGVuID0gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSkodGhpcyksIDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSk7XG4gICAgICAkKHRleHRhcmVhKS5vbigncGFzdGUnLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge307XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICAkKHRleHRhcmVhKS5vbignZm9jdXMnLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmICghcGFzdGUuX3RleHRhcmVhX2ZvY3VzX3N0b2xlbikge1xuICAgICAgICAgICAgcmV0dXJuICQodGV4dGFyZWEpLmFkZENsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgICQodGV4dGFyZWEpLm9uKCdibHVyJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAoIXBhc3RlLl90ZXh0YXJlYV9mb2N1c19zdG9sZW4pIHtcbiAgICAgICAgICAgIHJldHVybiAkKHRleHRhcmVhKS5yZW1vdmVDbGFzcygncGFzdGFibGUtZm9jdXMnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICAkKHBhc3RlLl90YXJnZXQpLm9uKCdfcGFzdGVDaGVja0NvbnRhaW5lckRvbmUnLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICQodGV4dGFyZWEpLmZvY3VzKCk7XG4gICAgICAgICAgcmV0dXJuIHBhc3RlLl90ZXh0YXJlYV9mb2N1c19zdG9sZW4gPSBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgIHJldHVybiAkKHBhc3RlLl90YXJnZXQpLm9uKCdwYXN0ZVRleHQnLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGV2LCBkYXRhKSB7XG4gICAgICAgICAgdmFyIGNvbnRlbnQsIGN1ckVuZCwgY3VyU3RhcnQ7XG4gICAgICAgICAgY3VyU3RhcnQgPSAkKHRleHRhcmVhKS5wcm9wKCdzZWxlY3Rpb25TdGFydCcpO1xuICAgICAgICAgIGN1ckVuZCA9ICQodGV4dGFyZWEpLnByb3AoJ3NlbGVjdGlvbkVuZCcpO1xuICAgICAgICAgIGNvbnRlbnQgPSAkKHRleHRhcmVhKS52YWwoKTtcbiAgICAgICAgICAkKHRleHRhcmVhKS52YWwoXCJcIiArIGNvbnRlbnQuc2xpY2UoMCwgY3VyU3RhcnQpICsgZGF0YS50ZXh0ICsgY29udGVudC5zbGljZShjdXJFbmQpKTtcbiAgICAgICAgICAkKHRleHRhcmVhKVswXS5zZXRTZWxlY3Rpb25SYW5nZShjdXJTdGFydCArIGRhdGEudGV4dC5sZW5ndGgsIGN1clN0YXJ0ICsgZGF0YS50ZXh0Lmxlbmd0aCk7XG4gICAgICAgICAgcmV0dXJuICQodGV4dGFyZWEpLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH07XG5cbiAgICBQYXN0ZS5tb3VudENvbnRlbnRlZGl0YWJsZSA9IGZ1bmN0aW9uKGNvbnRlbnRlZGl0YWJsZSkge1xuICAgICAgdmFyIHBhc3RlO1xuICAgICAgcGFzdGUgPSBuZXcgUGFzdGUoY29udGVudGVkaXRhYmxlLCBjb250ZW50ZWRpdGFibGUpO1xuICAgICAgJChjb250ZW50ZWRpdGFibGUpLm9uKCdmb2N1cycsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuICQoY29udGVudGVkaXRhYmxlKS5hZGRDbGFzcygncGFzdGFibGUtZm9jdXMnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgIHJldHVybiAkKGNvbnRlbnRlZGl0YWJsZSkub24oJ2JsdXInLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAkKGNvbnRlbnRlZGl0YWJsZSkucmVtb3ZlQ2xhc3MoJ3Bhc3RhYmxlLWZvY3VzJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIFBhc3RlKF9jb250YWluZXIsIF90YXJnZXQpIHtcbiAgICAgIHRoaXMuX2NvbnRhaW5lciA9IF9jb250YWluZXI7XG4gICAgICB0aGlzLl90YXJnZXQgPSBfdGFyZ2V0O1xuICAgICAgdGhpcy5fY29udGFpbmVyID0gJCh0aGlzLl9jb250YWluZXIpO1xuICAgICAgdGhpcy5fdGFyZ2V0ID0gJCh0aGlzLl90YXJnZXQpLmFkZENsYXNzKCdwYXN0YWJsZScpO1xuICAgICAgdGhpcy5fY29udGFpbmVyLm9uKCdwYXN0ZScsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICB2YXIgY2xpcGJvYXJkRGF0YSwgZmlsZSwgaXRlbSwgaiwgaywgbGVuLCBsZW4xLCByZWFkZXIsIHJlZiwgcmVmMSwgcmVmMiwgcmVmMywgdGV4dDtcbiAgICAgICAgICBpZiAoZXYuY3VycmVudFRhcmdldCAhPT0gZXYudGFyZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgX3RoaXMuX3Bhc3RlX2V2ZW50X2ZpcmVkID0gdHJ1ZTtcbiAgICAgICAgICBpZiAoKChyZWYgPSBldi5vcmlnaW5hbEV2ZW50KSAhPSBudWxsID8gcmVmLmNsaXBib2FyZERhdGEgOiB2b2lkIDApICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNsaXBib2FyZERhdGEgPSBldi5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGE7XG4gICAgICAgICAgICBpZiAoY2xpcGJvYXJkRGF0YS5pdGVtcykge1xuICAgICAgICAgICAgICByZWYxID0gY2xpcGJvYXJkRGF0YS5pdGVtcztcbiAgICAgICAgICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmMS5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICAgICAgICAgIGl0ZW0gPSByZWYxW2pdO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGUubWF0Y2goL15pbWFnZVxcLy8pKSB7XG4gICAgICAgICAgICAgICAgICByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5faGFuZGxlSW1hZ2UoZXZlbnQudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaXRlbS5nZXRBc0ZpbGUoKSk7XG4gICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gJ3RleHQvcGxhaW4nKSB7XG4gICAgICAgICAgICAgICAgICBpdGVtLmdldEFzU3RyaW5nKGZ1bmN0aW9uKHN0cmluZykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZVRleHQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpZiAoLTEgIT09IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoY2xpcGJvYXJkRGF0YS50eXBlcywgJ3RleHQvcGxhaW4nKSkge1xuICAgICAgICAgICAgICAgIHRleHQgPSBjbGlwYm9hcmREYXRhLmdldERhdGEoJ1RleHQnKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVUZXh0Jywge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCAxKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBfdGhpcy5fY2hlY2tJbWFnZXNJbkNvbnRhaW5lcihmdW5jdGlvbihzcmMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX2hhbmRsZUltYWdlKHNyYyk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2xpcGJvYXJkRGF0YSA9IHdpbmRvdy5jbGlwYm9hcmREYXRhKSB7XG4gICAgICAgICAgICBpZiAoKHJlZjIgPSAodGV4dCA9IGNsaXBib2FyZERhdGEuZ2V0RGF0YSgnVGV4dCcpKSkgIT0gbnVsbCA/IHJlZjIubGVuZ3RoIDogdm9pZCAwKSB7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZVRleHQnLCB7XG4gICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl90YXJnZXQudHJpZ2dlcignX3Bhc3RlQ2hlY2tDb250YWluZXJEb25lJyk7XG4gICAgICAgICAgICAgIH0sIDEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVmMyA9IGNsaXBib2FyZERhdGEuZmlsZXM7XG4gICAgICAgICAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYzLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICAgICAgICAgIGZpbGUgPSByZWYzW2tdO1xuICAgICAgICAgICAgICAgIF90aGlzLl9oYW5kbGVJbWFnZShVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBfdGhpcy5fY2hlY2tJbWFnZXNJbkNvbnRhaW5lcihmdW5jdGlvbihzcmMpIHt9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfVxuXG4gICAgUGFzdGUucHJvdG90eXBlLl9oYW5kbGVJbWFnZSA9IGZ1bmN0aW9uKHNyYykge1xuICAgICAgdmFyIGxvYWRlcjtcbiAgICAgIGlmIChzcmMubWF0Y2goL153ZWJraXRcXC1mYWtlXFwtdXJsXFw6XFwvXFwvLykpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZUltYWdlRXJyb3InLCB7XG4gICAgICAgICAgbWVzc2FnZTogXCJZb3UgYXJlIHRyeWluZyB0byBwYXN0ZSBhbiBpbWFnZSBpbiBTYWZhcmksIGhvd2V2ZXIgd2UgYXJlIHVuYWJsZSB0byByZXRpZXZlIGl0cyBkYXRhLlwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlSW1hZ2VTdGFydCcpO1xuICAgICAgbG9hZGVyID0gbmV3IEltYWdlKCk7XG4gICAgICBsb2FkZXIuY3Jvc3NPcmlnaW4gPSBcImFub255bW91c1wiO1xuICAgICAgbG9hZGVyLm9ubG9hZCA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIGJsb2IsIGNhbnZhcywgY3R4LCBkYXRhVVJMO1xuICAgICAgICAgIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGxvYWRlci53aWR0aDtcbiAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gbG9hZGVyLmhlaWdodDtcbiAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICBjdHguZHJhd0ltYWdlKGxvYWRlciwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgICBkYXRhVVJMID0gbnVsbDtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZGF0YVVSTCA9IGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpO1xuICAgICAgICAgICAgYmxvYiA9IGRhdGFVUkx0b0Jsb2IoZGF0YVVSTCk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHt9XG4gICAgICAgICAgaWYgKGRhdGFVUkwpIHtcbiAgICAgICAgICAgIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVJbWFnZScsIHtcbiAgICAgICAgICAgICAgYmxvYjogYmxvYixcbiAgICAgICAgICAgICAgZGF0YVVSTDogZGF0YVVSTCxcbiAgICAgICAgICAgICAgd2lkdGg6IGxvYWRlci53aWR0aCxcbiAgICAgICAgICAgICAgaGVpZ2h0OiBsb2FkZXIuaGVpZ2h0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVJbWFnZUVuZCcpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcyk7XG4gICAgICBsb2FkZXIub25lcnJvciA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZUltYWdlRXJyb3InLCB7XG4gICAgICAgICAgICBtZXNzYWdlOiBcIkZhaWxlZCB0byBnZXQgaW1hZ2UgZnJvbTogXCIgKyBzcmMsXG4gICAgICAgICAgICB1cmw6IHNyY1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlSW1hZ2VFbmQnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpO1xuICAgICAgcmV0dXJuIGxvYWRlci5zcmMgPSBzcmM7XG4gICAgfTtcblxuICAgIFBhc3RlLnByb3RvdHlwZS5fY2hlY2tJbWFnZXNJbkNvbnRhaW5lciA9IGZ1bmN0aW9uKGNiKSB7XG4gICAgICB2YXIgaW1nLCBqLCBsZW4sIHJlZiwgdGltZXNwYW47XG4gICAgICB0aW1lc3BhbiA9IE1hdGguZmxvb3IoMTAwMCAqIE1hdGgucmFuZG9tKCkpO1xuICAgICAgcmVmID0gdGhpcy5fY29udGFpbmVyLmZpbmQoJ2ltZycpO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGltZyA9IHJlZltqXTtcbiAgICAgICAgaW1nW1wiX3Bhc3RlX21hcmtlZF9cIiArIHRpbWVzcGFuXSA9IHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gc2V0VGltZW91dCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBrLCBsZW4xLCByZWYxO1xuICAgICAgICAgIHJlZjEgPSBfdGhpcy5fY29udGFpbmVyLmZpbmQoJ2ltZycpO1xuICAgICAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYxLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICAgICAgaW1nID0gcmVmMVtrXTtcbiAgICAgICAgICAgIGlmICghaW1nW1wiX3Bhc3RlX21hcmtlZF9cIiArIHRpbWVzcGFuXSkge1xuICAgICAgICAgICAgICBjYihpbWcuc3JjKTtcbiAgICAgICAgICAgICAgJChpbWcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdfcGFzdGVDaGVja0NvbnRhaW5lckRvbmUnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpLCAxKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFBhc3RlO1xuXG4gIH0pKCk7XG5cbn0pLmNhbGwodGhpcyk7XG4iLCJ2YXIgdGhlcGFzdGVQbHVnaW5DYWxsYmFjaztcblxuKGZ1bmN0aW9uKCQpe1xuXHR0aGVwYXN0ZVBsdWdpbkNhbGxiYWNrID0gZnVuY3Rpb24oIGVkaXRvciApIHtcblx0XHR2YXIgcGFzdGVCdG4sXG5cdFx0XHRvcmlnRG9tQWRkLFxuXHRcdFx0Y2xpcGJvYXJkSGFzSW1hZ2UgPSBmYWxzZSxcblx0XHRcdGN1cnJlbnRDbGlwYm9hcmRFdmVudCA9IG51bGwsXG5cdFx0XHRwcmV2ZW50SW1hZ2VQYXN0ZSA9IGZhbHNlLFxuXHRcdFx0dGhlcGFzdGUgPSB3cC5tZWRpYS50aGVwYXN0ZSxcblx0XHRcdHRvb2xiYXI7XG5cblx0XHR0aGVwYXN0ZS5vcHRpb25zLmVkaXRvci5hdXRvX3VwbG9hZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCAndGhlcGFzdGUuYXV0b191cGxvYWQnICkgIT09ICdmYWxzZSc7XG5cdFx0Ly8gZGVmYXVsdCBvblxuXG5cdFx0ZnVuY3Rpb24gZG9tQWRkKCkge1xuXHRcdFx0dmFyIHJlc3VsdCA9IG9yaWdEb21BZGQuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXHRcdFx0aWYgKCAnbWNlcGFzdGViaW4nID09PSAkKHJlc3VsdCkuYXR0cignaWQnKSApIHtcblx0XHRcdFx0JChyZXN1bHQpXG5cdFx0XHRcdFx0LnBhc3RhYmxlQ29udGVudGVkaXRhYmxlKClcblx0XHRcdFx0XHQub24oJ3Bhc3RlJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbigncGFzdGVJbWFnZScsZnVuY3Rpb24oIGUsIGRhdGEgKSB7XG5cdFx0XHRcdFx0XHR2YXIgaW1hZ2U7XG5cdFx0XHRcdFx0XHRpZiAoIHByZXZlbnRJbWFnZVBhc3RlICkge1xuXHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGltYWdlID0gdGhlcGFzdGUuaW5zZXJ0SW1hZ2UoIGRhdGEuZGF0YVVSTCwgZGF0YS5ibG9iLnR5cGUsIGVkaXRvciApO1xuXHRcdFx0XHRcdFx0aWYgKCB0aGVwYXN0ZS5vcHRpb25zLmVkaXRvci5hdXRvX3VwbG9hZCApIHtcblx0XHRcdFx0XHRcdFx0dGhlcGFzdGUudXBsb2FkSW1hZ2UoIGltYWdlLCBlZGl0b3IgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2V0dXBFZGl0b3JEb20oKSB7XG5cblx0XHRcdG9yaWdEb21BZGQgPSBlZGl0b3IuZG9tLmFkZDtcblxuXHRcdFx0ZWRpdG9yLmRvbS5hZGQgPSBkb21BZGQ7XG5cblx0XHRcdCQoZWRpdG9yLmRvbS5kb2MpLm9uKCAncGFzdGUnLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0Y3VycmVudENsaXBib2FyZEV2ZW50ID0gZS5vcmlnaW5hbEV2ZW50O1xuXHRcdFx0XHRjb25zb2xlLmxvZyhjdXJyZW50Q2xpcGJvYXJkRXZlbnQuY2xpcGJvYXJkRGF0YS50eXBlcyk7XG5cdFx0XHRcdGNsaXBib2FyZEhhc0ltYWdlID0gdGhlcGFzdGUuY2xpcGJvYXJkSGFzSW1hZ2UoZS5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEpO1xuXHRcdFx0XHRwcmV2ZW50SW1hZ2VQYXN0ZSA9IGZhbHNlO1xuXHRcdFx0fSApO1xuXHRcdH1cblx0XHRlZGl0b3IuYWRkQ29tbWFuZCggJ2NtZF90aGVwYXN0ZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhlcGFzdGUub3B0aW9ucy5lZGl0b3IuYXV0b191cGxvYWQgPSAhIHRoZXBhc3RlLm9wdGlvbnMuZWRpdG9yLmF1dG9fdXBsb2FkO1xuXHRcdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oICd0aGVwYXN0ZS5hdXRvX3VwbG9hZCcsIHRoZXBhc3RlLm9wdGlvbnMuZWRpdG9yLmF1dG9fdXBsb2FkLnRvU3RyaW5nKCkgKTtcblx0XHRcdHBhc3RlQnRuLmFjdGl2ZSggdGhlcGFzdGUub3B0aW9ucy5lZGl0b3IuYXV0b191cGxvYWQgKTtcblx0XHR9KTtcblxuXG5cdFx0ZWRpdG9yLmFkZEJ1dHRvbigndGhlcGFzdGUnLCB7XG5cdFx0XHRpY29uOiAndGhlcGFzdGUnLFxuXHRcdFx0dG9vbHRpcDogdGhlcGFzdGUubDEwbi51cGxvYWRfcGFzdGVkX2ltYWdlcyxcblx0XHRcdGNtZCA6ICdjbWRfdGhlcGFzdGUnLFxuXHRcdFx0b25Qb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0cGFzdGVCdG4gPSB0aGlzO1xuXHRcdFx0fSxcblx0XHRcdGFjdGl2ZTp0aGVwYXN0ZS5vcHRpb25zLmVkaXRvci5hdXRvX3VwbG9hZFxuXHRcdH0pO1xuXG5cdFx0ZWRpdG9yLmFkZEJ1dHRvbignd3BfaW1nX3RoZXBhc3RlX3VwbG9hZCcsIHtcblx0XHRcdGljb246ICdkYXNoaWNvbiBkYXNoaWNvbnMgZGFzaGljb25zLXVwbG9hZCB0aGVwYXN0ZS11cGxvYWQnLFxuXHRcdFx0dG9vbHRpcDogdGhlcGFzdGUubDEwbi51cGxvYWRfaW1hZ2UsXG5cdFx0XHRvbmNsaWNrOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0Ly8gd3JhcCBpbWcsIHVwbG9hZFxuXHRcdFx0XHR2YXIgaW1hZ2U7XG5cdFx0XHRcdGltYWdlID0gZWRpdG9yLnNlbGVjdGlvbi5nZXROb2RlKCk7XG4vL2NvbnNvbGUubG9nKGltYWdlKTtcblx0XHRcdFx0dGhlcGFzdGUudXBsb2FkSW1hZ2UoIGltYWdlLCBlZGl0b3IgKTtcblx0XHRcdH1cdFx0XHRcblx0XHR9KTtcblxuXHRcdGVkaXRvci5vbmNlKCAncHJlaW5pdCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCBlZGl0b3Iud3AgJiYgZWRpdG9yLndwLl9jcmVhdGVUb29sYmFyICkge1xuXHRcdFx0XHR0b29sYmFyID0gZWRpdG9yLndwLl9jcmVhdGVUb29sYmFyKCBbXG5cdFx0XHRcdFx0J3dwX2ltZ19hbGlnbmxlZnQnLFxuXHRcdFx0XHRcdCd3cF9pbWdfYWxpZ25jZW50ZXInLFxuXHRcdFx0XHRcdCd3cF9pbWdfYWxpZ25yaWdodCcsXG5cdFx0XHRcdFx0J3dwX2ltZ19hbGlnbm5vbmUnLFxuXHRcdFx0XHRcdCd3cF9pbWdfdGhlcGFzdGVfdXBsb2FkJyxcblx0XHRcdFx0XHQnd3BfaW1nX2VkaXQnLFxuXHRcdFx0XHRcdCd3cF9pbWdfcmVtb3ZlJyxcblx0XHRcdFx0XSApO1xuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdGVkaXRvci5vbiggJ3dwdG9vbGJhcicsIGZ1bmN0aW9uKCBldmVudCApIHtcblx0XHRcdHZhciBjYW5VcGxvYWQgPSBmYWxzZSxcblx0XHRcdFx0dXBsb2FkQnRuO1xuXHRcdFx0aWYgKCBldmVudC5lbGVtZW50Lm5vZGVOYW1lID09PSAnSU1HJyAmJiAhIGVkaXRvci53cC5pc1BsYWNlaG9sZGVyKCBldmVudC5lbGVtZW50ICkgKSB7XG5cdFx0XHRcdGV2ZW50LnRvb2xiYXIgPSB0b29sYmFyO1xuXHRcdFx0XHRjYW5VcGxvYWQgPSAhISBldmVudC5lbGVtZW50LnNyYy5tYXRjaCggL14oYmxvYnxkYXRhKTovICk7XG5cdFx0XHRcdHVwbG9hZEJ0biA9IHRvb2xiYXIuJGVsLmZpbmQoJy50aGVwYXN0ZS11cGxvYWQnKS5jbG9zZXN0KCcubWNlLWJ0bicpO1xuXG5cdFx0XHRcdGlmICggY2FuVXBsb2FkICkge1xuXHRcdFx0XHRcdHVwbG9hZEJ0bi5zaG93KCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dXBsb2FkQnRuLmhpZGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdGVkaXRvclxuXHRcdFx0Lm9uKCAnaW5pdCcsIHNldHVwRWRpdG9yRG9tIClcblx0XHRcdC5vbiggJ0JlZm9yZVBhc3RlUHJlUHJvY2VzcycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoICBlLmNvbnRlbnQubWF0Y2goIC8mbHQ7c3ZnW1xcc1xcUy5dKiZsdDtcXC9zdmcmZ3Q7L2kgKSApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0ZS5jb250ZW50ID0gJyc7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCBjbGlwYm9hcmRIYXNJbWFnZSApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0ZS5jb250ZW50ID0gJyc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIGU7XG5cblx0XHRcdH0gKTtcblxuXHR9O1xuXG5cdHRpbnltY2UuUGx1Z2luTWFuYWdlci5hZGQoICd0aGVwYXN0ZScsIHRoZXBhc3RlUGx1Z2luQ2FsbGJhY2sgKTtcblxufSApKGpRdWVyeSk7XG5cbiJdfQ==
