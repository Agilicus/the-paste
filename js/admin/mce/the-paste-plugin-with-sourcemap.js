(function(){var t,e,n,r,a;t=window.jQuery,t.paste=function(t){var n;return"undefined"!=typeof console&&null!==console&&console.log("DEPRECATED: This method is deprecated. Please use $.fn.pastableNonInputable() instead."),n=e.mountNonInputable(t),n._container},t.fn.pastableNonInputable=function(){var n,r,a,o;for(o=this,r=0,a=o.length;r<a;r++)n=o[r],n._pastable||t(n).is("textarea, input:text, [contenteditable]")||(e.mountNonInputable(n),n._pastable=!0);return this},t.fn.pastableTextarea=function(){var n,r,a,o;for(o=this,r=0,a=o.length;r<a;r++)n=o[r],n._pastable||t(n).is(":not(textarea, input:text)")||(e.mountTextarea(n),n._pastable=!0);return this},t.fn.pastableContenteditable=function(){var n,r,a,o;for(o=this,r=0,a=o.length;r<a;r++)n=o[r],n._pastable||t(n).is(":not([contenteditable])")||(e.mountContenteditable(n),n._pastable=!0);return this},r=function(t,e){var n,r,a,o,i,u,s,l,c,f,g;if(null==e&&(e=512),!(l=t.match(/^data\:([^\;]+)\;base64\,(.+)$/)))return null;for(f=l,l=f[0],u=f[1],n=f[2],o=atob(n),a=[],c=0;c<o.length;){for(g=o.slice(c,c+e),i=new Array(g.length),s=0;s<g.length;)i[s]=g.charCodeAt(s),s++;r=new Uint8Array(i),a.push(r),c+=e}return new Blob(a,{type:u})},n=function(){return t(document.createElement("div")).attr("contenteditable",!0).attr("aria-hidden",!0).attr("tabindex",-1).css({width:1,height:1,position:"fixed",left:-100,overflow:"hidden"})},a=function(e,n){var r,a,o,i,u,s;return i=void 0,u=void 0,o=void 0,a=void 0,r=void 0,"area"===(s=e.nodeName.toLowerCase())?(i=e.parentNode,u=i.name,!(!e.href||!u||"map"!==i.nodeName.toLowerCase())&&(o=t("img[usemap='#"+u+"']"),o.length>0&&o.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(s)?(a=!e.disabled)&&(r=t(e).closest("fieldset")[0])&&(a=!r.disabled):a="a"===s?e.href||n:n,(a=a||t(e).is("[contenteditable]"))&&t(e).is(":visible"))},e=function(){function e(e,n){this._container=e,this._target=n,this._container=t(this._container),this._target=t(this._target).addClass("pastable"),this._container.on("paste",function(t){return function(e){var n,r,a,o,i,u,s,l,c,f,g,d,p;if(e.currentTarget!==e.target)return e.preventDefault();if(t._paste_event_fired=!0,null!=(null!=(c=e.originalEvent)?c.clipboardData:void 0))if(n=e.originalEvent.clipboardData,n.items)for(f=n.items,o=0,u=f.length;o<u;o++){if(a=f[o],a.type.match(/^image\//)){l=new FileReader,l.onload=function(e){return t._handleImage(e.target.result)};try{l.readAsDataURL(a.getAsFile())}catch(t){}e.preventDefault();break}"text/plain"===a.type&&a.getAsString(function(e){return t._target.trigger("pasteText",{text:e})})}else-1!==Array.prototype.indexOf.call(n.types,"text/plain")&&(p=n.getData("Text"),setTimeout(function(){return t._target.trigger("pasteText",{text:p})},1)),t._checkImagesInContainer(function(e){return t._handleImage(e)});if(n=window.clipboardData)if(null!=(g=p=n.getData("Text"))?g.length:void 0)setTimeout(function(){return t._target.trigger("pasteText",{text:p}),t._target.trigger("_pasteCheckContainerDone")},1);else{for(d=n.files,i=0,s=d.length;i<s;i++)r=d[i],t._handleImage(URL.createObjectURL(r));t._checkImagesInContainer(function(t){})}return null}}(this))}return e.prototype._target=null,e.prototype._container=null,e.mountNonInputable=function(r){var o;return o=new e(n().appendTo(r),r),t(r).on("click",function(t){return function(t){if(!a(t.target,!1))return o._container.focus()}}()),o._container.on("focus",function(e){return function(){return t(r).addClass("pastable-focus")}}()),o._container.on("blur",function(e){return function(){return t(r).removeClass("pastable-focus")}}())},e.mountTextarea=function(r){var a,o,i,u;return("undefined"!=typeof DataTransfer&&null!==DataTransfer?DataTransfer.prototype:void 0)&&(null!=(i=Object.getOwnPropertyDescriptor)&&null!=(u=i.call(Object,DataTransfer.prototype,"items"))?u.get:void 0)?this.mountContenteditable(r):(o=new e(n().insertBefore(r),r),a=!1,t(r).on("keyup",function(t){var e;return 17!==(e=t.keyCode)&&224!==e||(a=!1),null}),t(r).on("keydown",function(e){var n;return 17!==(n=e.keyCode)&&224!==n||(a=!0),null!=e.ctrlKey&&null!=e.metaKey&&(a=e.ctrlKey||e.metaKey),a&&86===e.keyCode&&(o._textarea_focus_stolen=!0,o._container.focus(),o._paste_event_fired=!1,setTimeout(function(e){return function(){if(!o._paste_event_fired)return t(r).focus(),o._textarea_focus_stolen=!1}}(),1)),null}),t(r).on("paste",function(t){return function(){}}()),t(r).on("focus",function(e){return function(){if(!o._textarea_focus_stolen)return t(r).addClass("pastable-focus")}}()),t(r).on("blur",function(e){return function(){if(!o._textarea_focus_stolen)return t(r).removeClass("pastable-focus")}}()),t(o._target).on("_pasteCheckContainerDone",function(e){return function(){return t(r).focus(),o._textarea_focus_stolen=!1}}()),t(o._target).on("pasteText",function(e){return function(e,n){var a,o,i;return i=t(r).prop("selectionStart"),o=t(r).prop("selectionEnd"),a=t(r).val(),t(r).val(""+a.slice(0,i)+n.text+a.slice(o)),t(r)[0].setSelectionRange(i+n.text.length,i+n.text.length),t(r).trigger("change")}}()))},e.mountContenteditable=function(n){return new e(n,n),t(n).on("focus",function(e){return function(){return t(n).addClass("pastable-focus")}}()),t(n).on("blur",function(e){return function(){return t(n).removeClass("pastable-focus")}}())},e.prototype._handleImage=function(t){var e;return t.match(/^webkit\-fake\-url\:\/\//)?this._target.trigger("pasteImageError",{message:"You are trying to paste an image in Safari, however we are unable to retieve its data."}):(this._target.trigger("pasteImageStart"),e=new Image,e.crossOrigin="anonymous",e.onload=function(t){return function(){var n,a,o,i;a=document.createElement("canvas"),a.width=e.width,a.height=e.height,o=a.getContext("2d"),o.drawImage(e,0,0,a.width,a.height),i=null;try{i=a.toDataURL("image/png"),n=r(i)}catch(t){}return i&&t._target.trigger("pasteImage",{blob:n,dataURL:i,width:e.width,height:e.height}),t._target.trigger("pasteImageEnd")}}(this),e.onerror=function(e){return function(){return e._target.trigger("pasteImageError",{message:"Failed to get image from: "+t,url:t}),e._target.trigger("pasteImageEnd")}}(this),e.src=t)},e.prototype._checkImagesInContainer=function(e){var n,r,a,o,i;for(i=Math.floor(1e3*Math.random()),o=this._container.find("img"),r=0,a=o.length;r<a;r++)n=o[r],n["_paste_marked_"+i]=!0;return setTimeout(function(r){return function(){var a,o,u;for(u=r._container.find("img"),a=0,o=u.length;a<o;a++)n=u[a],n["_paste_marked_"+i]||(e(n.src),t(n).remove());return r._target.trigger("_pasteCheckContainerDone")}}(this),1)},e}()}).call(this);
var thepastePluginCallback;!function(t){thepastePluginCallback=function(e){function a(){var a=i.apply(this,arguments);return"mcepastebin"===t(a).attr("id")&&t(a).pastableContenteditable().on("paste",function(t){}).on("pasteImage",function(t,a){if(s)return t.preventDefault(),!1;wp.media.thepaste.insertImage(a.dataURL,a.blob.type,e)}),a}function n(){i=e.dom.add,e.dom.add=a,t(e.dom.doc).on("paste",function(t){p=t.originalEvent,console.log(p.clipboardData.types),l=wp.media.thepaste.clipboardHasImage(t.originalEvent.clipboardData),s=!1})}var o,i,c=!1,l=!1,p=null,s=!1;e.addCommand("cmd_thepaste",function(){c=!c,o.active(c)}),e.addButton("thepaste",{icon:"thepaste",tooltip:"",cmd:"cmd_thepaste",onPostRender:function(){o=this}}),e.on("init",n).on("BeforePastePreProcess",function(t){return t.content.match(/&lt;svg[\s\S.]*&lt;\/svg&gt;/i)&&(t.preventDefault(),t.content=""),l&&(t.preventDefault(),t.content=""),t})},tinymce.PluginManager.add("thepaste",thepastePluginCallback)}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhc3RlLmpzIiwidGhlLXBhc3RlLXBsdWdpbi5qcyJdLCJuYW1lcyI6WyIkIiwiUGFzdGUiLCJjcmVhdGVIaWRkZW5FZGl0YWJsZSIsImRhdGFVUkx0b0Jsb2IiLCJpc0ZvY3VzYWJsZSIsIndpbmRvdyIsImpRdWVyeSIsInBhc3RlIiwicGFzdGVDb250YWluZXIiLCJwbSIsImNvbnNvbGUiLCJsb2ciLCJtb3VudE5vbklucHV0YWJsZSIsIl9jb250YWluZXIiLCJmbiIsInBhc3RhYmxlTm9uSW5wdXRhYmxlIiwiZWwiLCJqIiwibGVuIiwicmVmIiwidGhpcyIsImxlbmd0aCIsIl9wYXN0YWJsZSIsImlzIiwicGFzdGFibGVUZXh0YXJlYSIsIm1vdW50VGV4dGFyZWEiLCJwYXN0YWJsZUNvbnRlbnRlZGl0YWJsZSIsIm1vdW50Q29udGVudGVkaXRhYmxlIiwiZGF0YVVSTCIsInNsaWNlU2l6ZSIsImI2NERhdGEiLCJieXRlQXJyYXkiLCJieXRlQXJyYXlzIiwiYnl0ZUNoYXJhY3RlcnMiLCJieXRlTnVtYmVycyIsImNvbnRlbnRUeXBlIiwiaSIsIm0iLCJvZmZzZXQiLCJzbGljZSIsIm1hdGNoIiwiYXRvYiIsIkFycmF5IiwiY2hhckNvZGVBdCIsIlVpbnQ4QXJyYXkiLCJwdXNoIiwiQmxvYiIsInR5cGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJhdHRyIiwiY3NzIiwid2lkdGgiLCJoZWlnaHQiLCJwb3NpdGlvbiIsImxlZnQiLCJvdmVyZmxvdyIsImVsZW1lbnQiLCJoYXNUYWJpbmRleCIsImZpZWxkc2V0IiwiZm9jdXNhYmxlSWZWaXNpYmxlIiwiaW1nIiwibWFwIiwibWFwTmFtZSIsIm5vZGVOYW1lIiwidG9Mb3dlckNhc2UiLCJwYXJlbnROb2RlIiwibmFtZSIsImhyZWYiLCJ0ZXN0IiwiZGlzYWJsZWQiLCJjbG9zZXN0IiwiX3RhcmdldCIsImFkZENsYXNzIiwib24iLCJfdGhpcyIsImV2IiwiY2xpcGJvYXJkRGF0YSIsImZpbGUiLCJpdGVtIiwiayIsImxlbjEiLCJyZWFkZXIiLCJyZWYxIiwicmVmMiIsInJlZjMiLCJ0ZXh0IiwiY3VycmVudFRhcmdldCIsInRhcmdldCIsInByZXZlbnREZWZhdWx0IiwiX3Bhc3RlX2V2ZW50X2ZpcmVkIiwib3JpZ2luYWxFdmVudCIsIml0ZW1zIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsImV2ZW50IiwiX2hhbmRsZUltYWdlIiwicmVzdWx0IiwicmVhZEFzRGF0YVVSTCIsImdldEFzRmlsZSIsImVycm9yIiwiZ2V0QXNTdHJpbmciLCJzdHJpbmciLCJ0cmlnZ2VyIiwicHJvdG90eXBlIiwiaW5kZXhPZiIsImNhbGwiLCJ0eXBlcyIsImdldERhdGEiLCJzZXRUaW1lb3V0IiwiX2NoZWNrSW1hZ2VzSW5Db250YWluZXIiLCJzcmMiLCJmaWxlcyIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsIm5vbklucHV0YWJsZSIsImFwcGVuZFRvIiwiZm9jdXMiLCJyZW1vdmVDbGFzcyIsInRleHRhcmVhIiwiY3RsRG93biIsIkRhdGFUcmFuc2ZlciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImdldCIsImluc2VydEJlZm9yZSIsImtleUNvZGUiLCJjdHJsS2V5IiwibWV0YUtleSIsIl90ZXh0YXJlYV9mb2N1c19zdG9sZW4iLCJkYXRhIiwiY29udGVudCIsImN1ckVuZCIsImN1clN0YXJ0IiwicHJvcCIsInZhbCIsInNldFNlbGVjdGlvblJhbmdlIiwiY29udGVudGVkaXRhYmxlIiwibG9hZGVyIiwibWVzc2FnZSIsIkltYWdlIiwiY3Jvc3NPcmlnaW4iLCJibG9iIiwiY2FudmFzIiwiY3R4IiwiZ2V0Q29udGV4dCIsImRyYXdJbWFnZSIsInRvRGF0YVVSTCIsIm9uZXJyb3IiLCJ1cmwiLCJjYiIsInRpbWVzcGFuIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZmluZCIsInJlbW92ZSIsInRoZXBhc3RlUGx1Z2luQ2FsbGJhY2siLCJlZGl0b3IiLCJkb21BZGQiLCJvcmlnRG9tQWRkIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJlIiwicHJldmVudEltYWdlUGFzdGUiLCJ3cCIsIm1lZGlhIiwidGhlcGFzdGUiLCJpbnNlcnRJbWFnZSIsInNldHVwRWRpdG9yRG9tIiwiZG9tIiwiYWRkIiwiZG9jIiwiY3VycmVudENsaXBib2FyZEV2ZW50IiwiY2xpcGJvYXJkSGFzSW1hZ2UiLCJwYXN0ZUJ0biIsImFjdGl2ZSIsImFkZENvbW1hbmQiLCJhZGRCdXR0b24iLCJpY29uIiwidG9vbHRpcCIsImNtZCIsIm9uUG9zdFJlbmRlciIsInRpbnltY2UiLCJQbHVnaW5NYW5hZ2VyIl0sIm1hcHBpbmdzIjoiQ0FRQSxXQUNFLEdBQUlBLEdBQUdDLEVBQU9DLEVBQXNCQyxFQUFlQyxDQUVuREosR0FBSUssT0FBT0MsT0FFWE4sRUFBRU8sTUFBUSxTQUFTQyxHQUNqQixHQUFJQyxFQUtKLE9BSnVCLG1CQUFaQyxVQUF1QyxPQUFaQSxTQUNwQ0EsUUFBUUMsSUFBSSwwRkFFZEYsRUFBS1IsRUFBTVcsa0JBQWtCSixHQUN0QkMsRUFBR0ksWUFHWmIsRUFBRWMsR0FBR0MscUJBQXVCLFdBQzFCLEdBQUlDLEdBQUlDLEVBQUdDLEVBQUtDLENBRWhCLEtBREFBLEVBQU1DLEtBQ0RILEVBQUksRUFBR0MsRUFBTUMsRUFBSUUsT0FBUUosRUFBSUMsRUFBS0QsSUFDckNELEVBQUtHLEVBQUlGLEdBQ0xELEVBQUdNLFdBQWF0QixFQUFFZ0IsR0FBSU8sR0FBRyw2Q0FHN0J0QixFQUFNVyxrQkFBa0JJLEdBQ3hCQSxFQUFHTSxXQUFZLEVBRWpCLE9BQU9GLE9BR1RwQixFQUFFYyxHQUFHVSxpQkFBbUIsV0FDdEIsR0FBSVIsR0FBSUMsRUFBR0MsRUFBS0MsQ0FFaEIsS0FEQUEsRUFBTUMsS0FDREgsRUFBSSxFQUFHQyxFQUFNQyxFQUFJRSxPQUFRSixFQUFJQyxFQUFLRCxJQUNyQ0QsRUFBS0csRUFBSUYsR0FDTEQsRUFBR00sV0FBYXRCLEVBQUVnQixHQUFJTyxHQUFHLGdDQUc3QnRCLEVBQU13QixjQUFjVCxHQUNwQkEs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LEVBQUUxRSxpQkFDRjBFLEVBQUVoQyxRQUFVLElBRVIyQyxJQUNKWCxFQUFFMUUsaUJBQ0YwRSxFQUFFaEMsUUFBVSxJQUVOZ0MsS0FNVm9CLFFBQVFDLGNBQWNiLElBQUssV0FBWWQseUJBRXBDdkoiLCJmaWxlIjoidGhlLXBhc3RlLXBsdWdpbi13aXRoLXNvdXJjZW1hcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS4xMi43XG5cbi8qXG5wYXN0ZS5qcyBpcyBhbiBpbnRlcmZhY2UgdG8gcmVhZCBkYXRhICggdGV4dCAvIGltYWdlICkgZnJvbSBjbGlwYm9hcmQgaW4gZGlmZmVyZW50IGJyb3dzZXJzLiBJdCBhbHNvIGNvbnRhaW5zIHNldmVyYWwgaGFja3MuXG5cbmh0dHBzOi8vZ2l0aHViLmNvbS9sYXllcnNzc3MvcGFzdGUuanNcbiAqL1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciAkLCBQYXN0ZSwgY3JlYXRlSGlkZGVuRWRpdGFibGUsIGRhdGFVUkx0b0Jsb2IsIGlzRm9jdXNhYmxlO1xuXG4gICQgPSB3aW5kb3cualF1ZXJ5O1xuXG4gICQucGFzdGUgPSBmdW5jdGlvbihwYXN0ZUNvbnRhaW5lcikge1xuICAgIHZhciBwbTtcbiAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09IFwidW5kZWZpbmVkXCIgJiYgY29uc29sZSAhPT0gbnVsbCkge1xuICAgICAgY29uc29sZS5sb2coXCJERVBSRUNBVEVEOiBUaGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlICQuZm4ucGFzdGFibGVOb25JbnB1dGFibGUoKSBpbnN0ZWFkLlwiKTtcbiAgICB9XG4gICAgcG0gPSBQYXN0ZS5tb3VudE5vbklucHV0YWJsZShwYXN0ZUNvbnRhaW5lcik7XG4gICAgcmV0dXJuIHBtLl9jb250YWluZXI7XG4gIH07XG5cbiAgJC5mbi5wYXN0YWJsZU5vbklucHV0YWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbCwgaiwgbGVuLCByZWY7XG4gICAgcmVmID0gdGhpcztcbiAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgIGVsID0gcmVmW2pdO1xuICAgICAgaWYgKGVsLl9wYXN0YWJsZSB8fCAkKGVsKS5pcygndGV4dGFyZWEsIGlucHV0OnRleHQsIFtjb250ZW50ZWRpdGFibGVdJykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBQYXN0ZS5tb3VudE5vbklucHV0YWJsZShlbCk7XG4gICAgICBlbC5fcGFzdGFibGUgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAkLmZuLnBhc3RhYmxlVGV4dGFyZWEgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZWwsIGosIGxlbiwgcmVmO1xuICAgIHJlZiA9IHRoaXM7XG4gICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICBlbCA9IHJlZltqXTtcbiAgICAgIGlmIChlbC5fcGFzdGFibGUgfHwgJChlbCkuaXMoJzpub3QodGV4dGFyZWEsIGlucHV0OnRleHQpJykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBQYXN0ZS5tb3VudFRleHRhcmVhKGVsKTtcbiAgICAgIGVsLl9wYXN0YWJsZSA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gICQuZm4ucGFzdGFibGVDb250ZW50ZWRpdGFibGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZWwsIGosIGxlbiwgcmVmO1xuICAgIHJlZiA9IHRoaXM7XG4gICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICBlbCA9IHJlZltqXTtcbiAgICAgIGlmIChlbC5fcGFzdGFibGUgfHwgJChlbCkuaXMoJzpub3QoW2NvbnRlbnRlZGl0YWJsZV0pJykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBQYXN0ZS5tb3VudENvbnRlbnRlZGl0YWJsZShlbCk7XG4gICAgICBlbC5fcGFzdGFibGUgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBkYXRhVVJMdG9CbG9iID0gZnVuY3Rpb24oZGF0YVVSTCwgc2xpY2VTaXplKSB7XG4gICAgdmFyIGI2NERhdGEsIGJ5dGVBcnJheSwgYnl0ZUFycmF5cywgYnl0ZUNoYXJhY3RlcnMsIGJ5dGVOdW1iZXJzLCBjb250ZW50VHlwZSwgaSwgbSwgb2Zmc2V0LCByZWYsIHNsaWNlO1xuICAgIGlmIChzbGljZVNpemUgPT0gbnVsbCkge1xuICAgICAgc2xpY2VTaXplID0gNTEyO1xuICAgIH1cbiAgICBpZiAoIShtID0gZGF0YVVSTC5tYXRjaCgvXmRhdGFcXDooW15cXDtdKylcXDtiYXNlNjRcXCwoLispJC8pKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJlZiA9IG0sIG0gPSByZWZbMF0sIGNvbnRlbnRUeXBlID0gcmVmWzFdLCBiNjREYXRhID0gcmVmWzJdO1xuICAgIGJ5dGVDaGFyYWN0ZXJzID0gYXRvYihiNjREYXRhKTtcbiAgICBieXRlQXJyYXlzID0gW107XG4gICAgb2Zmc2V0ID0gMDtcbiAgICB3aGlsZSAob2Zmc2V0IDwgYnl0ZUNoYXJhY3RlcnMubGVuZ3RoKSB7XG4gICAgICBzbGljZSA9IGJ5dGVDaGFyYWN0ZXJzLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgc2xpY2VTaXplKTtcbiAgICAgIGJ5dGVOdW1iZXJzID0gbmV3IEFycmF5KHNsaWNlLmxlbmd0aCk7XG4gICAgICBpID0gMDtcbiAgICAgIHdoaWxlIChpIDwgc2xpY2UubGVuZ3RoKSB7XG4gICAgICAgIGJ5dGVOdW1iZXJzW2ldID0gc2xpY2UuY2hhckNvZGVBdChpKTtcbiAgICAgICAgaSsrO1xuICAgICAgfVxuICAgICAgYnl0ZUFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYnl0ZU51bWJlcnMpO1xuICAgICAgYnl0ZUFycmF5cy5wdXNoKGJ5dGVBcnJheSk7XG4gICAgICBvZmZzZXQgKz0gc2xpY2VTaXplO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEJsb2IoYnl0ZUFycmF5cywge1xuICAgICAgdHlwZTogY29udGVudFR5cGVcbiAgICB9KTtcbiAgfTtcblxuICBjcmVhdGVIaWRkZW5FZGl0YWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKS5hdHRyKCdjb250ZW50ZWRpdGFibGUnLCB0cnVlKS5hdHRyKCdhcmlhLWhpZGRlbicsIHRydWUpLmF0dHIoJ3RhYmluZGV4JywgLTEpLmNzcyh7XG4gICAgICB3aWR0aDogMSxcbiAgICAgIGhlaWdodDogMSxcbiAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgbGVmdDogLTEwMCxcbiAgICAgIG92ZXJmbG93OiAnaGlkZGVuJ1xuICAgIH0pO1xuICB9O1xuXG4gIGlzRm9jdXNhYmxlID0gZnVuY3Rpb24oZWxlbWVudCwgaGFzVGFiaW5kZXgpIHtcbiAgICB2YXIgZmllbGRzZXQsIGZvY3VzYWJsZUlmVmlzaWJsZSwgaW1nLCBtYXAsIG1hcE5hbWUsIG5vZGVOYW1lO1xuICAgIG1hcCA9IHZvaWQgMDtcbiAgICBtYXBOYW1lID0gdm9pZCAwO1xuICAgIGltZyA9IHZvaWQgMDtcbiAgICBmb2N1c2FibGVJZlZpc2libGUgPSB2b2lkIDA7XG4gICAgZmllbGRzZXQgPSB2b2lkIDA7XG4gICAgbm9kZU5hbWUgPSBlbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKCdhcmVhJyA9PT0gbm9kZU5hbWUpIHtcbiAgICAgIG1hcCA9IGVsZW1lbnQucGFyZW50Tm9kZTtcbiAgICAgIG1hcE5hbWUgPSBtYXAubmFtZTtcbiAgICAgIGlmICghZWxlbWVudC5ocmVmIHx8ICFtYXBOYW1lIHx8IG1hcC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAnbWFwJykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpbWcgPSAkKCdpbWdbdXNlbWFwPVxcJyMnICsgbWFwTmFtZSArICdcXCddJyk7XG4gICAgICByZXR1cm4gaW1nLmxlbmd0aCA+IDAgJiYgaW1nLmlzKCc6dmlzaWJsZScpO1xuICAgIH1cbiAgICBpZiAoL14oaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QpJC8udGVzdChub2RlTmFtZSkpIHtcbiAgICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9ICFlbGVtZW50LmRpc2FibGVkO1xuICAgICAgaWYgKGZvY3VzYWJsZUlmVmlzaWJsZSkge1xuICAgICAgICBmaWVsZHNldCA9ICQoZWxlbWVudCkuY2xvc2VzdCgnZmllbGRzZXQnKVswXTtcbiAgICAgICAgaWYgKGZpZWxkc2V0KSB7XG4gICAgICAgICAgZm9jdXNhYmxlSWZWaXNpYmxlID0gIWZpZWxkc2V0LmRpc2FibGVkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICgnYScgPT09IG5vZGVOYW1lKSB7XG4gICAgICBmb2N1c2FibGVJZlZpc2libGUgPSBlbGVtZW50LmhyZWYgfHwgaGFzVGFiaW5kZXg7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9IGhhc1RhYmluZGV4O1xuICAgIH1cbiAgICBmb2N1c2FibGVJZlZpc2libGUgPSBmb2N1c2FibGVJZlZpc2libGUgfHwgJChlbGVtZW50KS5pcygnW2NvbnRlbnRlZGl0YWJsZV0nKTtcbiAgICByZXR1cm4gZm9jdXNhYmxlSWZWaXNpYmxlICYmICQoZWxlbWVudCkuaXMoJzp2aXNpYmxlJyk7XG4gIH07XG5cbiAgUGFzdGUgPSAoZnVuY3Rpb24oKSB7XG4gICAgUGFzdGUucHJvdG90eXBlLl90YXJnZXQgPSBudWxsO1xuXG4gICAgUGFzdGUucHJvdG90eXBlLl9jb250YWluZXIgPSBudWxsO1xuXG4gICAgUGFzdGUubW91bnROb25JbnB1dGFibGUgPSBmdW5jdGlvbihub25JbnB1dGFibGUpIHtcbiAgICAgIHZhciBwYXN0ZTtcbiAgICAgIHBhc3RlID0gbmV3IFBhc3RlKGNyZWF0ZUhpZGRlbkVkaXRhYmxlKCkuYXBwZW5kVG8obm9uSW5wdXRhYmxlKSwgbm9uSW5wdXRhYmxlKTtcbiAgICAgICQobm9uSW5wdXRhYmxlKS5vbignY2xpY2snLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgICAgaWYgKCFpc0ZvY3VzYWJsZShldi50YXJnZXQsIGZhbHNlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHBhc3RlLl9jb250YWluZXIuZm9jdXMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICBwYXN0ZS5fY29udGFpbmVyLm9uKCdmb2N1cycsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuICQobm9uSW5wdXRhYmxlKS5hZGRDbGFzcygncGFzdGFibGUtZm9jdXMnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgIHJldHVybiBwYXN0ZS5fY29udGFpbmVyLm9uKCdibHVyJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gJChub25JbnB1dGFibGUpLnJlbW92ZUNsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH07XG5cbiAgICBQYXN0ZS5tb3VudFRleHRhcmVhID0gZnVuY3Rpb24odGV4dGFyZWEpIHtcbiAgICAgIHZhciBjdGxEb3duLCBwYXN0ZSwgcmVmLCByZWYxO1xuICAgICAgaWYgKCh0eXBlb2YgRGF0YVRyYW5zZmVyICE9PSBcInVuZGVmaW5lZFwiICYmIERhdGFUcmFuc2ZlciAhPT0gbnVsbCA/IERhdGFUcmFuc2Zlci5wcm90b3R5cGUgOiB2b2lkIDApICYmICgocmVmID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcikgIT0gbnVsbCA/IChyZWYxID0gcmVmLmNhbGwoT2JqZWN0LCBEYXRhVHJhbnNmZXIucHJvdG90eXBlLCAnaXRlbXMnKSkgIT0gbnVsbCA/IHJlZjEuZ2V0IDogdm9pZCAwIDogdm9pZCAwKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5tb3VudENvbnRlbnRlZGl0YWJsZSh0ZXh0YXJlYSk7XG4gICAgICB9XG4gICAgICBwYXN0ZSA9IG5ldyBQYXN0ZShjcmVhdGVIaWRkZW5FZGl0YWJsZSgpLmluc2VydEJlZm9yZSh0ZXh0YXJlYSksIHRleHRhcmVhKTtcbiAgICAgIGN0bERvd24gPSBmYWxzZTtcbiAgICAgICQodGV4dGFyZWEpLm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgIHZhciByZWYyO1xuICAgICAgICBpZiAoKHJlZjIgPSBldi5rZXlDb2RlKSA9PT0gMTcgfHwgcmVmMiA9PT0gMjI0KSB7XG4gICAgICAgICAgY3RsRG93biA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSk7XG4gICAgICAkKHRleHRhcmVhKS5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgIHZhciByZWYyO1xuICAgICAgICBpZiAoKHJlZjIgPSBldi5rZXlDb2RlKSA9PT0gMTcgfHwgcmVmMiA9PT0gMjI0KSB7XG4gICAgICAgICAgY3RsRG93biA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChldi5jdHJsS2V5ICE9IG51bGwpICYmIChldi5tZXRhS2V5ICE9IG51bGwpKSB7XG4gICAgICAgICAgY3RsRG93biA9IGV2LmN0cmxLZXkgfHwgZXYubWV0YUtleTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3RsRG93biAmJiBldi5rZXlDb2RlID09PSA4Nikge1xuICAgICAgICAgIHBhc3RlLl90ZXh0YXJlYV9mb2N1c19zdG9sZW4gPSB0cnVlO1xuICAgICAgICAgIHBhc3RlLl9jb250YWluZXIuZm9jdXMoKTtcbiAgICAgICAgICBwYXN0ZS5fcGFzdGVfZXZlbnRfZmlyZWQgPSBmYWxzZTtcbiAgICAgICAgICBzZXRUaW1lb3V0KChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBpZiAoIXBhc3RlLl9wYXN0ZV9ldmVudF9maXJlZCkge1xuICAgICAgICAgICAgICAgICQodGV4dGFyZWEpLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhc3RlLl90ZXh0YXJlYV9mb2N1c19zdG9sZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KSh0aGlzKSwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9KTtcbiAgICAgICQodGV4dGFyZWEpLm9uKCdwYXN0ZScsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7fTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgICQodGV4dGFyZWEpLm9uKCdmb2N1cycsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKCFwYXN0ZS5fdGV4dGFyZWFfZm9jdXNfc3RvbGVuKSB7XG4gICAgICAgICAgICByZXR1cm4gJCh0ZXh0YXJlYSkuYWRkQ2xhc3MoJ3Bhc3RhYmxlLWZvY3VzJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgJCh0ZXh0YXJlYSkub24oJ2JsdXInLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmICghcGFzdGUuX3RleHRhcmVhX2ZvY3VzX3N0b2xlbikge1xuICAgICAgICAgICAgcmV0dXJuICQodGV4dGFyZWEpLnJlbW92ZUNsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgICQocGFzdGUuX3RhcmdldCkub24oJ19wYXN0ZUNoZWNrQ29udGFpbmVyRG9uZScsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJCh0ZXh0YXJlYSkuZm9jdXMoKTtcbiAgICAgICAgICByZXR1cm4gcGFzdGUuX3RleHRhcmVhX2ZvY3VzX3N0b2xlbiA9IGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgcmV0dXJuICQocGFzdGUuX3RhcmdldCkub24oJ3Bhc3RlVGV4dCcsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXYsIGRhdGEpIHtcbiAgICAgICAgICB2YXIgY29udGVudCwgY3VyRW5kLCBjdXJTdGFydDtcbiAgICAgICAgICBjdXJTdGFydCA9ICQodGV4dGFyZWEpLnByb3AoJ3NlbGVjdGlvblN0YXJ0Jyk7XG4gICAgICAgICAgY3VyRW5kID0gJCh0ZXh0YXJlYSkucHJvcCgnc2VsZWN0aW9uRW5kJyk7XG4gICAgICAgICAgY29udGVudCA9ICQodGV4dGFyZWEpLnZhbCgpO1xuICAgICAgICAgICQodGV4dGFyZWEpLnZhbChcIlwiICsgY29udGVudC5zbGljZSgwLCBjdXJTdGFydCkgKyBkYXRhLnRleHQgKyBjb250ZW50LnNsaWNlKGN1ckVuZCkpO1xuICAgICAgICAgICQodGV4dGFyZWEpWzBdLnNldFNlbGVjdGlvblJhbmdlKGN1clN0YXJ0ICsgZGF0YS50ZXh0Lmxlbmd0aCwgY3VyU3RhcnQgKyBkYXRhLnRleHQubGVuZ3RoKTtcbiAgICAgICAgICByZXR1cm4gJCh0ZXh0YXJlYSkudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIFBhc3RlLm1vdW50Q29udGVudGVkaXRhYmxlID0gZnVuY3Rpb24oY29udGVudGVkaXRhYmxlKSB7XG4gICAgICB2YXIgcGFzdGU7XG4gICAgICBwYXN0ZSA9IG5ldyBQYXN0ZShjb250ZW50ZWRpdGFibGUsIGNvbnRlbnRlZGl0YWJsZSk7XG4gICAgICAkKGNvbnRlbnRlZGl0YWJsZSkub24oJ2ZvY3VzJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gJChjb250ZW50ZWRpdGFibGUpLmFkZENsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgcmV0dXJuICQoY29udGVudGVkaXRhYmxlKS5vbignYmx1cicsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuICQoY29udGVudGVkaXRhYmxlKS5yZW1vdmVDbGFzcygncGFzdGFibGUtZm9jdXMnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gUGFzdGUoX2NvbnRhaW5lciwgX3RhcmdldCkge1xuICAgICAgdGhpcy5fY29udGFpbmVyID0gX2NvbnRhaW5lcjtcbiAgICAgIHRoaXMuX3RhcmdldCA9IF90YXJnZXQ7XG4gICAgICB0aGlzLl9jb250YWluZXIgPSAkKHRoaXMuX2NvbnRhaW5lcik7XG4gICAgICB0aGlzLl90YXJnZXQgPSAkKHRoaXMuX3RhcmdldCkuYWRkQ2xhc3MoJ3Bhc3RhYmxlJyk7XG4gICAgICB0aGlzLl9jb250YWluZXIub24oJ3Bhc3RlJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihldikge1xuICAgICAgICAgIHZhciBjbGlwYm9hcmREYXRhLCBmaWxlLCBpdGVtLCBqLCBrLCBsZW4sIGxlbjEsIHJlYWRlciwgcmVmLCByZWYxLCByZWYyLCByZWYzLCB0ZXh0O1xuICAgICAgICAgIGlmIChldi5jdXJyZW50VGFyZ2V0ICE9PSBldi50YXJnZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfdGhpcy5fcGFzdGVfZXZlbnRfZmlyZWQgPSB0cnVlO1xuICAgICAgICAgIGlmICgoKHJlZiA9IGV2Lm9yaWdpbmFsRXZlbnQpICE9IG51bGwgPyByZWYuY2xpcGJvYXJkRGF0YSA6IHZvaWQgMCkgIT0gbnVsbCkge1xuICAgICAgICAgICAgY2xpcGJvYXJkRGF0YSA9IGV2Lm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YTtcbiAgICAgICAgICAgIGlmIChjbGlwYm9hcmREYXRhLml0ZW1zKSB7XG4gICAgICAgICAgICAgIHJlZjEgPSBjbGlwYm9hcmREYXRhLml0ZW1zO1xuICAgICAgICAgICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYxLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgICAgICAgICAgaXRlbSA9IHJlZjFbal07XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZS5tYXRjaCgvXmltYWdlXFwvLykpIHtcbiAgICAgICAgICAgICAgICAgIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9oYW5kbGVJbWFnZShldmVudC50YXJnZXQucmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpdGVtLmdldEFzRmlsZSgpKTtcbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxuICAgICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlID09PSAndGV4dC9wbGFpbicpIHtcbiAgICAgICAgICAgICAgICAgIGl0ZW0uZ2V0QXNTdHJpbmcoZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlVGV4dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGlmICgtMSAhPT0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChjbGlwYm9hcmREYXRhLnR5cGVzLCAndGV4dC9wbGFpbicpKSB7XG4gICAgICAgICAgICAgICAgdGV4dCA9IGNsaXBib2FyZERhdGEuZ2V0RGF0YSgnVGV4dCcpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZVRleHQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIDEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIF90aGlzLl9jaGVja0ltYWdlc0luQ29udGFpbmVyKGZ1bmN0aW9uKHNyYykge1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5faGFuZGxlSW1hZ2Uoc3JjKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjbGlwYm9hcmREYXRhID0gd2luZG93LmNsaXBib2FyZERhdGEpIHtcbiAgICAgICAgICAgIGlmICgocmVmMiA9ICh0ZXh0ID0gY2xpcGJvYXJkRGF0YS5nZXREYXRhKCdUZXh0JykpKSAhPSBudWxsID8gcmVmMi5sZW5ndGggOiB2b2lkIDApIHtcbiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlVGV4dCcsIHtcbiAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdfcGFzdGVDaGVja0NvbnRhaW5lckRvbmUnKTtcbiAgICAgICAgICAgICAgfSwgMSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZWYzID0gY2xpcGJvYXJkRGF0YS5maWxlcztcbiAgICAgICAgICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjMubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgICAgICAgICAgZmlsZSA9IHJlZjNba107XG4gICAgICAgICAgICAgICAgX3RoaXMuX2hhbmRsZUltYWdlKFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIF90aGlzLl9jaGVja0ltYWdlc0luQ29udGFpbmVyKGZ1bmN0aW9uKHNyYykge30pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9XG5cbiAgICBQYXN0ZS5wcm90b3R5cGUuX2hhbmRsZUltYWdlID0gZnVuY3Rpb24oc3JjKSB7XG4gICAgICB2YXIgbG9hZGVyO1xuICAgICAgaWYgKHNyYy5tYXRjaCgvXndlYmtpdFxcLWZha2VcXC11cmxcXDpcXC9cXC8vKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlSW1hZ2VFcnJvcicsIHtcbiAgICAgICAgICBtZXNzYWdlOiBcIllvdSBhcmUgdHJ5aW5nIHRvIHBhc3RlIGFuIGltYWdlIGluIFNhZmFyaSwgaG93ZXZlciB3ZSBhcmUgdW5hYmxlIHRvIHJldGlldmUgaXRzIGRhdGEuXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVJbWFnZVN0YXJ0Jyk7XG4gICAgICBsb2FkZXIgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIGxvYWRlci5jcm9zc09yaWdpbiA9IFwiYW5vbnltb3VzXCI7XG4gICAgICBsb2FkZXIub25sb2FkID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgYmxvYiwgY2FudmFzLCBjdHgsIGRhdGFVUkw7XG4gICAgICAgICAgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgICAgY2FudmFzLndpZHRoID0gbG9hZGVyLndpZHRoO1xuICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBsb2FkZXIuaGVpZ2h0O1xuICAgICAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobG9hZGVyLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgICAgICAgIGRhdGFVUkwgPSBudWxsO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBkYXRhVVJMID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7XG4gICAgICAgICAgICBibG9iID0gZGF0YVVSTHRvQmxvYihkYXRhVVJMKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgICAgICBpZiAoZGF0YVVSTCkge1xuICAgICAgICAgICAgX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZUltYWdlJywge1xuICAgICAgICAgICAgICBibG9iOiBibG9iLFxuICAgICAgICAgICAgICBkYXRhVVJMOiBkYXRhVVJMLFxuICAgICAgICAgICAgICB3aWR0aDogbG9hZGVyLndpZHRoLFxuICAgICAgICAgICAgICBoZWlnaHQ6IGxvYWRlci5oZWlnaHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZUltYWdlRW5kJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKTtcbiAgICAgIGxvYWRlci5vbmVycm9yID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlSW1hZ2VFcnJvcicsIHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGdldCBpbWFnZSBmcm9tOiBcIiArIHNyYyxcbiAgICAgICAgICAgIHVybDogc3JjXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVJbWFnZUVuZCcpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcyk7XG4gICAgICByZXR1cm4gbG9hZGVyLnNyYyA9IHNyYztcbiAgICB9O1xuXG4gICAgUGFzdGUucHJvdG90eXBlLl9jaGVja0ltYWdlc0luQ29udGFpbmVyID0gZnVuY3Rpb24oY2IpIHtcbiAgICAgIHZhciBpbWcsIGosIGxlbiwgcmVmLCB0aW1lc3BhbjtcbiAgICAgIHRpbWVzcGFuID0gTWF0aC5mbG9vcigxMDAwICogTWF0aC5yYW5kb20oKSk7XG4gICAgICByZWYgPSB0aGlzLl9jb250YWluZXIuZmluZCgnaW1nJyk7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgaW1nID0gcmVmW2pdO1xuICAgICAgICBpbWdbXCJfcGFzdGVfbWFya2VkX1wiICsgdGltZXNwYW5dID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzZXRUaW1lb3V0KChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIGssIGxlbjEsIHJlZjE7XG4gICAgICAgICAgcmVmMSA9IF90aGlzLl9jb250YWluZXIuZmluZCgnaW1nJyk7XG4gICAgICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgICAgICBpbWcgPSByZWYxW2tdO1xuICAgICAgICAgICAgaWYgKCFpbWdbXCJfcGFzdGVfbWFya2VkX1wiICsgdGltZXNwYW5dKSB7XG4gICAgICAgICAgICAgIGNiKGltZy5zcmMpO1xuICAgICAgICAgICAgICAkKGltZykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ19wYXN0ZUNoZWNrQ29udGFpbmVyRG9uZScpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcyksIDEpO1xuICAgIH07XG5cbiAgICByZXR1cm4gUGFzdGU7XG5cbiAgfSkoKTtcblxufSkuY2FsbCh0aGlzKTtcbiIsInZhciB0aGVwYXN0ZVBsdWdpbkNhbGxiYWNrO1xuXG4oZnVuY3Rpb24oJCl7XG5cdHRoZXBhc3RlUGx1Z2luQ2FsbGJhY2sgPSBmdW5jdGlvbiggZWRpdG9yICkge1xuXHRcdHZhciBwYXN0ZUJ0bixcblx0XHRcdGFjdGl2ZSA9IGZhbHNlLFxuXHRcdFx0b3JpZ0RvbUFkZCxcblx0XHRcdGNsaXBib2FyZEhhc0ltYWdlID0gZmFsc2UsXG5cdFx0XHRjdXJyZW50Q2xpcGJvYXJkRXZlbnQgPSBudWxsLFxuXHRcdFx0cHJldmVudEltYWdlUGFzdGUgPSBmYWxzZTtcblxuXHRcdGZ1bmN0aW9uIGRvbUFkZCgpIHtcblx0XHRcdHZhciByZXN1bHQgPSBvcmlnRG9tQWRkLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHRcdGlmICggJ21jZXBhc3RlYmluJyA9PT0gJChyZXN1bHQpLmF0dHIoJ2lkJykgKSB7XG5cdFx0XHRcdCQocmVzdWx0KVxuXHRcdFx0XHRcdC5wYXN0YWJsZUNvbnRlbnRlZGl0YWJsZSgpXG5cdFx0XHRcdFx0Lm9uKCdwYXN0ZScsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQub24oJ3Bhc3RlSW1hZ2UnLGZ1bmN0aW9uKCBlLCBkYXRhICkge1xuXHRcdFx0XHRcdFx0aWYgKCBwcmV2ZW50SW1hZ2VQYXN0ZSApIHtcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR3cC5tZWRpYS50aGVwYXN0ZS5pbnNlcnRJbWFnZSggZGF0YS5kYXRhVVJMLCBkYXRhLmJsb2IudHlwZSwgZWRpdG9yICk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHNldHVwRWRpdG9yRG9tKCkge1xuXHRcdFx0b3JpZ0RvbUFkZCA9IGVkaXRvci5kb20uYWRkO1xuXG5cdFx0XHRlZGl0b3IuZG9tLmFkZCA9IGRvbUFkZDtcblxuXHRcdFx0JChlZGl0b3IuZG9tLmRvYykub24oICdwYXN0ZScsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRjdXJyZW50Q2xpcGJvYXJkRXZlbnQgPSBlLm9yaWdpbmFsRXZlbnQ7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGN1cnJlbnRDbGlwYm9hcmRFdmVudC5jbGlwYm9hcmREYXRhLnR5cGVzKTtcblx0XHRcdFx0Y2xpcGJvYXJkSGFzSW1hZ2UgPSB3cC5tZWRpYS50aGVwYXN0ZS5jbGlwYm9hcmRIYXNJbWFnZShlLm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YSk7XG5cdFx0XHRcdHByZXZlbnRJbWFnZVBhc3RlID0gZmFsc2U7XG5cdFx0XHR9ICk7XG5cdFx0fVxuXHRcdGVkaXRvci5hZGRDb21tYW5kKCAnY21kX3RoZXBhc3RlJywgZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgZWRpdG9yX2JvZHk7XG5cblx0XHRcdGFjdGl2ZSA9ICEgYWN0aXZlO1xuXHRcdFx0cGFzdGVCdG4uYWN0aXZlKCBhY3RpdmUgKTtcblx0XHR9KTtcblxuXG5cdFx0ZWRpdG9yLmFkZEJ1dHRvbigndGhlcGFzdGUnLCB7XG5cdFx0XHRpY29uOiAndGhlcGFzdGUnLFxuXHRcdFx0dG9vbHRpcDogJycsXG5cdFx0XHRjbWQgOiAnY21kX3RoZXBhc3RlJyxcblx0XHRcdG9uUG9zdFJlbmRlcjogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHBhc3RlQnRuID0gdGhpcztcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGVkaXRvclxuXHRcdFx0Lm9uKCAnaW5pdCcsIHNldHVwRWRpdG9yRG9tIClcblx0XHRcdC5vbiggJ0JlZm9yZVBhc3RlUHJlUHJvY2VzcycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoICBlLmNvbnRlbnQubWF0Y2goIC8mbHQ7c3ZnW1xcc1xcUy5dKiZsdDtcXC9zdmcmZ3Q7L2kgKSApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0ZS5jb250ZW50ID0gJyc7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCBjbGlwYm9hcmRIYXNJbWFnZSApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0ZS5jb250ZW50ID0gJyc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIGU7XG5cblx0XHRcdH0gKTtcblxuXHR9O1xuXG5cdHRpbnltY2UuUGx1Z2luTWFuYWdlci5hZGQoICd0aGVwYXN0ZScsIHRoZXBhc3RlUGx1Z2luQ2FsbGJhY2sgKTtcblxufSApKGpRdWVyeSk7XG5cbiJdfQ==
