(function(){var t,e,n,a,o;t=window.jQuery,t.paste=function(t){var n;return"undefined"!=typeof console&&null!==console&&console.log("DEPRECATED: This method is deprecated. Please use $.fn.pastableNonInputable() instead."),n=e.mountNonInputable(t),n._container},t.fn.pastableNonInputable=function(){var n,a,o,r;for(r=this,a=0,o=r.length;a<o;a++)n=r[a],n._pastable||t(n).is("textarea, input:text, [contenteditable]")||(e.mountNonInputable(n),n._pastable=!0);return this},t.fn.pastableTextarea=function(){var n,a,o,r;for(r=this,a=0,o=r.length;a<o;a++)n=r[a],n._pastable||t(n).is(":not(textarea, input:text)")||(e.mountTextarea(n),n._pastable=!0);return this},t.fn.pastableContenteditable=function(){var n,a,o,r;for(r=this,a=0,o=r.length;a<o;a++)n=r[a],n._pastable||t(n).is(":not([contenteditable])")||(e.mountContenteditable(n),n._pastable=!0);return this},a=function(t,e){var n,a,o,r,i,u,s,l,c,p,d;if(null==e&&(e=512),!(l=t.match(/^data\:([^\;]+)\;base64\,(.+)$/)))return null;for(p=l,l=p[0],u=p[1],n=p[2],r=atob(n),o=[],c=0;c<r.length;){for(d=r.slice(c,c+e),i=new Array(d.length),s=0;s<d.length;)i[s]=d.charCodeAt(s),s++;a=new Uint8Array(i),o.push(a),c+=e}return new Blob(o,{type:u})},n=function(){return t(document.createElement("div")).attr("contenteditable",!0).attr("aria-hidden",!0).attr("tabindex",-1).css({width:1,height:1,position:"fixed",left:-100,overflow:"hidden"})},o=function(e,n){var a,o,r,i,u,s;return i=void 0,u=void 0,r=void 0,o=void 0,a=void 0,"area"===(s=e.nodeName.toLowerCase())?(i=e.parentNode,u=i.name,!(!e.href||!u||"map"!==i.nodeName.toLowerCase())&&(r=t("img[usemap='#"+u+"']"),r.length>0&&r.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(s)?(o=!e.disabled)&&(a=t(e).closest("fieldset")[0])&&(o=!a.disabled):o="a"===s?e.href||n:n,(o=o||t(e).is("[contenteditable]"))&&t(e).is(":visible"))},e=function(){function e(e,n){this._container=e,this._target=n,this._container=t(this._container),this._target=t(this._target).addClass("pastable"),this._container.on("paste",function(t){return function(e){var n,a,o,r,i,u,s,l,c,p,d,g,f;if(e.currentTarget!==e.target)return e.preventDefault();if(t._paste_event_fired=!0,null!=(null!=(c=e.originalEvent)?c.clipboardData:void 0))if(n=e.originalEvent.clipboardData,n.items)for(p=n.items,r=0,u=p.length;r<u;r++){if(o=p[r],o.type.match(/^image\//)){l=new FileReader,l.onload=function(e){return t._handleImage(e.target.result)};try{l.readAsDataURL(o.getAsFile())}catch(t){}e.preventDefault();break}"text/plain"===o.type&&o.getAsString(function(e){return t._target.trigger("pasteText",{text:e})})}else-1!==Array.prototype.indexOf.call(n.types,"text/plain")&&(f=n.getData("Text"),setTimeout(function(){return t._target.trigger("pasteText",{text:f})},1)),t._checkImagesInContainer(function(e){return t._handleImage(e)});if(n=window.clipboardData)if(null!=(d=f=n.getData("Text"))?d.length:void 0)setTimeout(function(){return t._target.trigger("pasteText",{text:f}),t._target.trigger("_pasteCheckContainerDone")},1);else{for(g=n.files,i=0,s=g.length;i<s;i++)a=g[i],t._handleImage(URL.createObjectURL(a));t._checkImagesInContainer(function(t){})}return null}}(this))}return e.prototype._target=null,e.prototype._container=null,e.mountNonInputable=function(a){var r;return r=new e(n().appendTo(a),a),t(a).on("click",function(t){return function(t){if(!o(t.target,!1))return r._container.focus()}}()),r._container.on("focus",function(e){return function(){return t(a).addClass("pastable-focus")}}()),r._container.on("blur",function(e){return function(){return t(a).removeClass("pastable-focus")}}())},e.mountTextarea=function(a){var o,r,i,u;return("undefined"!=typeof DataTransfer&&null!==DataTransfer?DataTransfer.prototype:void 0)&&(null!=(i=Object.getOwnPropertyDescriptor)&&null!=(u=i.call(Object,DataTransfer.prototype,"items"))?u.get:void 0)?this.mountContenteditable(a):(r=new e(n().insertBefore(a),a),o=!1,t(a).on("keyup",function(t){var e;return 17!==(e=t.keyCode)&&224!==e||(o=!1),null}),t(a).on("keydown",function(e){var n;return 17!==(n=e.keyCode)&&224!==n||(o=!0),null!=e.ctrlKey&&null!=e.metaKey&&(o=e.ctrlKey||e.metaKey),o&&86===e.keyCode&&(r._textarea_focus_stolen=!0,r._container.focus(),r._paste_event_fired=!1,setTimeout(function(e){return function(){if(!r._paste_event_fired)return t(a).focus(),r._textarea_focus_stolen=!1}}(),1)),null}),t(a).on("paste",function(t){return function(){}}()),t(a).on("focus",function(e){return function(){if(!r._textarea_focus_stolen)return t(a).addClass("pastable-focus")}}()),t(a).on("blur",function(e){return function(){if(!r._textarea_focus_stolen)return t(a).removeClass("pastable-focus")}}()),t(r._target).on("_pasteCheckContainerDone",function(e){return function(){return t(a).focus(),r._textarea_focus_stolen=!1}}()),t(r._target).on("pasteText",function(e){return function(e,n){var o,r,i;return i=t(a).prop("selectionStart"),r=t(a).prop("selectionEnd"),o=t(a).val(),t(a).val(""+o.slice(0,i)+n.text+o.slice(r)),t(a)[0].setSelectionRange(i+n.text.length,i+n.text.length),t(a).trigger("change")}}()))},e.mountContenteditable=function(n){return new e(n,n),t(n).on("focus",function(e){return function(){return t(n).addClass("pastable-focus")}}()),t(n).on("blur",function(e){return function(){return t(n).removeClass("pastable-focus")}}())},e.prototype._handleImage=function(t){var e;return t.match(/^webkit\-fake\-url\:\/\//)?this._target.trigger("pasteImageError",{message:"You are trying to paste an image in Safari, however we are unable to retieve its data."}):(this._target.trigger("pasteImageStart"),e=new Image,e.crossOrigin="anonymous",e.onload=function(t){return function(){var n,o,r,i;o=document.createElement("canvas"),o.width=e.width,o.height=e.height,r=o.getContext("2d"),r.drawImage(e,0,0,o.width,o.height),i=null;try{i=o.toDataURL("image/png"),n=a(i)}catch(t){}return i&&t._target.trigger("pasteImage",{blob:n,dataURL:i,width:e.width,height:e.height}),t._target.trigger("pasteImageEnd")}}(this),e.onerror=function(e){return function(){return e._target.trigger("pasteImageError",{message:"Failed to get image from: "+t,url:t}),e._target.trigger("pasteImageEnd")}}(this),e.src=t)},e.prototype._checkImagesInContainer=function(e){var n,a,o,r,i;for(i=Math.floor(1e3*Math.random()),r=this._container.find("img"),a=0,o=r.length;a<o;a++)n=r[a],n["_paste_marked_"+i]=!0;return setTimeout(function(a){return function(){var o,r,u;for(u=a._container.find("img"),o=0,r=u.length;o<r;o++)n=u[o],n["_paste_marked_"+i]||(e(n.src),t(n).remove());return a._target.trigger("_pasteCheckContainerDone")}}(this),1)},e}()}).call(this);var the_pastePluginCallback;!function(t){the_pastePluginCallback=function(e){function n(t){var e=t.src.substring(0,5);return"blob:"===e||"data:"===e}var a,o,r=wp.media.thepaste;r.options.editor.auto_upload="false"!==localStorage.getItem("thepaste.auto_upload"),e.addCommand("cmd_thepaste",function(){r.options.editor.auto_upload=!r.options.editor.auto_upload,localStorage.setItem("thepaste.auto_upload",r.options.editor.auto_upload.toString()),a.active(r.options.editor.auto_upload)}),e.addButton("thepaste",{icon:"thepaste",tooltip:r.l10n.upload_pasted_images,cmd:"cmd_thepaste",onPostRender:function(){a=this},active:r.options.editor.auto_upload}),e.addButton("wp_img_thepaste_upload",{icon:"dashicon dashicons dashicons-upload thepaste-upload",tooltip:r.l10n.upload_image,onclick:function(){var t;t=e.selection.getNode(),r.uploadImage(t,e)}}),e.once("preinit",function(){e.wp&&e.wp._createToolbar&&(o=e.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wp_img_thepaste_upload","wp_img_edit","wp_img_remove"]))}),e.on("wptoolbar",function(t){var a;"IMG"!==t.element.nodeName||e.wp.isPlaceholder(t.element)||(t.toolbar=o,a=o.$el.find(".thepaste-upload").closest(".mce-btn"),n(t.element)?a.show():a.hide())}),e.on("BeforePastePreProcess",function(t){return t.content.match(/&lt;svg[\s\S.]*&lt;\/svg&gt;/i)&&(t.preventDefault(),t.content=""),t}).on("PastePostProcess",function(a){var o,i;r.options.editor.auto_upload&&(o=t(a.node).children().first(),o.is("img")&&n(o.get(0))&&(i=r.uploadImage(o.get(0),e),o.remove(),t(a.node).append(i)))})},tinymce.PluginManager.add("thepaste",the_pastePluginCallback)}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRoZS1wYXN0ZS1wbHVnaW4uanMiXSwibmFtZXMiOlsiJCIsIlBhc3RlIiwiY3JlYXRlSGlkZGVuRWRpdGFibGUiLCJkYXRhVVJMdG9CbG9iIiwiaXNGb2N1c2FibGUiLCJ3aW5kb3ciLCJqUXVlcnkiLCJwYXN0ZSIsInBhc3RlQ29udGFpbmVyIiwicG0iLCJjb25zb2xlIiwibG9nIiwibW91bnROb25JbnB1dGFibGUiLCJfY29udGFpbmVyIiwiZm4iLCJwYXN0YWJsZU5vbklucHV0YWJsZSIsImVsIiwiaiIsImxlbiIsInJlZiIsInRoaXMiLCJsZW5ndGgiLCJfcGFzdGFibGUiLCJpcyIsInBhc3RhYmxlVGV4dGFyZWEiLCJtb3VudFRleHRhcmVhIiwicGFzdGFibGVDb250ZW50ZWRpdGFibGUiLCJtb3VudENvbnRlbnRlZGl0YWJsZSIsImRhdGFVUkwiLCJzbGljZVNpemUiLCJiNjREYXRhIiwiYnl0ZUFycmF5IiwiYnl0ZUFycmF5cyIsImJ5dGVDaGFyYWN0ZXJzIiwiYnl0ZU51bWJlcnMiLCJjb250ZW50VHlwZSIsImkiLCJtIiwib2Zmc2V0Iiwic2xpY2UiLCJtYXRjaCIsImF0b2IiLCJBcnJheSIsImNoYXJDb2RlQXQiLCJVaW50OEFycmF5IiwicHVzaCIsIkJsb2IiLCJ0eXBlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYXR0ciIsImNzcyIsIndpZHRoIiwiaGVpZ2h0IiwicG9zaXRpb24iLCJsZWZ0Iiwib3ZlcmZsb3ciLCJlbGVtZW50IiwiaGFzVGFiaW5kZXgiLCJmaWVsZHNldCIsImZvY3VzYWJsZUlmVmlzaWJsZSIsImltZyIsIm1hcCIsIm1hcE5hbWUiLCJub2RlTmFtZSIsInRvTG93ZXJDYXNlIiwicGFyZW50Tm9kZSIsIm5hbWUiLCJocmVmIiwidGVzdCIsImRpc2FibGVkIiwiY2xvc2VzdCIsIl90YXJnZXQiLCJhZGRDbGFzcyIsIm9uIiwiX3RoaXMiLCJldiIsImNsaXBib2FyZERhdGEiLCJmaWxlIiwiaXRlbSIsImsiLCJsZW4xIiwicmVhZGVyIiwicmVmMSIsInJlZjIiLCJyZWYzIiwidGV4dCIsImN1cnJlbnRUYXJnZXQiLCJ0YXJnZXQiLCJwcmV2ZW50RGVmYXVsdCIsIl9wYXN0ZV9ldmVudF9maXJlZCIsIm9yaWdpbmFsRXZlbnQiLCJpdGVtcyIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJldmVudCIsIl9oYW5kbGVJbWFnZSIsInJlc3VsdCIsInJlYWRBc0RhdGFVUkwiLCJnZXRBc0ZpbGUiLCJlcnJvciIsImdldEFzU3RyaW5nIiwic3RyaW5nIiwidHJpZ2dlciIsInByb3RvdHlwZSIsImluZGV4T2YiLCJjYWxsIiwidHlwZXMiLCJnZXREYXRhIiwic2V0VGltZW91dCIsIl9jaGVja0ltYWdlc0luQ29udGFpbmVyIiwic3JjIiwiZmlsZXMiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJub25JbnB1dGFibGUiLCJhcHBlbmRUbyIsImZvY3VzIiwicmVtb3ZlQ2xhc3MiLCJ0ZXh0YXJlYSIsImN0bERvd24iLCJEYXRhVHJhbnNmZXIiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXQiLCJpbnNlcnRCZWZvcmUiLCJrZXlDb2RlIiwiY3RybEtleSIsIm1ldGFLZXkiLCJfdGV4dGFyZWFfZm9jdXNfc3RvbGVuIiwiZGF0YSIsImNvbnRlbnQiLCJjdXJFbmQiLCJjdXJTdGFydCIsInByb3AiLCJ2YWwiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImNvbnRlbnRlZGl0YWJsZSIsImxvYWRlciIsIm1lc3NhZ2UiLCJJbWFnZSIsImNyb3NzT3JpZ2luIiwiYmxvYiIsImNhbnZhcyIsImN0eCIsImdldENvbnRleHQiLCJkcmF3SW1hZ2UiLCJ0b0RhdGFVUkwiLCJvbmVycm9yIiwidXJsIiwiY2IiLCJ0aW1lc3BhbiIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImZpbmQiLCJyZW1vdmUiLCJ0aGVfcGFzdGVQbHVnaW5DYWxsYmFjayIsImVkaXRvciIsImNhblVwbG9hZCIsInN1YiIsInN1YnN0cmluZyIsInBhc3RlQnRuIiwidG9vbGJhciIsInRoZXBhc3RlIiwid3AiLCJtZWRpYSIsIm9wdGlvbnMiLCJhdXRvX3VwbG9hZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJhZGRDb21tYW5kIiwic2V0SXRlbSIsInRvU3RyaW5nIiwiYWN0aXZlIiwiYWRkQnV0dG9uIiwiaWNvbiIsInRvb2x0aXAiLCJsMTBuIiwidXBsb2FkX3Bhc3RlZF9pbWFnZXMiLCJjbWQiLCJvblBvc3RSZW5kZXIiLCJ1cGxvYWRfaW1hZ2UiLCJvbmNsaWNrIiwiaW1hZ2UiLCJzZWxlY3Rpb24iLCJnZXROb2RlIiwidXBsb2FkSW1hZ2UiLCJvbmNlIiwiX2NyZWF0ZVRvb2xiYXIiLCJ1cGxvYWRCdG4iLCJpc1BsYWNlaG9sZGVyIiwiJGVsIiwic2hvdyIsImhpZGUiLCJlIiwiJGZpcnN0Q2hpbGQiLCIkdXBsb2FkQm94Iiwibm9kZSIsImNoaWxkcmVuIiwiZmlyc3QiLCJhcHBlbmQiLCJ0aW55bWNlIiwiUGx1Z2luTWFuYWdlciIsImFkZCJdLCJtYXBwaW5ncyI6IkNBUUEsV0FDRSxHQUFJQSxHQUFHQyxFQUFPQyxFQUFzQkMsRUFBZUMsQ0FFbkRKLEdBQUlLLE9BQU9DLE9BRVhOLEVBQUVPLE1BQVEsU0FBU0MsR0FDakIsR0FBSUMsRUFLSixPQUp1QixtQkFBWkMsVUFBdUMsT0FBWkEsU0FDcENBLFFBQVFDLElBQUksMEZBRWRGLEVBQUtSLEVBQU1XLGtCQUFrQkosR0FDdEJDLEVBQUdJLFlBR1piLEVBQUVjLEdBQUdDLHFCQUF1QixXQUMxQixHQUFJQyxHQUFJQyxFQUFHQyxFQUFLQyxDQUVoQixLQURBQSxFQUFNQyxLQUNESCxFQUFJLEVBQUdDLEVBQU1DLEVBQUlFLE9BQVFKLEVBQUlDLEVBQUtELElBQ3JDRCxFQUFLRyxFQUFJRixHQUNMRCxFQUFHTSxXQUFhdEIsRUFBRWdCLEdBQUlPLEdBQUcsNkNBRzdCdEIsRUFBTVcsa0JBQWtCSSxHQUN4QkEsRUFBR00sV0FBWSxFQUVqQixPQUFPRixPQUdUcEIsRUFBRWMsR0FBR1UsaUJB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V0FDbEI5QixFQUFPTyxJQUFNUCxFQUFPTyxHQUFHd0IsaUJBQzNCMUIsRUFBVUwsRUFBT08sR0FBR3dCLGdCQUNuQixtQkFDQSxxQkFDQSxvQkFDQSxtQkFDQSx5QkFDQSxjQUNBLHFCQU1IL0IsRUFBT3BGLEdBQUksWUFBYSxTQUFVcUIsR0FDakMsR0FBSStGLEVBQzRCLFNBQTNCL0YsRUFBTXRDLFFBQVFPLFVBQXdCOEYsRUFBT08sR0FBRzBCLGNBQWVoRyxFQUFNdEMsV0FDekVzQyxFQUFNb0UsUUFBVUEsRUFFaEIyQixFQUFZM0IsRUFBUTZCLElBQUlyQyxLQUFLLG9CQUFvQnBGLFFBQVEsWUFFcER3RixFQUFXaEUsRUFBTXRDLFNBQ3JCcUksRUFBVUcsT0FFVkgsRUFBVUksVUFZYnBDLEVBQ0VwRixHQUFJLHdCQUF5QixTQUFTeUgsR0FNdEMsTUFKTUEsR0FBRWhFLFFBQVEzRixNQUFPLG1DQUN0QjJKLEVBQUUxRyxpQkFDRjBHLEVBQUVoRSxRQUFVLElBRU5nRSxJQUdQekgsR0FBSSxtQkFBb0IsU0FBU3lILEdBRWpDLEdBQUlDLEdBQWFDLENBRVpqQyxHQUFTRyxRQUFRVCxPQUFPVSxjQUM1QjRCLEVBQWNwTSxFQUFFbU0sRUFBRUcsTUFBTUMsV0FBV0MsUUFDOUJKLEVBQVk3SyxHQUFHLFFBQVV3SSxFQUFXcUMsRUFBWXhFLElBQUksTUFDeER5RSxFQUFhakMsRUFBU3VCLFlBQWFTLEVBQVl4RSxJQUFJLEdBQUlrQyxHQUN2RHNDLEVBQVl4QyxTQUNaNUosRUFBRW1NLEVBQUVHLE1BQU1HLE9BQVFKLFFBUXZCSyxRQUFRQyxjQUFjQyxJQUFLLFdBQVkvQywwQkFFcEN2SiIsImZpbGUiOiJ0aGUtcGFzdGUtcGx1Z2luLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS4xMi43XG5cbi8qXG5wYXN0ZS5qcyBpcyBhbiBpbnRlcmZhY2UgdG8gcmVhZCBkYXRhICggdGV4dCAvIGltYWdlICkgZnJvbSBjbGlwYm9hcmQgaW4gZGlmZmVyZW50IGJyb3dzZXJzLiBJdCBhbHNvIGNvbnRhaW5zIHNldmVyYWwgaGFja3MuXG5cbmh0dHBzOi8vZ2l0aHViLmNvbS9sYXllcnNzc3MvcGFzdGUuanNcbiAqL1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciAkLCBQYXN0ZSwgY3JlYXRlSGlkZGVuRWRpdGFibGUsIGRhdGFVUkx0b0Jsb2IsIGlzRm9jdXNhYmxlO1xuXG4gICQgPSB3aW5kb3cualF1ZXJ5O1xuXG4gICQucGFzdGUgPSBmdW5jdGlvbihwYXN0ZUNvbnRhaW5lcikge1xuICAgIHZhciBwbTtcbiAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09IFwidW5kZWZpbmVkXCIgJiYgY29uc29sZSAhPT0gbnVsbCkge1xuICAgICAgY29uc29sZS5sb2coXCJERVBSRUNBVEVEOiBUaGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlICQuZm4ucGFzdGFibGVOb25JbnB1dGFibGUoKSBpbnN0ZWFkLlwiKTtcbiAgICB9XG4gICAgcG0gPSBQYXN0ZS5tb3VudE5vbklucHV0YWJsZShwYXN0ZUNvbnRhaW5lcik7XG4gICAgcmV0dXJuIHBtLl9jb250YWluZXI7XG4gIH07XG5cbiAgJC5mbi5wYXN0YWJsZU5vbklucHV0YWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbCwgaiwgbGVuLCByZWY7XG4gICAgcmVmID0gdGhpcztcbiAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgIGVsID0gcmVmW2pdO1xuICAgICAgaWYgKGVsLl9wYXN0YWJsZSB8fCAkKGVsKS5pcygndGV4dGFyZWEsIGlucHV0OnRleHQsIFtjb250ZW50ZWRpdGFibGVdJykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBQYXN0ZS5tb3VudE5vbklucHV0YWJsZShlbCk7XG4gICAgICBlbC5fcGFzdGFibGUgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAkLmZuLnBhc3RhYmxlVGV4dGFyZWEgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZWwsIGosIGxlbiwgcmVmO1xuICAgIHJlZiA9IHRoaXM7XG4gICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICBlbCA9IHJlZltqXTtcbiAgICAgIGlmIChlbC5fcGFzdGFibGUgfHwgJChlbCkuaXMoJzpub3QodGV4dGFyZWEsIGlucHV0OnRleHQpJykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBQYXN0ZS5tb3VudFRleHRhcmVhKGVsKTtcbiAgICAgIGVsLl9wYXN0YWJsZSA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gICQuZm4ucGFzdGFibGVDb250ZW50ZWRpdGFibGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZWwsIGosIGxlbiwgcmVmO1xuICAgIHJlZiA9IHRoaXM7XG4gICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICBlbCA9IHJlZltqXTtcbiAgICAgIGlmIChlbC5fcGFzdGFibGUgfHwgJChlbCkuaXMoJzpub3QoW2NvbnRlbnRlZGl0YWJsZV0pJykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBQYXN0ZS5tb3VudENvbnRlbnRlZGl0YWJsZShlbCk7XG4gICAgICBlbC5fcGFzdGFibGUgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBkYXRhVVJMdG9CbG9iID0gZnVuY3Rpb24oZGF0YVVSTCwgc2xpY2VTaXplKSB7XG4gICAgdmFyIGI2NERhdGEsIGJ5dGVBcnJheSwgYnl0ZUFycmF5cywgYnl0ZUNoYXJhY3RlcnMsIGJ5dGVOdW1iZXJzLCBjb250ZW50VHlwZSwgaSwgbSwgb2Zmc2V0LCByZWYsIHNsaWNlO1xuICAgIGlmIChzbGljZVNpemUgPT0gbnVsbCkge1xuICAgICAgc2xpY2VTaXplID0gNTEyO1xuICAgIH1cbiAgICBpZiAoIShtID0gZGF0YVVSTC5tYXRjaCgvXmRhdGFcXDooW15cXDtdKylcXDtiYXNlNjRcXCwoLispJC8pKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJlZiA9IG0sIG0gPSByZWZbMF0sIGNvbnRlbnRUeXBlID0gcmVmWzFdLCBiNjREYXRhID0gcmVmWzJdO1xuICAgIGJ5dGVDaGFyYWN0ZXJzID0gYXRvYihiNjREYXRhKTtcbiAgICBieXRlQXJyYXlzID0gW107XG4gICAgb2Zmc2V0ID0gMDtcbiAgICB3aGlsZSAob2Zmc2V0IDwgYnl0ZUNoYXJhY3RlcnMubGVuZ3RoKSB7XG4gICAgICBzbGljZSA9IGJ5dGVDaGFyYWN0ZXJzLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgc2xpY2VTaXplKTtcbiAgICAgIGJ5dGVOdW1iZXJzID0gbmV3IEFycmF5KHNsaWNlLmxlbmd0aCk7XG4gICAgICBpID0gMDtcbiAgICAgIHdoaWxlIChpIDwgc2xpY2UubGVuZ3RoKSB7XG4gICAgICAgIGJ5dGVOdW1iZXJzW2ldID0gc2xpY2UuY2hhckNvZGVBdChpKTtcbiAgICAgICAgaSsrO1xuICAgICAgfVxuICAgICAgYnl0ZUFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYnl0ZU51bWJlcnMpO1xuICAgICAgYnl0ZUFycmF5cy5wdXNoKGJ5dGVBcnJheSk7XG4gICAgICBvZmZzZXQgKz0gc2xpY2VTaXplO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEJsb2IoYnl0ZUFycmF5cywge1xuICAgICAgdHlwZTogY29udGVudFR5cGVcbiAgICB9KTtcbiAgfTtcblxuICBjcmVhdGVIaWRkZW5FZGl0YWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKS5hdHRyKCdjb250ZW50ZWRpdGFibGUnLCB0cnVlKS5hdHRyKCdhcmlhLWhpZGRlbicsIHRydWUpLmF0dHIoJ3RhYmluZGV4JywgLTEpLmNzcyh7XG4gICAgICB3aWR0aDogMSxcbiAgICAgIGhlaWdodDogMSxcbiAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgbGVmdDogLTEwMCxcbiAgICAgIG92ZXJmbG93OiAnaGlkZGVuJ1xuICAgIH0pO1xuICB9O1xuXG4gIGlzRm9jdXNhYmxlID0gZnVuY3Rpb24oZWxlbWVudCwgaGFzVGFiaW5kZXgpIHtcbiAgICB2YXIgZmllbGRzZXQsIGZvY3VzYWJsZUlmVmlzaWJsZSwgaW1nLCBtYXAsIG1hcE5hbWUsIG5vZGVOYW1lO1xuICAgIG1hcCA9IHZvaWQgMDtcbiAgICBtYXBOYW1lID0gdm9pZCAwO1xuICAgIGltZyA9IHZvaWQgMDtcbiAgICBmb2N1c2FibGVJZlZpc2libGUgPSB2b2lkIDA7XG4gICAgZmllbGRzZXQgPSB2b2lkIDA7XG4gICAgbm9kZU5hbWUgPSBlbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKCdhcmVhJyA9PT0gbm9kZU5hbWUpIHtcbiAgICAgIG1hcCA9IGVsZW1lbnQucGFyZW50Tm9kZTtcbiAgICAgIG1hcE5hbWUgPSBtYXAubmFtZTtcbiAgICAgIGlmICghZWxlbWVudC5ocmVmIHx8ICFtYXBOYW1lIHx8IG1hcC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAnbWFwJykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpbWcgPSAkKCdpbWdbdXNlbWFwPVxcJyMnICsgbWFwTmFtZSArICdcXCddJyk7XG4gICAgICByZXR1cm4gaW1nLmxlbmd0aCA+IDAgJiYgaW1nLmlzKCc6dmlzaWJsZScpO1xuICAgIH1cbiAgICBpZiAoL14oaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QpJC8udGVzdChub2RlTmFtZSkpIHtcbiAgICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9ICFlbGVtZW50LmRpc2FibGVkO1xuICAgICAgaWYgKGZvY3VzYWJsZUlmVmlzaWJsZSkge1xuICAgICAgICBmaWVsZHNldCA9ICQoZWxlbWVudCkuY2xvc2VzdCgnZmllbGRzZXQnKVswXTtcbiAgICAgICAgaWYgKGZpZWxkc2V0KSB7XG4gICAgICAgICAgZm9jdXNhYmxlSWZWaXNpYmxlID0gIWZpZWxkc2V0LmRpc2FibGVkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICgnYScgPT09IG5vZGVOYW1lKSB7XG4gICAgICBmb2N1c2FibGVJZlZpc2libGUgPSBlbGVtZW50LmhyZWYgfHwgaGFzVGFiaW5kZXg7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9IGhhc1RhYmluZGV4O1xuICAgIH1cbiAgICBmb2N1c2FibGVJZlZpc2libGUgPSBmb2N1c2FibGVJZlZpc2libGUgfHwgJChlbGVtZW50KS5pcygnW2NvbnRlbnRlZGl0YWJsZV0nKTtcbiAgICByZXR1cm4gZm9jdXNhYmxlSWZWaXNpYmxlICYmICQoZWxlbWVudCkuaXMoJzp2aXNpYmxlJyk7XG4gIH07XG5cbiAgUGFzdGUgPSAoZnVuY3Rpb24oKSB7XG4gICAgUGFzdGUucHJvdG90eXBlLl90YXJnZXQgPSBudWxsO1xuXG4gICAgUGFzdGUucHJvdG90eXBlLl9jb250YWluZXIgPSBudWxsO1xuXG4gICAgUGFzdGUubW91bnROb25JbnB1dGFibGUgPSBmdW5jdGlvbihub25JbnB1dGFibGUpIHtcbiAgICAgIHZhciBwYXN0ZTtcbiAgICAgIHBhc3RlID0gbmV3IFBhc3RlKGNyZWF0ZUhpZGRlbkVkaXRhYmxlKCkuYXBwZW5kVG8obm9uSW5wdXRhYmxlKSwgbm9uSW5wdXRhYmxlKTtcbiAgICAgICQobm9uSW5wdXRhYmxlKS5vbignY2xpY2snLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgICAgaWYgKCFpc0ZvY3VzYWJsZShldi50YXJnZXQsIGZhbHNlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHBhc3RlLl9jb250YWluZXIuZm9jdXMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICBwYXN0ZS5fY29udGFpbmVyLm9uKCdmb2N1cycsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuICQobm9uSW5wdXRhYmxlKS5hZGRDbGFzcygncGFzdGFibGUtZm9jdXMnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgIHJldHVybiBwYXN0ZS5fY29udGFpbmVyLm9uKCdibHVyJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gJChub25JbnB1dGFibGUpLnJlbW92ZUNsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH07XG5cbiAgICBQYXN0ZS5tb3VudFRleHRhcmVhID0gZnVuY3Rpb24odGV4dGFyZWEpIHtcbiAgICAgIHZhciBjdGxEb3duLCBwYXN0ZSwgcmVmLCByZWYxO1xuICAgICAgaWYgKCh0eXBlb2YgRGF0YVRyYW5zZmVyICE9PSBcInVuZGVmaW5lZFwiICYmIERhdGFUcmFuc2ZlciAhPT0gbnVsbCA/IERhdGFUcmFuc2Zlci5wcm90b3R5cGUgOiB2b2lkIDApICYmICgocmVmID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcikgIT0gbnVsbCA/IChyZWYxID0gcmVmLmNhbGwoT2JqZWN0LCBEYXRhVHJhbnNmZXIucHJvdG90eXBlLCAnaXRlbXMnKSkgIT0gbnVsbCA/IHJlZjEuZ2V0IDogdm9pZCAwIDogdm9pZCAwKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5tb3VudENvbnRlbnRlZGl0YWJsZSh0ZXh0YXJlYSk7XG4gICAgICB9XG4gICAgICBwYXN0ZSA9IG5ldyBQYXN0ZShjcmVhdGVIaWRkZW5FZGl0YWJsZSgpLmluc2VydEJlZm9yZSh0ZXh0YXJlYSksIHRleHRhcmVhKTtcbiAgICAgIGN0bERvd24gPSBmYWxzZTtcbiAgICAgICQodGV4dGFyZWEpLm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgIHZhciByZWYyO1xuICAgICAgICBpZiAoKHJlZjIgPSBldi5rZXlDb2RlKSA9PT0gMTcgfHwgcmVmMiA9PT0gMjI0KSB7XG4gICAgICAgICAgY3RsRG93biA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSk7XG4gICAgICAkKHRleHRhcmVhKS5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgIHZhciByZWYyO1xuICAgICAgICBpZiAoKHJlZjIgPSBldi5rZXlDb2RlKSA9PT0gMTcgfHwgcmVmMiA9PT0gMjI0KSB7XG4gICAgICAgICAgY3RsRG93biA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChldi5jdHJsS2V5ICE9IG51bGwpICYmIChldi5tZXRhS2V5ICE9IG51bGwpKSB7XG4gICAgICAgICAgY3RsRG93biA9IGV2LmN0cmxLZXkgfHwgZXYubWV0YUtleTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3RsRG93biAmJiBldi5rZXlDb2RlID09PSA4Nikge1xuICAgICAgICAgIHBhc3RlLl90ZXh0YXJlYV9mb2N1c19zdG9sZW4gPSB0cnVlO1xuICAgICAgICAgIHBhc3RlLl9jb250YWluZXIuZm9jdXMoKTtcbiAgICAgICAgICBwYXN0ZS5fcGFzdGVfZXZlbnRfZmlyZWQgPSBmYWxzZTtcbiAgICAgICAgICBzZXRUaW1lb3V0KChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBpZiAoIXBhc3RlLl9wYXN0ZV9ldmVudF9maXJlZCkge1xuICAgICAgICAgICAgICAgICQodGV4dGFyZWEpLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhc3RlLl90ZXh0YXJlYV9mb2N1c19zdG9sZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KSh0aGlzKSwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9KTtcbiAgICAgICQodGV4dGFyZWEpLm9uKCdwYXN0ZScsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7fTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgICQodGV4dGFyZWEpLm9uKCdmb2N1cycsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKCFwYXN0ZS5fdGV4dGFyZWFfZm9jdXNfc3RvbGVuKSB7XG4gICAgICAgICAgICByZXR1cm4gJCh0ZXh0YXJlYSkuYWRkQ2xhc3MoJ3Bhc3RhYmxlLWZvY3VzJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgJCh0ZXh0YXJlYSkub24oJ2JsdXInLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmICghcGFzdGUuX3RleHRhcmVhX2ZvY3VzX3N0b2xlbikge1xuICAgICAgICAgICAgcmV0dXJuICQodGV4dGFyZWEpLnJlbW92ZUNsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgICQocGFzdGUuX3RhcmdldCkub24oJ19wYXN0ZUNoZWNrQ29udGFpbmVyRG9uZScsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJCh0ZXh0YXJlYSkuZm9jdXMoKTtcbiAgICAgICAgICByZXR1cm4gcGFzdGUuX3RleHRhcmVhX2ZvY3VzX3N0b2xlbiA9IGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgcmV0dXJuICQocGFzdGUuX3RhcmdldCkub24oJ3Bhc3RlVGV4dCcsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXYsIGRhdGEpIHtcbiAgICAgICAgICB2YXIgY29udGVudCwgY3VyRW5kLCBjdXJTdGFydDtcbiAgICAgICAgICBjdXJTdGFydCA9ICQodGV4dGFyZWEpLnByb3AoJ3NlbGVjdGlvblN0YXJ0Jyk7XG4gICAgICAgICAgY3VyRW5kID0gJCh0ZXh0YXJlYSkucHJvcCgnc2VsZWN0aW9uRW5kJyk7XG4gICAgICAgICAgY29udGVudCA9ICQodGV4dGFyZWEpLnZhbCgpO1xuICAgICAgICAgICQodGV4dGFyZWEpLnZhbChcIlwiICsgY29udGVudC5zbGljZSgwLCBjdXJTdGFydCkgKyBkYXRhLnRleHQgKyBjb250ZW50LnNsaWNlKGN1ckVuZCkpO1xuICAgICAgICAgICQodGV4dGFyZWEpWzBdLnNldFNlbGVjdGlvblJhbmdlKGN1clN0YXJ0ICsgZGF0YS50ZXh0Lmxlbmd0aCwgY3VyU3RhcnQgKyBkYXRhLnRleHQubGVuZ3RoKTtcbiAgICAgICAgICByZXR1cm4gJCh0ZXh0YXJlYSkudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIFBhc3RlLm1vdW50Q29udGVudGVkaXRhYmxlID0gZnVuY3Rpb24oY29udGVudGVkaXRhYmxlKSB7XG4gICAgICB2YXIgcGFzdGU7XG4gICAgICBwYXN0ZSA9IG5ldyBQYXN0ZShjb250ZW50ZWRpdGFibGUsIGNvbnRlbnRlZGl0YWJsZSk7XG4gICAgICAkKGNvbnRlbnRlZGl0YWJsZSkub24oJ2ZvY3VzJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gJChjb250ZW50ZWRpdGFibGUpLmFkZENsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgcmV0dXJuICQoY29udGVudGVkaXRhYmxlKS5vbignYmx1cicsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuICQoY29udGVudGVkaXRhYmxlKS5yZW1vdmVDbGFzcygncGFzdGFibGUtZm9jdXMnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gUGFzdGUoX2NvbnRhaW5lciwgX3RhcmdldCkge1xuICAgICAgdGhpcy5fY29udGFpbmVyID0gX2NvbnRhaW5lcjtcbiAgICAgIHRoaXMuX3RhcmdldCA9IF90YXJnZXQ7XG4gICAgICB0aGlzLl9jb250YWluZXIgPSAkKHRoaXMuX2NvbnRhaW5lcik7XG4gICAgICB0aGlzLl90YXJnZXQgPSAkKHRoaXMuX3RhcmdldCkuYWRkQ2xhc3MoJ3Bhc3RhYmxlJyk7XG4gICAgICB0aGlzLl9jb250YWluZXIub24oJ3Bhc3RlJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihldikge1xuICAgICAgICAgIHZhciBjbGlwYm9hcmREYXRhLCBmaWxlLCBpdGVtLCBqLCBrLCBsZW4sIGxlbjEsIHJlYWRlciwgcmVmLCByZWYxLCByZWYyLCByZWYzLCB0ZXh0O1xuICAgICAgICAgIGlmIChldi5jdXJyZW50VGFyZ2V0ICE9PSBldi50YXJnZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfdGhpcy5fcGFzdGVfZXZlbnRfZmlyZWQgPSB0cnVlO1xuICAgICAgICAgIGlmICgoKHJlZiA9IGV2Lm9yaWdpbmFsRXZlbnQpICE9IG51bGwgPyByZWYuY2xpcGJvYXJkRGF0YSA6IHZvaWQgMCkgIT0gbnVsbCkge1xuICAgICAgICAgICAgY2xpcGJvYXJkRGF0YSA9IGV2Lm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YTtcbiAgICAgICAgICAgIGlmIChjbGlwYm9hcmREYXRhLml0ZW1zKSB7XG4gICAgICAgICAgICAgIHJlZjEgPSBjbGlwYm9hcmREYXRhLml0ZW1zO1xuICAgICAgICAgICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYxLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgICAgICAgICAgaXRlbSA9IHJlZjFbal07XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZS5tYXRjaCgvXmltYWdlXFwvLykpIHtcbiAgICAgICAgICAgICAgICAgIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9oYW5kbGVJbWFnZShldmVudC50YXJnZXQucmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpdGVtLmdldEFzRmlsZSgpKTtcbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxuICAgICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlID09PSAndGV4dC9wbGFpbicpIHtcbiAgICAgICAgICAgICAgICAgIGl0ZW0uZ2V0QXNTdHJpbmcoZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlVGV4dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGlmICgtMSAhPT0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChjbGlwYm9hcmREYXRhLnR5cGVzLCAndGV4dC9wbGFpbicpKSB7XG4gICAgICAgICAgICAgICAgdGV4dCA9IGNsaXBib2FyZERhdGEuZ2V0RGF0YSgnVGV4dCcpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZVRleHQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIDEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIF90aGlzLl9jaGVja0ltYWdlc0luQ29udGFpbmVyKGZ1bmN0aW9uKHNyYykge1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5faGFuZGxlSW1hZ2Uoc3JjKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjbGlwYm9hcmREYXRhID0gd2luZG93LmNsaXBib2FyZERhdGEpIHtcbiAgICAgICAgICAgIGlmICgocmVmMiA9ICh0ZXh0ID0gY2xpcGJvYXJkRGF0YS5nZXREYXRhKCdUZXh0JykpKSAhPSBudWxsID8gcmVmMi5sZW5ndGggOiB2b2lkIDApIHtcbiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlVGV4dCcsIHtcbiAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdfcGFzdGVDaGVja0NvbnRhaW5lckRvbmUnKTtcbiAgICAgICAgICAgICAgfSwgMSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZWYzID0gY2xpcGJvYXJkRGF0YS5maWxlcztcbiAgICAgICAgICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjMubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgICAgICAgICAgZmlsZSA9IHJlZjNba107XG4gICAgICAgICAgICAgICAgX3RoaXMuX2hhbmRsZUltYWdlKFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIF90aGlzLl9jaGVja0ltYWdlc0luQ29udGFpbmVyKGZ1bmN0aW9uKHNyYykge30pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9XG5cbiAgICBQYXN0ZS5wcm90b3R5cGUuX2hhbmRsZUltYWdlID0gZnVuY3Rpb24oc3JjKSB7XG4gICAgICB2YXIgbG9hZGVyO1xuICAgICAgaWYgKHNyYy5tYXRjaCgvXndlYmtpdFxcLWZha2VcXC11cmxcXDpcXC9cXC8vKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlSW1hZ2VFcnJvcicsIHtcbiAgICAgICAgICBtZXNzYWdlOiBcIllvdSBhcmUgdHJ5aW5nIHRvIHBhc3RlIGFuIGltYWdlIGluIFNhZmFyaSwgaG93ZXZlciB3ZSBhcmUgdW5hYmxlIHRvIHJldGlldmUgaXRzIGRhdGEuXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVJbWFnZVN0YXJ0Jyk7XG4gICAgICBsb2FkZXIgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIGxvYWRlci5jcm9zc09yaWdpbiA9IFwiYW5vbnltb3VzXCI7XG4gICAgICBsb2FkZXIub25sb2FkID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgYmxvYiwgY2FudmFzLCBjdHgsIGRhdGFVUkw7XG4gICAgICAgICAgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgICAgY2FudmFzLndpZHRoID0gbG9hZGVyLndpZHRoO1xuICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBsb2FkZXIuaGVpZ2h0O1xuICAgICAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobG9hZGVyLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgICAgICAgIGRhdGFVUkwgPSBudWxsO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBkYXRhVVJMID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7XG4gICAgICAgICAgICBibG9iID0gZGF0YVVSTHRvQmxvYihkYXRhVVJMKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgICAgICBpZiAoZGF0YVVSTCkge1xuICAgICAgICAgICAgX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZUltYWdlJywge1xuICAgICAgICAgICAgICBibG9iOiBibG9iLFxuICAgICAgICAgICAgICBkYXRhVVJMOiBkYXRhVVJMLFxuICAgICAgICAgICAgICB3aWR0aDogbG9hZGVyLndpZHRoLFxuICAgICAgICAgICAgICBoZWlnaHQ6IGxvYWRlci5oZWlnaHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZUltYWdlRW5kJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKTtcbiAgICAgIGxvYWRlci5vbmVycm9yID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlSW1hZ2VFcnJvcicsIHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGdldCBpbWFnZSBmcm9tOiBcIiArIHNyYyxcbiAgICAgICAgICAgIHVybDogc3JjXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVJbWFnZUVuZCcpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcyk7XG4gICAgICByZXR1cm4gbG9hZGVyLnNyYyA9IHNyYztcbiAgICB9O1xuXG4gICAgUGFzdGUucHJvdG90eXBlLl9jaGVja0ltYWdlc0luQ29udGFpbmVyID0gZnVuY3Rpb24oY2IpIHtcbiAgICAgIHZhciBpbWcsIGosIGxlbiwgcmVmLCB0aW1lc3BhbjtcbiAgICAgIHRpbWVzcGFuID0gTWF0aC5mbG9vcigxMDAwICogTWF0aC5yYW5kb20oKSk7XG4gICAgICByZWYgPSB0aGlzLl9jb250YWluZXIuZmluZCgnaW1nJyk7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgaW1nID0gcmVmW2pdO1xuICAgICAgICBpbWdbXCJfcGFzdGVfbWFya2VkX1wiICsgdGltZXNwYW5dID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzZXRUaW1lb3V0KChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIGssIGxlbjEsIHJlZjE7XG4gICAgICAgICAgcmVmMSA9IF90aGlzLl9jb250YWluZXIuZmluZCgnaW1nJyk7XG4gICAgICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgICAgICBpbWcgPSByZWYxW2tdO1xuICAgICAgICAgICAgaWYgKCFpbWdbXCJfcGFzdGVfbWFya2VkX1wiICsgdGltZXNwYW5dKSB7XG4gICAgICAgICAgICAgIGNiKGltZy5zcmMpO1xuICAgICAgICAgICAgICAkKGltZykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ19wYXN0ZUNoZWNrQ29udGFpbmVyRG9uZScpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcyksIDEpO1xuICAgIH07XG5cbiAgICByZXR1cm4gUGFzdGU7XG5cbiAgfSkoKTtcblxufSkuY2FsbCh0aGlzKTtcblxudmFyIHRoZV9wYXN0ZVBsdWdpbkNhbGxiYWNrO1xuXG4oZnVuY3Rpb24oJCl7XG5cdHRoZV9wYXN0ZVBsdWdpbkNhbGxiYWNrID0gZnVuY3Rpb24oIGVkaXRvciApIHtcblx0XHR2YXIgcGFzdGVCdG4sXG5cdFx0XHRvcmlnRG9tQWRkLFxuXHRcdFx0Y2xpcGJvYXJkSGFzSW1hZ2UgPSBmYWxzZSxcblx0XHRcdGN1cnJlbnRDbGlwYm9hcmRFdmVudCA9IG51bGwsXG5cdFx0XHRwcmV2ZW50SW1hZ2VQYXN0ZSA9IGZhbHNlLFxuXHRcdFx0dGhlcGFzdGUgPSB3cC5tZWRpYS50aGVwYXN0ZSxcblx0XHRcdHRvb2xiYXIsXG5cdFx0XHRwYXN0ZWRfaW1hZ2VfdG1wX3ByZWZpeCA9ICdfX3Bhc3RlZF9pbWFnZV90bXBfJyxcblx0XHRcdHBhc3RlZF9pbWFnZV90bXBfY2xhc3MgPSAnJztcblxuXHRcdC8vIGRlZmF1bHQgb25cblx0XHR0aGVwYXN0ZS5vcHRpb25zLmVkaXRvci5hdXRvX3VwbG9hZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCAndGhlcGFzdGUuYXV0b191cGxvYWQnICkgIT09ICdmYWxzZSc7XG5cblx0XHQvLyBlbmFibGUgLyBkaXNhYmxlIGF1dG91cGxvYWRcblx0XHRlZGl0b3IuYWRkQ29tbWFuZCggJ2NtZF90aGVwYXN0ZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhlcGFzdGUub3B0aW9ucy5lZGl0b3IuYXV0b191cGxvYWQgPSAhIHRoZXBhc3RlLm9wdGlvbnMuZWRpdG9yLmF1dG9fdXBsb2FkO1xuXHRcdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oICd0aGVwYXN0ZS5hdXRvX3VwbG9hZCcsIHRoZXBhc3RlLm9wdGlvbnMuZWRpdG9yLmF1dG9fdXBsb2FkLnRvU3RyaW5nKCkgKTtcblx0XHRcdHBhc3RlQnRuLmFjdGl2ZSggdGhlcGFzdGUub3B0aW9ucy5lZGl0b3IuYXV0b191cGxvYWQgKTtcblxuXHRcdH0pO1xuXG5cdFx0Ly8gZW5hYmxlIC8gZGlzYWJsZSBhdXRvdXBsb2FkIGJ1dHRvblxuXHRcdGVkaXRvci5hZGRCdXR0b24oJ3RoZXBhc3RlJywge1xuXHRcdFx0aWNvbjogJ3RoZXBhc3RlJyxcblx0XHRcdHRvb2x0aXA6IHRoZXBhc3RlLmwxMG4udXBsb2FkX3Bhc3RlZF9pbWFnZXMsXG5cdFx0XHRjbWQgOiAnY21kX3RoZXBhc3RlJyxcblx0XHRcdG9uUG9zdFJlbmRlcjogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHBhc3RlQnRuID0gdGhpcztcblx0XHRcdH0sXG5cdFx0XHRhY3RpdmU6dGhlcGFzdGUub3B0aW9ucy5lZGl0b3IuYXV0b191cGxvYWRcblx0XHR9KTtcblxuXHRcdC8vIHVwbG9hZCBidXR0b24gaW4gbWVkaWEgdG9vbGJhciBmbHlvdXRcblx0XHRlZGl0b3IuYWRkQnV0dG9uKCd3cF9pbWdfdGhlcGFzdGVfdXBsb2FkJywge1xuXHRcdFx0aWNvbjogJ2Rhc2hpY29uIGRhc2hpY29ucyBkYXNoaWNvbnMtdXBsb2FkIHRoZXBhc3RlLXVwbG9hZCcsXG5cdFx0XHR0b29sdGlwOiB0aGVwYXN0ZS5sMTBuLnVwbG9hZF9pbWFnZSxcblx0XHRcdG9uY2xpY2s6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQvLyB3cmFwIGltZywgdXBsb2FkXG5cdFx0XHRcdHZhciBpbWFnZTtcblx0XHRcdFx0aW1hZ2UgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKTtcblxuXHRcdFx0XHR0aGVwYXN0ZS51cGxvYWRJbWFnZSggaW1hZ2UsIGVkaXRvciApO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Ly8gaW5pdCBtZWRpYSB0b29sYmFyIGZseW91dFxuXHRcdGVkaXRvci5vbmNlKCAncHJlaW5pdCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCBlZGl0b3Iud3AgJiYgZWRpdG9yLndwLl9jcmVhdGVUb29sYmFyICkge1xuXHRcdFx0XHR0b29sYmFyID0gZWRpdG9yLndwLl9jcmVhdGVUb29sYmFyKCBbXG5cdFx0XHRcdFx0J3dwX2ltZ19hbGlnbmxlZnQnLFxuXHRcdFx0XHRcdCd3cF9pbWdfYWxpZ25jZW50ZXInLFxuXHRcdFx0XHRcdCd3cF9pbWdfYWxpZ25yaWdodCcsXG5cdFx0XHRcdFx0J3dwX2ltZ19hbGlnbm5vbmUnLFxuXHRcdFx0XHRcdCd3cF9pbWdfdGhlcGFzdGVfdXBsb2FkJyxcblx0XHRcdFx0XHQnd3BfaW1nX2VkaXQnLFxuXHRcdFx0XHRcdCd3cF9pbWdfcmVtb3ZlJyxcblx0XHRcdFx0XSApO1xuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdC8vIHNldHVwIG1lZGlhIHRvb2xiYXIgZmx5b3V0IG9uIG5vZGUgY2hhbmdlXG5cdFx0ZWRpdG9yLm9uKCAnd3B0b29sYmFyJywgZnVuY3Rpb24oIGV2ZW50ICkge1xuXHRcdFx0dmFyIHVwbG9hZEJ0bjtcblx0XHRcdGlmICggZXZlbnQuZWxlbWVudC5ub2RlTmFtZSA9PT0gJ0lNRycgJiYgISBlZGl0b3Iud3AuaXNQbGFjZWhvbGRlciggZXZlbnQuZWxlbWVudCApICkge1xuXHRcdFx0XHRldmVudC50b29sYmFyID0gdG9vbGJhcjtcblxuXHRcdFx0XHR1cGxvYWRCdG4gPSB0b29sYmFyLiRlbC5maW5kKCcudGhlcGFzdGUtdXBsb2FkJykuY2xvc2VzdCgnLm1jZS1idG4nKTtcblxuXHRcdFx0XHRpZiAoIGNhblVwbG9hZCggZXZlbnQuZWxlbWVudCApICkge1xuXHRcdFx0XHRcdHVwbG9hZEJ0bi5zaG93KCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dXBsb2FkQnRuLmhpZGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdC8vIHRydSBpZiBkYXRhIHNvdXJjZSBvciBibG9iIGltYWdlXG5cdFx0ZnVuY3Rpb24gY2FuVXBsb2FkKCBpbWcgKSB7XG5cdFx0XHR2YXIgc3ViID0gaW1nLnNyYy5zdWJzdHJpbmcoMCw1KTtcblx0XHRcdHJldHVybiBzdWIgPT09ICdibG9iOicgfHwgc3ViID09PSAnZGF0YTonO1xuXHRcdH1cblxuXHRcdC8vIHNldHVwIG1lZGlhIHRvb2xiYXIgZmx5b3V0XG5cdFx0ZWRpdG9yXG5cdFx0XHQub24oICdCZWZvcmVQYXN0ZVByZVByb2Nlc3MnLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0Ly8gcmVtb3ZlIHN2ZyBkYXRhXG5cdFx0XHRcdGlmICggIGUuY29udGVudC5tYXRjaCggLyZsdDtzdmdbXFxzXFxTLl0qJmx0O1xcL3N2ZyZndDsvaSApICkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRlLmNvbnRlbnQgPSAnJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gZTtcblxuXHRcdFx0fSApXG5cdFx0XHQub24oICdQYXN0ZVBvc3RQcm9jZXNzJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdC8vIHVwbG9hZCBpbWFnZVxuXHRcdFx0XHR2YXIgJGZpcnN0Q2hpbGQsICR1cGxvYWRCb3g7XG5cblx0XHRcdFx0aWYgKCB0aGVwYXN0ZS5vcHRpb25zLmVkaXRvci5hdXRvX3VwbG9hZCApIHtcblx0XHRcdFx0XHQkZmlyc3RDaGlsZCA9ICQoZS5ub2RlKS5jaGlsZHJlbigpLmZpcnN0KCk7XG5cdFx0XHRcdFx0aWYgKCAkZmlyc3RDaGlsZC5pcygnaW1nJykgJiYgY2FuVXBsb2FkKCAkZmlyc3RDaGlsZC5nZXQoMCkgKSApIHtcblx0XHRcdFx0XHRcdCR1cGxvYWRCb3ggPSB0aGVwYXN0ZS51cGxvYWRJbWFnZSggJGZpcnN0Q2hpbGQuZ2V0KDApLCBlZGl0b3IgKTtcblx0XHRcdFx0XHRcdCRmaXJzdENoaWxkLnJlbW92ZSgpO1xuXHRcdFx0XHRcdFx0JChlLm5vZGUpLmFwcGVuZCggJHVwbG9hZEJveCApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdDtcblxuXHR9O1xuXG5cdHRpbnltY2UuUGx1Z2luTWFuYWdlci5hZGQoICd0aGVwYXN0ZScsIHRoZV9wYXN0ZVBsdWdpbkNhbGxiYWNrICk7XG5cbn0gKShqUXVlcnkpO1xuIl19
