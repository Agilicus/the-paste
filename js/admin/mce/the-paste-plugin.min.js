(function(){var t,e,n,a,o;t=window.jQuery,t.paste=function(t){var n;return"undefined"!=typeof console&&null!==console&&console.log("DEPRECATED: This method is deprecated. Please use $.fn.pastableNonInputable() instead."),n=e.mountNonInputable(t),n._container},t.fn.pastableNonInputable=function(){var n,a,o,r;for(r=this,a=0,o=r.length;a<o;a++)n=r[a],n._pastable||t(n).is("textarea, input:text, [contenteditable]")||(e.mountNonInputable(n),n._pastable=!0);return this},t.fn.pastableTextarea=function(){var n,a,o,r;for(r=this,a=0,o=r.length;a<o;a++)n=r[a],n._pastable||t(n).is(":not(textarea, input:text)")||(e.mountTextarea(n),n._pastable=!0);return this},t.fn.pastableContenteditable=function(){var n,a,o,r;for(r=this,a=0,o=r.length;a<o;a++)n=r[a],n._pastable||t(n).is(":not([contenteditable])")||(e.mountContenteditable(n),n._pastable=!0);return this},a=function(t,e){var n,a,o,r,i,u,l,s,c,p,d;if(null==e&&(e=512),!(s=t.match(/^data\:([^\;]+)\;base64\,(.+)$/)))return null;for(p=s,s=p[0],u=p[1],n=p[2],r=atob(n),o=[],c=0;c<r.length;){for(d=r.slice(c,c+e),i=new Array(d.length),l=0;l<d.length;)i[l]=d.charCodeAt(l),l++;a=new Uint8Array(i),o.push(a),c+=e}return new Blob(o,{type:u})},n=function(){return t(document.createElement("div")).attr("contenteditable",!0).attr("aria-hidden",!0).attr("tabindex",-1).css({width:1,height:1,position:"fixed",left:-100,overflow:"hidden"})},o=function(e,n){var a,o,r,i,u,l;return i=void 0,u=void 0,r=void 0,o=void 0,a=void 0,"area"===(l=e.nodeName.toLowerCase())?(i=e.parentNode,u=i.name,!(!e.href||!u||"map"!==i.nodeName.toLowerCase())&&(r=t("img[usemap='#"+u+"']"),r.length>0&&r.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(l)?(o=!e.disabled)&&(a=t(e).closest("fieldset")[0])&&(o=!a.disabled):o="a"===l?e.href||n:n,(o=o||t(e).is("[contenteditable]"))&&t(e).is(":visible"))},e=function(){function e(e,n){this._container=e,this._target=n,this._container=t(this._container),this._target=t(this._target).addClass("pastable"),this._container.on("paste",function(t){return function(e){var n,a,o,r,i,u,l,s,c,p,d,f,g;if(e.currentTarget!==e.target)return e.preventDefault();if(t._paste_event_fired=!0,null!=(null!=(c=e.originalEvent)?c.clipboardData:void 0))if(n=e.originalEvent.clipboardData,n.items)for(p=n.items,r=0,u=p.length;r<u;r++){if(o=p[r],o.type.match(/^image\//)){s=new FileReader,s.onload=function(e){return t._handleImage(e.target.result)};try{s.readAsDataURL(o.getAsFile())}catch(t){}e.preventDefault();break}"text/plain"===o.type&&o.getAsString(function(e){return t._target.trigger("pasteText",{text:e})})}else-1!==Array.prototype.indexOf.call(n.types,"text/plain")&&(g=n.getData("Text"),setTimeout(function(){return t._target.trigger("pasteText",{text:g})},1)),t._checkImagesInContainer(function(e){return t._handleImage(e)});if(n=window.clipboardData)if(null!=(d=g=n.getData("Text"))?d.length:void 0)setTimeout(function(){return t._target.trigger("pasteText",{text:g}),t._target.trigger("_pasteCheckContainerDone")},1);else{for(f=n.files,i=0,l=f.length;i<l;i++)a=f[i],t._handleImage(URL.createObjectURL(a));t._checkImagesInContainer(function(t){})}return null}}(this))}return e.prototype._target=null,e.prototype._container=null,e.mountNonInputable=function(a){var r;return r=new e(n().appendTo(a),a),t(a).on("click",function(t){return function(t){if(!o(t.target,!1))return r._container.focus()}}()),r._container.on("focus",function(e){return function(){return t(a).addClass("pastable-focus")}}()),r._container.on("blur",function(e){return function(){return t(a).removeClass("pastable-focus")}}())},e.mountTextarea=function(a){var o,r,i,u;return("undefined"!=typeof DataTransfer&&null!==DataTransfer?DataTransfer.prototype:void 0)&&(null!=(i=Object.getOwnPropertyDescriptor)&&null!=(u=i.call(Object,DataTransfer.prototype,"items"))?u.get:void 0)?this.mountContenteditable(a):(r=new e(n().insertBefore(a),a),o=!1,t(a).on("keyup",function(t){var e;return 17!==(e=t.keyCode)&&224!==e||(o=!1),null}),t(a).on("keydown",function(e){var n;return 17!==(n=e.keyCode)&&224!==n||(o=!0),null!=e.ctrlKey&&null!=e.metaKey&&(o=e.ctrlKey||e.metaKey),o&&86===e.keyCode&&(r._textarea_focus_stolen=!0,r._container.focus(),r._paste_event_fired=!1,setTimeout(function(e){return function(){if(!r._paste_event_fired)return t(a).focus(),r._textarea_focus_stolen=!1}}(),1)),null}),t(a).on("paste",function(t){return function(){}}()),t(a).on("focus",function(e){return function(){if(!r._textarea_focus_stolen)return t(a).addClass("pastable-focus")}}()),t(a).on("blur",function(e){return function(){if(!r._textarea_focus_stolen)return t(a).removeClass("pastable-focus")}}()),t(r._target).on("_pasteCheckContainerDone",function(e){return function(){return t(a).focus(),r._textarea_focus_stolen=!1}}()),t(r._target).on("pasteText",function(e){return function(e,n){var o,r,i;return i=t(a).prop("selectionStart"),r=t(a).prop("selectionEnd"),o=t(a).val(),t(a).val(""+o.slice(0,i)+n.text+o.slice(r)),t(a)[0].setSelectionRange(i+n.text.length,i+n.text.length),t(a).trigger("change")}}()))},e.mountContenteditable=function(n){return new e(n,n),t(n).on("focus",function(e){return function(){return t(n).addClass("pastable-focus")}}()),t(n).on("blur",function(e){return function(){return t(n).removeClass("pastable-focus")}}())},e.prototype._handleImage=function(t){var e;return t.match(/^webkit\-fake\-url\:\/\//)?this._target.trigger("pasteImageError",{message:"You are trying to paste an image in Safari, however we are unable to retieve its data."}):(this._target.trigger("pasteImageStart"),e=new Image,e.crossOrigin="anonymous",e.onload=function(t){return function(){var n,o,r,i;o=document.createElement("canvas"),o.width=e.width,o.height=e.height,r=o.getContext("2d"),r.drawImage(e,0,0,o.width,o.height),i=null;try{i=o.toDataURL("image/png"),n=a(i)}catch(t){}return i&&t._target.trigger("pasteImage",{blob:n,dataURL:i,width:e.width,height:e.height}),t._target.trigger("pasteImageEnd")}}(this),e.onerror=function(e){return function(){return e._target.trigger("pasteImageError",{message:"Failed to get image from: "+t,url:t}),e._target.trigger("pasteImageEnd")}}(this),e.src=t)},e.prototype._checkImagesInContainer=function(e){var n,a,o,r,i;for(i=Math.floor(1e3*Math.random()),r=this._container.find("img"),a=0,o=r.length;a<o;a++)n=r[a],n["_paste_marked_"+i]=!0;return setTimeout(function(a){return function(){var o,r,u;for(u=a._container.find("img"),o=0,r=u.length;o<r;o++)n=u[o],n["_paste_marked_"+i]||(e(n.src),t(n).remove());return a._target.trigger("_pasteCheckContainerDone")}}(this),1)},e}()}).call(this);var thepastePluginCallback;!function(t){thepastePluginCallback=function(e){function n(){var n=r.apply(this,arguments);return"mcepastebin"===t(n).attr("id")&&t(n).pastableContenteditable().on("paste",function(t){}).on("pasteImage",function(t,n){var a;if(s)return t.preventDefault(),!1;a=c.insertImage(n.dataURL,n.blob.type,e),c.options.editor.auto_upload&&c.uploadImage(a,e)}),n}function a(){r=e.dom.add,e.dom.add=n,t(e.dom.doc).on("paste",function(t){l=t.originalEvent,console.log(l.clipboardData.types),u=c.clipboardHasImage(t.originalEvent.clipboardData),s=!1})}var o,r,i,u=!1,l=null,s=!1,c=wp.media.thepaste;c.options.editor.auto_upload="false"!==localStorage.getItem("thepaste.auto_upload"),e.addCommand("cmd_thepaste",function(){c.options.editor.auto_upload=!c.options.editor.auto_upload,localStorage.setItem("thepaste.auto_upload",c.options.editor.auto_upload.toString()),o.active(c.options.editor.auto_upload)}),e.addButton("thepaste",{icon:"thepaste",tooltip:c.l10n.upload_pasted_images,cmd:"cmd_thepaste",onPostRender:function(){o=this},active:c.options.editor.auto_upload}),e.addButton("wp_img_thepaste_upload",{icon:"dashicon dashicons dashicons-upload thepaste-upload",tooltip:c.l10n.upload_image,onclick:function(){var t;t=e.selection.getNode(),c.uploadImage(t,e)}}),e.once("preinit",function(){e.wp&&e.wp._createToolbar&&(i=e.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wp_img_thepaste_upload","wp_img_edit","wp_img_remove"]))}),e.on("wptoolbar",function(t){var n,a=!1;"IMG"!==t.element.nodeName||e.wp.isPlaceholder(t.element)||(t.toolbar=i,a=!!t.element.src.match(/^(blob|data):/),n=i.$el.find(".thepaste-upload").closest(".mce-btn"),a?n.show():n.hide())}),e.on("init",a).on("BeforePastePreProcess",function(t){return t.content.match(/&lt;svg[\s\S.]*&lt;\/svg&gt;/i)&&(t.preventDefault(),t.content=""),u&&(t.preventDefault(),t.content=""),t})},tinymce.PluginManager.add("thepaste",thepastePluginCallback)}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRoZS1wYXN0ZS1wbHVnaW4uanMiXSwibmFtZXMiOlsiJCIsIlBhc3RlIiwiY3JlYXRlSGlkZGVuRWRpdGFibGUiLCJkYXRhVVJMdG9CbG9iIiwiaXNGb2N1c2FibGUiLCJ3aW5kb3ciLCJqUXVlcnkiLCJwYXN0ZSIsInBhc3RlQ29udGFpbmVyIiwicG0iLCJjb25zb2xlIiwibG9nIiwibW91bnROb25JbnB1dGFibGUiLCJfY29udGFpbmVyIiwiZm4iLCJwYXN0YWJsZU5vbklucHV0YWJsZSIsImVsIiwiaiIsImxlbiIsInJlZiIsInRoaXMiLCJsZW5ndGgiLCJfcGFzdGFibGUiLCJpcyIsInBhc3RhYmxlVGV4dGFyZWEiLCJtb3VudFRleHRhcmVhIiwicGFzdGFibGVDb250ZW50ZWRpdGFibGUiLCJtb3VudENvbnRlbnRlZGl0YWJsZSIsImRhdGFVUkwiLCJzbGljZVNpemUiLCJiNjREYXRhIiwiYnl0ZUFycmF5IiwiYnl0ZUFycmF5cyIsImJ5dGVDaGFyYWN0ZXJzIiwiYnl0ZU51bWJlcnMiLCJjb250ZW50VHlwZSIsImkiLCJtIiwib2Zmc2V0Iiwic2xpY2UiLCJtYXRjaCIsImF0b2IiLCJBcnJheSIsImNoYXJDb2RlQXQiLCJVaW50OEFycmF5IiwicHVzaCIsIkJsb2IiLCJ0eXBlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYXR0ciIsImNzcyIsIndpZHRoIiwiaGVpZ2h0IiwicG9zaXRpb24iLCJsZWZ0Iiwib3ZlcmZsb3ciLCJlbGVtZW50IiwiaGFzVGFiaW5kZXgiLCJmaWVsZHNldCIsImZvY3VzYWJsZUlmVmlzaWJsZSIsImltZyIsIm1hcCIsIm1hcE5hbWUiLCJub2RlTmFtZSIsInRvTG93ZXJDYXNlIiwicGFyZW50Tm9kZSIsIm5hbWUiLCJocmVmIiwidGVzdCIsImRpc2FibGVkIiwiY2xvc2VzdCIsIl90YXJnZXQiLCJhZGRDbGFzcyIsIm9uIiwiX3RoaXMiLCJldiIsImNsaXBib2FyZERhdGEiLCJmaWxlIiwiaXRlbSIsImsiLCJsZW4xIiwicmVhZGVyIiwicmVmMSIsInJlZjIiLCJyZWYzIiwidGV4dCIsImN1cnJlbnRUYXJnZXQiLCJ0YXJnZXQiLCJwcmV2ZW50RGVmYXVsdCIsIl9wYXN0ZV9ldmVudF9maXJlZCIsIm9yaWdpbmFsRXZlbnQiLCJpdGVtcyIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJldmVudCIsIl9oYW5kbGVJbWFnZSIsInJlc3VsdCIsInJlYWRBc0RhdGFVUkwiLCJnZXRBc0ZpbGUiLCJlcnJvciIsImdldEFzU3RyaW5nIiwic3RyaW5nIiwidHJpZ2dlciIsInByb3RvdHlwZSIsImluZGV4T2YiLCJjYWxsIiwidHlwZXMiLCJnZXREYXRhIiwic2V0VGltZW91dCIsIl9jaGVja0ltYWdlc0luQ29udGFpbmVyIiwic3JjIiwiZmlsZXMiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJub25JbnB1dGFibGUiLCJhcHBlbmRUbyIsImZvY3VzIiwicmVtb3ZlQ2xhc3MiLCJ0ZXh0YXJlYSIsImN0bERvd24iLCJEYXRhVHJhbnNmZXIiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXQiLCJpbnNlcnRCZWZvcmUiLCJrZXlDb2RlIiwiY3RybEtleSIsIm1ldGFLZXkiLCJfdGV4dGFyZWFfZm9jdXNfc3RvbGVuIiwiZGF0YSIsImNvbnRlbnQiLCJjdXJFbmQiLCJjdXJTdGFydCIsInByb3AiLCJ2YWwiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImNvbnRlbnRlZGl0YWJsZSIsImxvYWRlciIsIm1lc3NhZ2UiLCJJbWFnZSIsImNyb3NzT3JpZ2luIiwiYmxvYiIsImNhbnZhcyIsImN0eCIsImdldENvbnRleHQiLCJkcmF3SW1hZ2UiLCJ0b0RhdGFVUkwiLCJvbmVycm9yIiwidXJsIiwiY2IiLCJ0aW1lc3BhbiIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImZpbmQiLCJyZW1vdmUiLCJ0aGVwYXN0ZVBsdWdpbkNhbGxiYWNrIiwiZWRpdG9yIiwiZG9tQWRkIiwib3JpZ0RvbUFkZCIsImFwcGx5IiwiYXJndW1lbnRzIiwiZSIsImltYWdlIiwicHJldmVudEltYWdlUGFzdGUiLCJ0aGVwYXN0ZSIsImluc2VydEltYWdlIiwib3B0aW9ucyIsImF1dG9fdXBsb2FkIiwidXBsb2FkSW1hZ2UiLCJzZXR1cEVkaXRvckRvbSIsImRvbSIsImFkZCIsImRvYyIsImN1cnJlbnRDbGlwYm9hcmRFdmVudCIsImNsaXBib2FyZEhhc0ltYWdlIiwicGFzdGVCdG4iLCJ0b29sYmFyIiwid3AiLCJtZWRpYSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJhZGRDb21tYW5kIiwic2V0SXRlbSIsInRvU3RyaW5nIiwiYWN0aXZlIiwiYWRkQnV0dG9uIiwiaWNvbiIsInRvb2x0aXAiLCJsMTBuIiwidXBsb2FkX3Bhc3RlZF9pbWFnZXMiLCJjbWQiLCJvblBvc3RSZW5kZXIiLCJ1cGxvYWRfaW1hZ2UiLCJvbmNsaWNrIiwic2VsZWN0aW9uIiwiZ2V0Tm9kZSIsIm9uY2UiLCJfY3JlYXRlVG9vbGJhciIsInVwbG9hZEJ0biIsImNhblVwbG9hZCIsImlzUGxhY2Vob2xkZXIiLCIkZWwiLCJzaG93IiwiaGlkZSIsInRpbnltY2UiLCJQbHVnaW5NYW5hZ2VyIl0sIm1hcHBpbmdzIjoiQ0FRQSxXQUNFLEdBQUlBLEdBQUdDLEVBQU9DLEVBQXNCQyxFQUFlQyxDQUVuREosR0FBSUssT0FBT0MsT0FFWE4sRUFBRU8sTUFBUSxTQUFTQyxHQUNqQixHQUFJQyxFQUtKLE9BSnVCLG1CQUFaQyxVQUF1QyxPQUFaQSxTQUNwQ0EsUUFBUUMsSUFBSSwwRkFFZEYsRUFBS1IsRUFBTVcsa0JBQWtCSixHQUN0QkMsRUFBR0ksWUFHWmIsRUFBRWMsR0FBR0MscUJBQXVCLFdBQzFCLEdBQUlDLEdBQUlDLEVBQUdDLEVBQUtDLENBRWhCLEtBREFBLEVBQU1DLEtBQ0RILEVBQUksRUFBR0MsRUFBTUMsRUFBSUUsT0FBUUosRUFBSUMsRUFBS0QsSUFDckNELEVBQUtHLEVBQUlGLEdBQ0xELEVBQUdNLFdBQWF0QixFQUFFZ0IsR0FBSU8sR0FBRyw2Q0FHN0J0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QUFReUIsSUFBSWhELEtBQUssb0JBQW9CcEYsUUFBUSxZQUVwRGtJLEVBQ0pELEVBQVVJLE9BRVZKLEVBQVVLLFVBS2IvQyxFQUNFcEYsR0FBSSxPQUFRaUcsR0FDWmpHLEdBQUksd0JBQXlCLFNBQVN5RixHQVN0QyxNQVJNQSxHQUFFaEMsUUFBUTNGLE1BQU8sbUNBQ3RCMkgsRUFBRTFFLGlCQUNGMEUsRUFBRWhDLFFBQVUsSUFFUjZDLElBQ0piLEVBQUUxRSxpQkFDRjBFLEVBQUVoQyxRQUFVLElBRU5nQyxLQU1WMkMsUUFBUUMsY0FBY2xDLElBQUssV0FBWWhCLHlCQUVwQ3ZKIiwiZmlsZSI6InRoZS1wYXN0ZS1wbHVnaW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjEyLjdcblxuLypcbnBhc3RlLmpzIGlzIGFuIGludGVyZmFjZSB0byByZWFkIGRhdGEgKCB0ZXh0IC8gaW1hZ2UgKSBmcm9tIGNsaXBib2FyZCBpbiBkaWZmZXJlbnQgYnJvd3NlcnMuIEl0IGFsc28gY29udGFpbnMgc2V2ZXJhbCBoYWNrcy5cblxuaHR0cHM6Ly9naXRodWIuY29tL2xheWVyc3Nzcy9wYXN0ZS5qc1xuICovXG5cbihmdW5jdGlvbigpIHtcbiAgdmFyICQsIFBhc3RlLCBjcmVhdGVIaWRkZW5FZGl0YWJsZSwgZGF0YVVSTHRvQmxvYiwgaXNGb2N1c2FibGU7XG5cbiAgJCA9IHdpbmRvdy5qUXVlcnk7XG5cbiAgJC5wYXN0ZSA9IGZ1bmN0aW9uKHBhc3RlQ29udGFpbmVyKSB7XG4gICAgdmFyIHBtO1xuICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBjb25zb2xlICE9PSBudWxsKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkRFUFJFQ0FURUQ6IFRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgJC5mbi5wYXN0YWJsZU5vbklucHV0YWJsZSgpIGluc3RlYWQuXCIpO1xuICAgIH1cbiAgICBwbSA9IFBhc3RlLm1vdW50Tm9uSW5wdXRhYmxlKHBhc3RlQ29udGFpbmVyKTtcbiAgICByZXR1cm4gcG0uX2NvbnRhaW5lcjtcbiAgfTtcblxuICAkLmZuLnBhc3RhYmxlTm9uSW5wdXRhYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVsLCBqLCBsZW4sIHJlZjtcbiAgICByZWYgPSB0aGlzO1xuICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgZWwgPSByZWZbal07XG4gICAgICBpZiAoZWwuX3Bhc3RhYmxlIHx8ICQoZWwpLmlzKCd0ZXh0YXJlYSwgaW5wdXQ6dGV4dCwgW2NvbnRlbnRlZGl0YWJsZV0nKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIFBhc3RlLm1vdW50Tm9uSW5wdXRhYmxlKGVsKTtcbiAgICAgIGVsLl9wYXN0YWJsZSA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gICQuZm4ucGFzdGFibGVUZXh0YXJlYSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbCwgaiwgbGVuLCByZWY7XG4gICAgcmVmID0gdGhpcztcbiAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgIGVsID0gcmVmW2pdO1xuICAgICAgaWYgKGVsLl9wYXN0YWJsZSB8fCAkKGVsKS5pcygnOm5vdCh0ZXh0YXJlYSwgaW5wdXQ6dGV4dCknKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIFBhc3RlLm1vdW50VGV4dGFyZWEoZWwpO1xuICAgICAgZWwuX3Bhc3RhYmxlID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgJC5mbi5wYXN0YWJsZUNvbnRlbnRlZGl0YWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbCwgaiwgbGVuLCByZWY7XG4gICAgcmVmID0gdGhpcztcbiAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgIGVsID0gcmVmW2pdO1xuICAgICAgaWYgKGVsLl9wYXN0YWJsZSB8fCAkKGVsKS5pcygnOm5vdChbY29udGVudGVkaXRhYmxlXSknKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIFBhc3RlLm1vdW50Q29udGVudGVkaXRhYmxlKGVsKTtcbiAgICAgIGVsLl9wYXN0YWJsZSA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIGRhdGFVUkx0b0Jsb2IgPSBmdW5jdGlvbihkYXRhVVJMLCBzbGljZVNpemUpIHtcbiAgICB2YXIgYjY0RGF0YSwgYnl0ZUFycmF5LCBieXRlQXJyYXlzLCBieXRlQ2hhcmFjdGVycywgYnl0ZU51bWJlcnMsIGNvbnRlbnRUeXBlLCBpLCBtLCBvZmZzZXQsIHJlZiwgc2xpY2U7XG4gICAgaWYgKHNsaWNlU2l6ZSA9PSBudWxsKSB7XG4gICAgICBzbGljZVNpemUgPSA1MTI7XG4gICAgfVxuICAgIGlmICghKG0gPSBkYXRhVVJMLm1hdGNoKC9eZGF0YVxcOihbXlxcO10rKVxcO2Jhc2U2NFxcLCguKykkLykpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmVmID0gbSwgbSA9IHJlZlswXSwgY29udGVudFR5cGUgPSByZWZbMV0sIGI2NERhdGEgPSByZWZbMl07XG4gICAgYnl0ZUNoYXJhY3RlcnMgPSBhdG9iKGI2NERhdGEpO1xuICAgIGJ5dGVBcnJheXMgPSBbXTtcbiAgICBvZmZzZXQgPSAwO1xuICAgIHdoaWxlIChvZmZzZXQgPCBieXRlQ2hhcmFjdGVycy5sZW5ndGgpIHtcbiAgICAgIHNsaWNlID0gYnl0ZUNoYXJhY3RlcnMuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBzbGljZVNpemUpO1xuICAgICAgYnl0ZU51bWJlcnMgPSBuZXcgQXJyYXkoc2xpY2UubGVuZ3RoKTtcbiAgICAgIGkgPSAwO1xuICAgICAgd2hpbGUgKGkgPCBzbGljZS5sZW5ndGgpIHtcbiAgICAgICAgYnl0ZU51bWJlcnNbaV0gPSBzbGljZS5jaGFyQ29kZUF0KGkpO1xuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgICBieXRlQXJyYXkgPSBuZXcgVWludDhBcnJheShieXRlTnVtYmVycyk7XG4gICAgICBieXRlQXJyYXlzLnB1c2goYnl0ZUFycmF5KTtcbiAgICAgIG9mZnNldCArPSBzbGljZVNpemU7XG4gICAgfVxuICAgIHJldHVybiBuZXcgQmxvYihieXRlQXJyYXlzLCB7XG4gICAgICB0eXBlOiBjb250ZW50VHlwZVxuICAgIH0pO1xuICB9O1xuXG4gIGNyZWF0ZUhpZGRlbkVkaXRhYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpLmF0dHIoJ2NvbnRlbnRlZGl0YWJsZScsIHRydWUpLmF0dHIoJ2FyaWEtaGlkZGVuJywgdHJ1ZSkuYXR0cigndGFiaW5kZXgnLCAtMSkuY3NzKHtcbiAgICAgIHdpZHRoOiAxLFxuICAgICAgaGVpZ2h0OiAxLFxuICAgICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgICBsZWZ0OiAtMTAwLFxuICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nXG4gICAgfSk7XG4gIH07XG5cbiAgaXNGb2N1c2FibGUgPSBmdW5jdGlvbihlbGVtZW50LCBoYXNUYWJpbmRleCkge1xuICAgIHZhciBmaWVsZHNldCwgZm9jdXNhYmxlSWZWaXNpYmxlLCBpbWcsIG1hcCwgbWFwTmFtZSwgbm9kZU5hbWU7XG4gICAgbWFwID0gdm9pZCAwO1xuICAgIG1hcE5hbWUgPSB2b2lkIDA7XG4gICAgaW1nID0gdm9pZCAwO1xuICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9IHZvaWQgMDtcbiAgICBmaWVsZHNldCA9IHZvaWQgMDtcbiAgICBub2RlTmFtZSA9IGVsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoJ2FyZWEnID09PSBub2RlTmFtZSkge1xuICAgICAgbWFwID0gZWxlbWVudC5wYXJlbnROb2RlO1xuICAgICAgbWFwTmFtZSA9IG1hcC5uYW1lO1xuICAgICAgaWYgKCFlbGVtZW50LmhyZWYgfHwgIW1hcE5hbWUgfHwgbWFwLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICdtYXAnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGltZyA9ICQoJ2ltZ1t1c2VtYXA9XFwnIycgKyBtYXBOYW1lICsgJ1xcJ10nKTtcbiAgICAgIHJldHVybiBpbWcubGVuZ3RoID4gMCAmJiBpbWcuaXMoJzp2aXNpYmxlJyk7XG4gICAgfVxuICAgIGlmICgvXihpbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdCkkLy50ZXN0KG5vZGVOYW1lKSkge1xuICAgICAgZm9jdXNhYmxlSWZWaXNpYmxlID0gIWVsZW1lbnQuZGlzYWJsZWQ7XG4gICAgICBpZiAoZm9jdXNhYmxlSWZWaXNpYmxlKSB7XG4gICAgICAgIGZpZWxkc2V0ID0gJChlbGVtZW50KS5jbG9zZXN0KCdmaWVsZHNldCcpWzBdO1xuICAgICAgICBpZiAoZmllbGRzZXQpIHtcbiAgICAgICAgICBmb2N1c2FibGVJZlZpc2libGUgPSAhZmllbGRzZXQuZGlzYWJsZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCdhJyA9PT0gbm9kZU5hbWUpIHtcbiAgICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9IGVsZW1lbnQuaHJlZiB8fCBoYXNUYWJpbmRleDtcbiAgICB9IGVsc2Uge1xuICAgICAgZm9jdXNhYmxlSWZWaXNpYmxlID0gaGFzVGFiaW5kZXg7XG4gICAgfVxuICAgIGZvY3VzYWJsZUlmVmlzaWJsZSA9IGZvY3VzYWJsZUlmVmlzaWJsZSB8fCAkKGVsZW1lbnQpLmlzKCdbY29udGVudGVkaXRhYmxlXScpO1xuICAgIHJldHVybiBmb2N1c2FibGVJZlZpc2libGUgJiYgJChlbGVtZW50KS5pcygnOnZpc2libGUnKTtcbiAgfTtcblxuICBQYXN0ZSA9IChmdW5jdGlvbigpIHtcbiAgICBQYXN0ZS5wcm90b3R5cGUuX3RhcmdldCA9IG51bGw7XG5cbiAgICBQYXN0ZS5wcm90b3R5cGUuX2NvbnRhaW5lciA9IG51bGw7XG5cbiAgICBQYXN0ZS5tb3VudE5vbklucHV0YWJsZSA9IGZ1bmN0aW9uKG5vbklucHV0YWJsZSkge1xuICAgICAgdmFyIHBhc3RlO1xuICAgICAgcGFzdGUgPSBuZXcgUGFzdGUoY3JlYXRlSGlkZGVuRWRpdGFibGUoKS5hcHBlbmRUbyhub25JbnB1dGFibGUpLCBub25JbnB1dGFibGUpO1xuICAgICAgJChub25JbnB1dGFibGUpLm9uKCdjbGljaycsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICBpZiAoIWlzRm9jdXNhYmxlKGV2LnRhcmdldCwgZmFsc2UpKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFzdGUuX2NvbnRhaW5lci5mb2N1cygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgIHBhc3RlLl9jb250YWluZXIub24oJ2ZvY3VzJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gJChub25JbnB1dGFibGUpLmFkZENsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgcmV0dXJuIHBhc3RlLl9jb250YWluZXIub24oJ2JsdXInLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAkKG5vbklucHV0YWJsZSkucmVtb3ZlQ2xhc3MoJ3Bhc3RhYmxlLWZvY3VzJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIFBhc3RlLm1vdW50VGV4dGFyZWEgPSBmdW5jdGlvbih0ZXh0YXJlYSkge1xuICAgICAgdmFyIGN0bERvd24sIHBhc3RlLCByZWYsIHJlZjE7XG4gICAgICBpZiAoKHR5cGVvZiBEYXRhVHJhbnNmZXIgIT09IFwidW5kZWZpbmVkXCIgJiYgRGF0YVRyYW5zZmVyICE9PSBudWxsID8gRGF0YVRyYW5zZmVyLnByb3RvdHlwZSA6IHZvaWQgMCkgJiYgKChyZWYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKSAhPSBudWxsID8gKHJlZjEgPSByZWYuY2FsbChPYmplY3QsIERhdGFUcmFuc2Zlci5wcm90b3R5cGUsICdpdGVtcycpKSAhPSBudWxsID8gcmVmMS5nZXQgOiB2b2lkIDAgOiB2b2lkIDApKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vdW50Q29udGVudGVkaXRhYmxlKHRleHRhcmVhKTtcbiAgICAgIH1cbiAgICAgIHBhc3RlID0gbmV3IFBhc3RlKGNyZWF0ZUhpZGRlbkVkaXRhYmxlKCkuaW5zZXJ0QmVmb3JlKHRleHRhcmVhKSwgdGV4dGFyZWEpO1xuICAgICAgY3RsRG93biA9IGZhbHNlO1xuICAgICAgJCh0ZXh0YXJlYSkub24oJ2tleXVwJywgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgdmFyIHJlZjI7XG4gICAgICAgIGlmICgocmVmMiA9IGV2LmtleUNvZGUpID09PSAxNyB8fCByZWYyID09PSAyMjQpIHtcbiAgICAgICAgICBjdGxEb3duID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9KTtcbiAgICAgICQodGV4dGFyZWEpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgdmFyIHJlZjI7XG4gICAgICAgIGlmICgocmVmMiA9IGV2LmtleUNvZGUpID09PSAxNyB8fCByZWYyID09PSAyMjQpIHtcbiAgICAgICAgICBjdGxEb3duID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKGV2LmN0cmxLZXkgIT0gbnVsbCkgJiYgKGV2Lm1ldGFLZXkgIT0gbnVsbCkpIHtcbiAgICAgICAgICBjdGxEb3duID0gZXYuY3RybEtleSB8fCBldi5tZXRhS2V5O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdGxEb3duICYmIGV2LmtleUNvZGUgPT09IDg2KSB7XG4gICAgICAgICAgcGFzdGUuX3RleHRhcmVhX2ZvY3VzX3N0b2xlbiA9IHRydWU7XG4gICAgICAgICAgcGFzdGUuX2NvbnRhaW5lci5mb2N1cygpO1xuICAgICAgICAgIHBhc3RlLl9wYXN0ZV9ldmVudF9maXJlZCA9IGZhbHNlO1xuICAgICAgICAgIHNldFRpbWVvdXQoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGlmICghcGFzdGUuX3Bhc3RlX2V2ZW50X2ZpcmVkKSB7XG4gICAgICAgICAgICAgICAgJCh0ZXh0YXJlYSkuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFzdGUuX3RleHRhcmVhX2ZvY3VzX3N0b2xlbiA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pKHRoaXMpLCAxKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0pO1xuICAgICAgJCh0ZXh0YXJlYSkub24oJ3Bhc3RlJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHt9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgJCh0ZXh0YXJlYSkub24oJ2ZvY3VzJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAoIXBhc3RlLl90ZXh0YXJlYV9mb2N1c19zdG9sZW4pIHtcbiAgICAgICAgICAgIHJldHVybiAkKHRleHRhcmVhKS5hZGRDbGFzcygncGFzdGFibGUtZm9jdXMnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICAkKHRleHRhcmVhKS5vbignYmx1cicsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKCFwYXN0ZS5fdGV4dGFyZWFfZm9jdXNfc3RvbGVuKSB7XG4gICAgICAgICAgICByZXR1cm4gJCh0ZXh0YXJlYSkucmVtb3ZlQ2xhc3MoJ3Bhc3RhYmxlLWZvY3VzJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgJChwYXN0ZS5fdGFyZ2V0KS5vbignX3Bhc3RlQ2hlY2tDb250YWluZXJEb25lJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAkKHRleHRhcmVhKS5mb2N1cygpO1xuICAgICAgICAgIHJldHVybiBwYXN0ZS5fdGV4dGFyZWFfZm9jdXNfc3RvbGVuID0gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICByZXR1cm4gJChwYXN0ZS5fdGFyZ2V0KS5vbigncGFzdGVUZXh0JywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihldiwgZGF0YSkge1xuICAgICAgICAgIHZhciBjb250ZW50LCBjdXJFbmQsIGN1clN0YXJ0O1xuICAgICAgICAgIGN1clN0YXJ0ID0gJCh0ZXh0YXJlYSkucHJvcCgnc2VsZWN0aW9uU3RhcnQnKTtcbiAgICAgICAgICBjdXJFbmQgPSAkKHRleHRhcmVhKS5wcm9wKCdzZWxlY3Rpb25FbmQnKTtcbiAgICAgICAgICBjb250ZW50ID0gJCh0ZXh0YXJlYSkudmFsKCk7XG4gICAgICAgICAgJCh0ZXh0YXJlYSkudmFsKFwiXCIgKyBjb250ZW50LnNsaWNlKDAsIGN1clN0YXJ0KSArIGRhdGEudGV4dCArIGNvbnRlbnQuc2xpY2UoY3VyRW5kKSk7XG4gICAgICAgICAgJCh0ZXh0YXJlYSlbMF0uc2V0U2VsZWN0aW9uUmFuZ2UoY3VyU3RhcnQgKyBkYXRhLnRleHQubGVuZ3RoLCBjdXJTdGFydCArIGRhdGEudGV4dC5sZW5ndGgpO1xuICAgICAgICAgIHJldHVybiAkKHRleHRhcmVhKS50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgUGFzdGUubW91bnRDb250ZW50ZWRpdGFibGUgPSBmdW5jdGlvbihjb250ZW50ZWRpdGFibGUpIHtcbiAgICAgIHZhciBwYXN0ZTtcbiAgICAgIHBhc3RlID0gbmV3IFBhc3RlKGNvbnRlbnRlZGl0YWJsZSwgY29udGVudGVkaXRhYmxlKTtcbiAgICAgICQoY29udGVudGVkaXRhYmxlKS5vbignZm9jdXMnLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAkKGNvbnRlbnRlZGl0YWJsZSkuYWRkQ2xhc3MoJ3Bhc3RhYmxlLWZvY3VzJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICByZXR1cm4gJChjb250ZW50ZWRpdGFibGUpLm9uKCdibHVyJywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gJChjb250ZW50ZWRpdGFibGUpLnJlbW92ZUNsYXNzKCdwYXN0YWJsZS1mb2N1cycpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBQYXN0ZShfY29udGFpbmVyLCBfdGFyZ2V0KSB7XG4gICAgICB0aGlzLl9jb250YWluZXIgPSBfY29udGFpbmVyO1xuICAgICAgdGhpcy5fdGFyZ2V0ID0gX3RhcmdldDtcbiAgICAgIHRoaXMuX2NvbnRhaW5lciA9ICQodGhpcy5fY29udGFpbmVyKTtcbiAgICAgIHRoaXMuX3RhcmdldCA9ICQodGhpcy5fdGFyZ2V0KS5hZGRDbGFzcygncGFzdGFibGUnKTtcbiAgICAgIHRoaXMuX2NvbnRhaW5lci5vbigncGFzdGUnLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgICAgdmFyIGNsaXBib2FyZERhdGEsIGZpbGUsIGl0ZW0sIGosIGssIGxlbiwgbGVuMSwgcmVhZGVyLCByZWYsIHJlZjEsIHJlZjIsIHJlZjMsIHRleHQ7XG4gICAgICAgICAgaWYgKGV2LmN1cnJlbnRUYXJnZXQgIT09IGV2LnRhcmdldCkge1xuICAgICAgICAgICAgcmV0dXJuIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIF90aGlzLl9wYXN0ZV9ldmVudF9maXJlZCA9IHRydWU7XG4gICAgICAgICAgaWYgKCgocmVmID0gZXYub3JpZ2luYWxFdmVudCkgIT0gbnVsbCA/IHJlZi5jbGlwYm9hcmREYXRhIDogdm9pZCAwKSAhPSBudWxsKSB7XG4gICAgICAgICAgICBjbGlwYm9hcmREYXRhID0gZXYub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhO1xuICAgICAgICAgICAgaWYgKGNsaXBib2FyZERhdGEuaXRlbXMpIHtcbiAgICAgICAgICAgICAgcmVmMSA9IGNsaXBib2FyZERhdGEuaXRlbXM7XG4gICAgICAgICAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZjEubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpdGVtID0gcmVmMVtqXTtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlLm1hdGNoKC9eaW1hZ2VcXC8vKSkge1xuICAgICAgICAgICAgICAgICAgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX2hhbmRsZUltYWdlKGV2ZW50LnRhcmdldC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGl0ZW0uZ2V0QXNGaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHt9XG4gICAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09ICd0ZXh0L3BsYWluJykge1xuICAgICAgICAgICAgICAgICAgaXRlbS5nZXRBc1N0cmluZyhmdW5jdGlvbihzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVUZXh0Jywge1xuICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0cmluZ1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaWYgKC0xICE9PSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGNsaXBib2FyZERhdGEudHlwZXMsICd0ZXh0L3BsYWluJykpIHtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gY2xpcGJvYXJkRGF0YS5nZXREYXRhKCdUZXh0Jyk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlVGV4dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgMSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgX3RoaXMuX2NoZWNrSW1hZ2VzSW5Db250YWluZXIoZnVuY3Rpb24oc3JjKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9oYW5kbGVJbWFnZShzcmMpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGNsaXBib2FyZERhdGEgPSB3aW5kb3cuY2xpcGJvYXJkRGF0YSkge1xuICAgICAgICAgICAgaWYgKChyZWYyID0gKHRleHQgPSBjbGlwYm9hcmREYXRhLmdldERhdGEoJ1RleHQnKSkpICE9IG51bGwgPyByZWYyLmxlbmd0aCA6IHZvaWQgMCkge1xuICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVUZXh0Jywge1xuICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ19wYXN0ZUNoZWNrQ29udGFpbmVyRG9uZScpO1xuICAgICAgICAgICAgICB9LCAxKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlZjMgPSBjbGlwYm9hcmREYXRhLmZpbGVzO1xuICAgICAgICAgICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMy5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgICAgICAgICBmaWxlID0gcmVmM1trXTtcbiAgICAgICAgICAgICAgICBfdGhpcy5faGFuZGxlSW1hZ2UoVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgX3RoaXMuX2NoZWNrSW1hZ2VzSW5Db250YWluZXIoZnVuY3Rpb24oc3JjKSB7fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH1cblxuICAgIFBhc3RlLnByb3RvdHlwZS5faGFuZGxlSW1hZ2UgPSBmdW5jdGlvbihzcmMpIHtcbiAgICAgIHZhciBsb2FkZXI7XG4gICAgICBpZiAoc3JjLm1hdGNoKC9ed2Via2l0XFwtZmFrZVxcLXVybFxcOlxcL1xcLy8pKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVJbWFnZUVycm9yJywge1xuICAgICAgICAgIG1lc3NhZ2U6IFwiWW91IGFyZSB0cnlpbmcgdG8gcGFzdGUgYW4gaW1hZ2UgaW4gU2FmYXJpLCBob3dldmVyIHdlIGFyZSB1bmFibGUgdG8gcmV0aWV2ZSBpdHMgZGF0YS5cIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZUltYWdlU3RhcnQnKTtcbiAgICAgIGxvYWRlciA9IG5ldyBJbWFnZSgpO1xuICAgICAgbG9hZGVyLmNyb3NzT3JpZ2luID0gXCJhbm9ueW1vdXNcIjtcbiAgICAgIGxvYWRlci5vbmxvYWQgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBibG9iLCBjYW52YXMsIGN0eCwgZGF0YVVSTDtcbiAgICAgICAgICBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgICAgICBjYW52YXMud2lkdGggPSBsb2FkZXIud2lkdGg7XG4gICAgICAgICAgY2FudmFzLmhlaWdodCA9IGxvYWRlci5oZWlnaHQ7XG4gICAgICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgY3R4LmRyYXdJbWFnZShsb2FkZXIsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgICAgICAgZGF0YVVSTCA9IG51bGw7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGRhdGFVUkwgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTtcbiAgICAgICAgICAgIGJsb2IgPSBkYXRhVVJMdG9CbG9iKGRhdGFVUkwpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxuICAgICAgICAgIGlmIChkYXRhVVJMKSB7XG4gICAgICAgICAgICBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlSW1hZ2UnLCB7XG4gICAgICAgICAgICAgIGJsb2I6IGJsb2IsXG4gICAgICAgICAgICAgIGRhdGFVUkw6IGRhdGFVUkwsXG4gICAgICAgICAgICAgIHdpZHRoOiBsb2FkZXIud2lkdGgsXG4gICAgICAgICAgICAgIGhlaWdodDogbG9hZGVyLmhlaWdodFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfdGhpcy5fdGFyZ2V0LnRyaWdnZXIoJ3Bhc3RlSW1hZ2VFbmQnKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpO1xuICAgICAgbG9hZGVyLm9uZXJyb3IgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIF90aGlzLl90YXJnZXQudHJpZ2dlcigncGFzdGVJbWFnZUVycm9yJywge1xuICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gZ2V0IGltYWdlIGZyb206IFwiICsgc3JjLFxuICAgICAgICAgICAgdXJsOiBzcmNcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuX3RhcmdldC50cmlnZ2VyKCdwYXN0ZUltYWdlRW5kJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKTtcbiAgICAgIHJldHVybiBsb2FkZXIuc3JjID0gc3JjO1xuICAgIH07XG5cbiAgICBQYXN0ZS5wcm90b3R5cGUuX2NoZWNrSW1hZ2VzSW5Db250YWluZXIgPSBmdW5jdGlvbihjYikge1xuICAgICAgdmFyIGltZywgaiwgbGVuLCByZWYsIHRpbWVzcGFuO1xuICAgICAgdGltZXNwYW4gPSBNYXRoLmZsb29yKDEwMDAgKiBNYXRoLnJhbmRvbSgpKTtcbiAgICAgIHJlZiA9IHRoaXMuX2NvbnRhaW5lci5maW5kKCdpbWcnKTtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICBpbWcgPSByZWZbal07XG4gICAgICAgIGltZ1tcIl9wYXN0ZV9tYXJrZWRfXCIgKyB0aW1lc3Bhbl0gPSB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNldFRpbWVvdXQoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgaywgbGVuMSwgcmVmMTtcbiAgICAgICAgICByZWYxID0gX3RoaXMuX2NvbnRhaW5lci5maW5kKCdpbWcnKTtcbiAgICAgICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgICAgIGltZyA9IHJlZjFba107XG4gICAgICAgICAgICBpZiAoIWltZ1tcIl9wYXN0ZV9tYXJrZWRfXCIgKyB0aW1lc3Bhbl0pIHtcbiAgICAgICAgICAgICAgY2IoaW1nLnNyYyk7XG4gICAgICAgICAgICAgICQoaW1nKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF90aGlzLl90YXJnZXQudHJpZ2dlcignX3Bhc3RlQ2hlY2tDb250YWluZXJEb25lJyk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSwgMSk7XG4gICAgfTtcblxuICAgIHJldHVybiBQYXN0ZTtcblxuICB9KSgpO1xuXG59KS5jYWxsKHRoaXMpO1xuXG52YXIgdGhlcGFzdGVQbHVnaW5DYWxsYmFjaztcblxuKGZ1bmN0aW9uKCQpe1xuXHR0aGVwYXN0ZVBsdWdpbkNhbGxiYWNrID0gZnVuY3Rpb24oIGVkaXRvciApIHtcblx0XHR2YXIgcGFzdGVCdG4sXG5cdFx0XHRvcmlnRG9tQWRkLFxuXHRcdFx0Y2xpcGJvYXJkSGFzSW1hZ2UgPSBmYWxzZSxcblx0XHRcdGN1cnJlbnRDbGlwYm9hcmRFdmVudCA9IG51bGwsXG5cdFx0XHRwcmV2ZW50SW1hZ2VQYXN0ZSA9IGZhbHNlLFxuXHRcdFx0dGhlcGFzdGUgPSB3cC5tZWRpYS50aGVwYXN0ZSxcblx0XHRcdHRvb2xiYXI7XG5cblx0XHR0aGVwYXN0ZS5vcHRpb25zLmVkaXRvci5hdXRvX3VwbG9hZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCAndGhlcGFzdGUuYXV0b191cGxvYWQnICkgIT09ICdmYWxzZSc7XG5cdFx0Ly8gZGVmYXVsdCBvblxuXG5cdFx0ZnVuY3Rpb24gZG9tQWRkKCkge1xuXHRcdFx0dmFyIHJlc3VsdCA9IG9yaWdEb21BZGQuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXHRcdFx0aWYgKCAnbWNlcGFzdGViaW4nID09PSAkKHJlc3VsdCkuYXR0cignaWQnKSApIHtcblx0XHRcdFx0JChyZXN1bHQpXG5cdFx0XHRcdFx0LnBhc3RhYmxlQ29udGVudGVkaXRhYmxlKClcblx0XHRcdFx0XHQub24oJ3Bhc3RlJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbigncGFzdGVJbWFnZScsZnVuY3Rpb24oIGUsIGRhdGEgKSB7XG5cdFx0XHRcdFx0XHR2YXIgaW1hZ2U7XG5cdFx0XHRcdFx0XHRpZiAoIHByZXZlbnRJbWFnZVBhc3RlICkge1xuXHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGltYWdlID0gdGhlcGFzdGUuaW5zZXJ0SW1hZ2UoIGRhdGEuZGF0YVVSTCwgZGF0YS5ibG9iLnR5cGUsIGVkaXRvciApO1xuXHRcdFx0XHRcdFx0aWYgKCB0aGVwYXN0ZS5vcHRpb25zLmVkaXRvci5hdXRvX3VwbG9hZCApIHtcblx0XHRcdFx0XHRcdFx0dGhlcGFzdGUudXBsb2FkSW1hZ2UoIGltYWdlLCBlZGl0b3IgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2V0dXBFZGl0b3JEb20oKSB7XG5cblx0XHRcdG9yaWdEb21BZGQgPSBlZGl0b3IuZG9tLmFkZDtcblxuXHRcdFx0ZWRpdG9yLmRvbS5hZGQgPSBkb21BZGQ7XG5cblx0XHRcdCQoZWRpdG9yLmRvbS5kb2MpLm9uKCAncGFzdGUnLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0Y3VycmVudENsaXBib2FyZEV2ZW50ID0gZS5vcmlnaW5hbEV2ZW50O1xuXHRcdFx0XHRjb25zb2xlLmxvZyhjdXJyZW50Q2xpcGJvYXJkRXZlbnQuY2xpcGJvYXJkRGF0YS50eXBlcyk7XG5cdFx0XHRcdGNsaXBib2FyZEhhc0ltYWdlID0gdGhlcGFzdGUuY2xpcGJvYXJkSGFzSW1hZ2UoZS5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEpO1xuXHRcdFx0XHRwcmV2ZW50SW1hZ2VQYXN0ZSA9IGZhbHNlO1xuXHRcdFx0fSApO1xuXHRcdH1cblx0XHRlZGl0b3IuYWRkQ29tbWFuZCggJ2NtZF90aGVwYXN0ZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhlcGFzdGUub3B0aW9ucy5lZGl0b3IuYXV0b191cGxvYWQgPSAhIHRoZXBhc3RlLm9wdGlvbnMuZWRpdG9yLmF1dG9fdXBsb2FkO1xuXHRcdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oICd0aGVwYXN0ZS5hdXRvX3VwbG9hZCcsIHRoZXBhc3RlLm9wdGlvbnMuZWRpdG9yLmF1dG9fdXBsb2FkLnRvU3RyaW5nKCkgKTtcblx0XHRcdHBhc3RlQnRuLmFjdGl2ZSggdGhlcGFzdGUub3B0aW9ucy5lZGl0b3IuYXV0b191cGxvYWQgKTtcblx0XHR9KTtcblxuXG5cdFx0ZWRpdG9yLmFkZEJ1dHRvbigndGhlcGFzdGUnLCB7XG5cdFx0XHRpY29uOiAndGhlcGFzdGUnLFxuXHRcdFx0dG9vbHRpcDogdGhlcGFzdGUubDEwbi51cGxvYWRfcGFzdGVkX2ltYWdlcyxcblx0XHRcdGNtZCA6ICdjbWRfdGhlcGFzdGUnLFxuXHRcdFx0b25Qb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0cGFzdGVCdG4gPSB0aGlzO1xuXHRcdFx0fSxcblx0XHRcdGFjdGl2ZTp0aGVwYXN0ZS5vcHRpb25zLmVkaXRvci5hdXRvX3VwbG9hZFxuXHRcdH0pO1xuXG5cdFx0ZWRpdG9yLmFkZEJ1dHRvbignd3BfaW1nX3RoZXBhc3RlX3VwbG9hZCcsIHtcblx0XHRcdGljb246ICdkYXNoaWNvbiBkYXNoaWNvbnMgZGFzaGljb25zLXVwbG9hZCB0aGVwYXN0ZS11cGxvYWQnLFxuXHRcdFx0dG9vbHRpcDogdGhlcGFzdGUubDEwbi51cGxvYWRfaW1hZ2UsXG5cdFx0XHRvbmNsaWNrOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0Ly8gd3JhcCBpbWcsIHVwbG9hZFxuXHRcdFx0XHR2YXIgaW1hZ2U7XG5cdFx0XHRcdGltYWdlID0gZWRpdG9yLnNlbGVjdGlvbi5nZXROb2RlKCk7XG5cblx0XHRcdFx0dGhlcGFzdGUudXBsb2FkSW1hZ2UoIGltYWdlLCBlZGl0b3IgKTtcblx0XHRcdH1cdFx0XHRcblx0XHR9KTtcblxuXHRcdGVkaXRvci5vbmNlKCAncHJlaW5pdCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCBlZGl0b3Iud3AgJiYgZWRpdG9yLndwLl9jcmVhdGVUb29sYmFyICkge1xuXHRcdFx0XHR0b29sYmFyID0gZWRpdG9yLndwLl9jcmVhdGVUb29sYmFyKCBbXG5cdFx0XHRcdFx0J3dwX2ltZ19hbGlnbmxlZnQnLFxuXHRcdFx0XHRcdCd3cF9pbWdfYWxpZ25jZW50ZXInLFxuXHRcdFx0XHRcdCd3cF9pbWdfYWxpZ25yaWdodCcsXG5cdFx0XHRcdFx0J3dwX2ltZ19hbGlnbm5vbmUnLFxuXHRcdFx0XHRcdCd3cF9pbWdfdGhlcGFzdGVfdXBsb2FkJyxcblx0XHRcdFx0XHQnd3BfaW1nX2VkaXQnLFxuXHRcdFx0XHRcdCd3cF9pbWdfcmVtb3ZlJyxcblx0XHRcdFx0XSApO1xuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdGVkaXRvci5vbiggJ3dwdG9vbGJhcicsIGZ1bmN0aW9uKCBldmVudCApIHtcblx0XHRcdHZhciBjYW5VcGxvYWQgPSBmYWxzZSxcblx0XHRcdFx0dXBsb2FkQnRuO1xuXHRcdFx0aWYgKCBldmVudC5lbGVtZW50Lm5vZGVOYW1lID09PSAnSU1HJyAmJiAhIGVkaXRvci53cC5pc1BsYWNlaG9sZGVyKCBldmVudC5lbGVtZW50ICkgKSB7XG5cdFx0XHRcdGV2ZW50LnRvb2xiYXIgPSB0b29sYmFyO1xuXHRcdFx0XHRjYW5VcGxvYWQgPSAhISBldmVudC5lbGVtZW50LnNyYy5tYXRjaCggL14oYmxvYnxkYXRhKTovICk7XG5cdFx0XHRcdHVwbG9hZEJ0biA9IHRvb2xiYXIuJGVsLmZpbmQoJy50aGVwYXN0ZS11cGxvYWQnKS5jbG9zZXN0KCcubWNlLWJ0bicpO1xuXG5cdFx0XHRcdGlmICggY2FuVXBsb2FkICkge1xuXHRcdFx0XHRcdHVwbG9hZEJ0bi5zaG93KCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dXBsb2FkQnRuLmhpZGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdGVkaXRvclxuXHRcdFx0Lm9uKCAnaW5pdCcsIHNldHVwRWRpdG9yRG9tIClcblx0XHRcdC5vbiggJ0JlZm9yZVBhc3RlUHJlUHJvY2VzcycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoICBlLmNvbnRlbnQubWF0Y2goIC8mbHQ7c3ZnW1xcc1xcUy5dKiZsdDtcXC9zdmcmZ3Q7L2kgKSApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0ZS5jb250ZW50ID0gJyc7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCBjbGlwYm9hcmRIYXNJbWFnZSApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0ZS5jb250ZW50ID0gJyc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIGU7XG5cblx0XHRcdH0gKTtcblxuXHR9O1xuXG5cdHRpbnltY2UuUGx1Z2luTWFuYWdlci5hZGQoICd0aGVwYXN0ZScsIHRoZXBhc3RlUGx1Z2luQ2FsbGJhY2sgKTtcblxufSApKGpRdWVyeSk7XG5cbiJdfQ==
